{"version":3,"file":"Index-a963c011.mjs","sources":["../../../resources/js/Pages/Admin/Content/Products/Index.vue"],"sourcesContent":["<script setup>\nimport ProductModal from '@/Pages/Admin/Content/Products/Modal.vue';\nimport Table from '@/Pages/Admin/Content/Products/Table.vue'\nimport Loader from '@/Components/Loader.vue'\nimport Button from '@/Components/Button.vue'\nimport Paginate from '@/Components/Paginate.vue'\nimport Search from '@/Components/Search.vue'\nimport ContentLayout from '@/Pages/Admin/Content/ContentLayout.vue'\n\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport ProductsRepository from \"@/Repositories/ProductsRepository\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst can = inject('$can');\nconst {t} = useI18n();\n\nconst product = reactive({\n    status: null,\n    title: {\n        ru: null,\n        ua: null\n    },\n    characteristics: {\n        ru: null,\n        ua: null,\n    },\n    description: {\n        ru: null,\n        ua: null\n    },\n    h1: {\n        ru: null,\n        ua: null\n    },\n    content: {\n        ru: null,\n        ua: null\n    },\n    characteristicsNew: {},\n    published: 0,\n    preview: null,\n    size_table: null,\n    price: null,\n    trade_price: null,\n    discount_price: null,\n    categories: [],\n    vendor_code: null,\n    provider_id: null,\n    youtube: null,\n    sizes: [],\n    images: [],\n    colors: [],\n})\n\nconst state = ref({\n    products: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: product,\n    errors: []\n});\n\nonMounted(() => {\n    let id = new URLSearchParams(new URL(window.location.href).search).get('product');\n    if (id) {\n        onEdit(id);\n    }\n\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? ProductModal : null)\n\nconst search = async (query) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.search(query);\n    if (data.success) {\n        state.value.currentPage = 1;\n        state.value.products = data.result;\n    }\n    state.value.isLoading = false;\n}\n\nconst fetch = async (page) => {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    const data = await ProductsRepository.fetch({'page': state.value.currentPage});\n    state.value.products = data.success ? data.result : [];\n    state.value.isLoading = false;\n}\n\nconst onDestroy = async (id) => {\n    if (can('destroy-products')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n        if (result.isConfirmed) {\n            const {success} = await ProductsRepository.destroy(id);\n            if (success) {\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    icon: 'success',\n                    title: t('swal.destroyed')\n                })\n            }\n        }\n    }\n}\n\nconst modalFunction = () => {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nconst onEdit = async (id) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.edit(id);\n    if (data.success) {\n        state.value.item = data.result;\n        state.value.item.characteristicsNew = {};\n        if (state.value.item.characteristics_new.length) {\n            state.value.item.characteristics_new.forEach((item) => {\n                state.value.item.characteristicsNew[item.characteristic_id] = [];\n            })\n            state.value.item.characteristics_new.forEach((item) => {\n                state.value.item.characteristicsNew[item.characteristic_id].push(item);\n            })\n        }\n        state.value.modalAction = 'edit';\n        modalFunction();\n    }\n    state.value.isLoading = false;\n}\n\nconst onUpdate = async () => {\n    if (can('edit-products')) {\n        const data = await ProductsRepository.update(state.value.item);\n        if (data.success) {\n            modalFunction();\n            await fetch();\n            await swal({\n                title: t('swal.updated'),\n                icon: 'success'\n            })\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                icon: 'error',\n                text: t('swal.check_data')\n            })\n        }\n    }\n}\n\nconst onCreate = async () => {\n    if (can('create-products')) {\n        const data = await ProductsRepository.create(state.value.item);\n        if (data.success) {\n            modalFunction();\n            state.value.item = product;\n            await fetch();\n            await swal({\n                title: t('swal.created'),\n                icon: 'success'\n            });\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                text: t('swal.check_data'),\n                icon: 'error'\n            })\n        }\n    }\n}\n\nconst submitForm = async () => {\n    if (state.value.modalAction === 'edit' && can('edit-products')) {\n        await onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-products')) {\n        await onCreate();\n    }\n}\n\nconst create = () => {\n    if (can('create-products')) {\n        state.value.item = product;\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n\nconst setProductImages = (images) => {\n    state.value.item.images = state.value.item.images.concat(images);\n}\n\nconst destroyImage = (image) => {\n    let index = state.value.item.images.findIndex((item) => {\n        return item.id === image;\n    })\n    state.value.item.images.splice(index, 1)\n}\n\nconst onUpdateProductSort = async (product_id, sort) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.updateSort(product_id, sort);\n    if (data.success) {\n        await swal({\n            title: t('swal.updated'),\n            icon: 'success'\n        })\n    }\n    state.value.isLoading = false;\n}\n</script>\n\n<template>\n    <ContentLayout :title=\"$t('products.page_title')\">\n        <template #header>{{ $t('products.page_title') }}</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-products')\" class=\"grid gap-4 grid-cols-1\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-products')\">\n                    {{ $t('add') }}\n                </Button>\n            </div>\n\n            <div class=\"grid grid-cols-1 gap-4\">\n                <Search @search=\"search\"\n                        :clear=\"true\"\n                        :placeholder=\"$t('products.search_placeholder')\"\n                        @onClear=\"fetch\"\n                />\n                <Table :data=\"state.products.data\"\n                       @onEdit=\"onEdit\"\n                       @onDestroy=\"onDestroy\"\n                       :canDestroy=\"can('destroy-products')\"\n                       @onUpdateProductSort=\"onUpdateProductSort\"\n                />\n            </div>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.products\"\n                          :click-handler=\"fetch\"\n                          v-model=\"state.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   @setProductImages=\"setProductImages\"\n                   @destroyImage=\"destroyImage\"\n                   :canDestroy=\"can('destroy-products')\"\n        ></component>\n    </ContentLayout>\n</template>\n"],"names":["ProductModal"],"mappings":"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"}