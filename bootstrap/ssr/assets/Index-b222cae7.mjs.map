{"version":3,"file":"Index-b222cae7.mjs","sources":["../../../resources/js/Pages/Admin/Options/Banners/Index.vue"],"sourcesContent":["<script setup>\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {swal} from \"@/Includes/swal\";\n\nimport Loader from '@/Components/Loader.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Button from '@/Components/Button.vue';\nimport BannersModal from '@/Pages/Admin/Options/Banners/Modal.vue';\nimport OptionsLayout from '@/Pages/Admin/Options/OptionsLayout.vue'\nimport Table from '@/Pages/Admin/Options/Banners/Table.vue';\n\nconst can = inject('$can');\n\nconst item = reactive({\n    title: {\n        ua: null,\n        ru: null,\n    },\n    image_mobile: {\n        ua: null,\n        ru: null,\n    },\n    image_table: {\n        ua: null,\n        ru: null,\n    },\n    image_desktop: {\n        ua: null,\n        ru: null,\n    },\n    link: {\n        ua: null,\n        ru: null,\n    },\n    published: 0,\n    categories: [],\n})\n\nconst state = ref({\n    data: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: item,\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? BannersModal : null)\n\n\nfunction fetch(page) {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    axios.get(route('api.banners.index', {'page': state.value.currentPage}))\n        .then(response => {\n            Object.assign(state.value.data, response.data.result);\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        })\n}\n\nfunction onDestroy(id) {\n    if (can('destroy-banners')) {\n        swal({\n            title: 'Видалити?',\n            icon: 'warning',\n            showCancelButton: true,\n        }).then((result) => {\n            if (result.isConfirmed) {\n                axios.delete(route('api.banners.destroy', id))\n                    .then(() => {\n                        fetch();\n                        if (state.value.isActiveModal) {\n                            modalFunction();\n                        }\n                        swal({\n                            icon: 'success',\n                            title: 'Destroyed!'\n                        })\n                    })\n                    .catch(errors => {\n                        console.log(errors);\n                        swal({\n                            icon: 'error',\n                            title: 'Error!'\n                        })\n                    })\n            }\n        })\n\n    }\n}\n\nfunction modalFunction() {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nfunction onEdit(id, i) {\n    if (can('edit-banners')) {\n        axios.get(route('api.banners.edit', id))\n            .then(({data}) => {\n                state.value.item = data.result;\n                state.value.modalAction = 'edit';\n                state.value.item.index = i;\n                modalFunction();\n            })\n            .catch((response) => console.log(response))\n    }\n}\n\nfunction onUpdate() {\n    if (can('edit-banners')) {\n        axios.put(route('api.banners.update', state.value.item.id), state.value.item)\n            .then(() => {\n                modalFunction();\n                fetch();\n                swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction onCreate() {\n    if (can('create-banners')) {\n        axios.post(route('api.banners.create'), state.value.item)\n            .then(() => {\n                modalFunction();\n                state.value.item = item;\n                fetch();\n                swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction submitForm() {\n    if (state.value.modalAction === 'edit' && can('edit-banners')) {\n        onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-banners')) {\n        onCreate();\n    }\n}\n\nfunction create() {\n    if (can('create-banners')) {\n        Object.assign(state.value.item, item);\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n\n\nfunction uploadImage(image, device, lang) {\n    let formData = new FormData();\n    formData.append('type', device);\n    formData.append('banner', image);\n    axios.post(route('api.banners.upload'), formData, {\n        headers: {\n            'Content-Type': 'multipart/form-data'\n        }\n    })\n        .then(({data}) => {\n            if (device === 'mobile') {\n                if (lang === 'ru') {\n                    state.value.item.image_mobile.ru = data.result;\n                }\n                if (lang === 'ua') {\n                    state.value.item.image_mobile.ua = data.result;\n                }\n            }\n            if (device === 'table') {\n                if (lang === 'ru') {\n                    state.value.item.image_table.ru = data.result;\n                }\n                if (lang === 'ua') {\n                    state.value.item.image_table.ua = data.result;\n                }\n            }\n            if (device === 'desktop') {\n                if (lang === 'ru') {\n                    state.value.item.image_desktop.ru = data.result;\n                }\n                if (lang === 'ua') {\n                    state.value.item.image_desktop.ua = data.result;\n                }\n            }\n        })\n        .catch((response) => console.log(response));\n}\n</script>\n\n<template>\n    <OptionsLayout title=\"Банера\">\n        <template #header>\n            Банера\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-banners')\">\n            <Button type=\"btn\" @click=\"create\" v-if=\"can('create-banners')\">\n                Додати\n            </Button>\n\n            <Table :data=\"state.data.data\"\n                   @onEdit=\"onEdit\"\n                   @onDestroy=\"onDestroy\"\n                   :canDestroy=\"can('destroy-banners')\"\n            />\n\n            <Paginate :pagination=\"state.data\"\n                      :click-handler=\"fetch\"\n                      v-model=\"state.currentPage\"\n            />\n\n            <component :is=\"activeModal\"\n                       :item=\"state.item\"\n                       @closeModal=\"modalFunction\"\n                       @submitForm=\"submitForm\"\n                       @declineForm=\"onDestroy\"\n                       @onUploadImage=\"uploadImage\"\n                       :canDestroy=\"can('destroy-banners')\"\n            ></component>\n        </div>\n    </OptionsLayout>\n</template>\n"],"names":["BannersModal"],"mappings":"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"}