{"version":3,"file":"Index-03344e6c.mjs","sources":["../../../resources/js/Pages/Admin/Content/Categories/Index.vue"],"sourcesContent":["<script setup>\nimport Modal from '@/Pages/Admin/Content/Categories/Modal.vue';\nimport Table from '@/Pages/Admin/Content/Categories/Table.vue';\nimport ContentLayout from '@/Pages/Admin/Content/ContentLayout.vue'\nimport Loader from '@/Components/Loader.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Button from '@/Components/Button.vue';\nimport CategoriesRepository from \"@/Repositories/CategoriesRepository\";\n\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst can = inject('$can');\nconst {t} = useI18n();\n\nconst item = reactive({\n    published: 0,\n    slug: null,\n    parent_id: null,\n    preview_id: null,\n    preview: null,\n    title: {\n        ru: null,\n        ua: null\n    },\n    meta_title: {\n        ru: null,\n        ua: null\n    },\n    meta_description: {\n        ru: null,\n        ua: null\n    },\n    meta_keyword: {\n        ru: null,\n        ua: null\n    },\n    seo_text: {\n        ru: null,\n        ua: null\n    }\n})\n\nconst state = ref({\n    categories: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: {},\n    errors: []\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nconst fetch = async (page) => {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    const data = await CategoriesRepository.fetch({'page': state.value.currentPage});\n    state.value.categories = data.success ? data.result : [];\n    state.value.isLoading = false;\n}\n\nconst onDestroy = async (id) => {\n    if (can('destroy-categories')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n        if (result.isConfirmed) {\n            const {success} = await CategoriesRepository.destroy(id);\n            if (success) {\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    icon: 'success',\n                    title: t('swal.destroyed')\n                })\n            }\n        }\n    }\n}\n\nconst modalFunction = () => {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nconst onEdit = async (id, i) => {\n    if (can('edit-categories')) {\n        const data = await CategoriesRepository.edit(id);\n        if (data.success) {\n            state.value.item = data.result;\n            state.value.modalAction = 'edit';\n            state.value.item.index = i;\n            modalFunction();\n        }\n    }\n}\n\nconst onUpdate = async () => {\n    if (can('edit-categories')) {\n        const data = await CategoriesRepository.update(state.value.item);\n        state.value.errors = [];\n        if (data.success) {\n            modalFunction();\n            await fetch();\n            await swal({\n                title: t('swal.updated'),\n                icon: 'success'\n            })\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                icon: 'error',\n                text: t('swal.check_data')\n            })\n        }\n    }\n}\n\nconst onCreate = async () => {\n    if (can('create-categories')) {\n        const data = await CategoriesRepository.create(state.value.item);\n        state.value.errors = [];\n        if (data.success) {\n            modalFunction();\n            state.value.item = {};\n            await fetch();\n            await swal({\n                title: t('swal.created'),\n                icon: 'success'\n            });\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                text: t('swal.check_data'),\n                icon: 'error'\n            })\n        }\n    }\n}\n\nconst submitForm = async () => {\n    if (state.value.modalAction === 'edit' && can('edit-categories')) {\n        await onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-categories')) {\n        await onCreate();\n    }\n}\n\nconst create = () => {\n    if (can('create-categories')) {\n        Object.assign(state.value.item, item);\n        state.value.modalAction = 'create';\n        state.value.errors = [];\n        modalFunction();\n    }\n}\n</script>\n\n<template>\n    <ContentLayout :title=\"$t('categories.page_title')\">\n        <template #header>{{ $t('categories.page_title') }}</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-categories')\" class=\"grid gap-4 grid-cols-1\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-categories')\">\n                    {{ $t('add') }}\n                </Button>\n            </div>\n\n            <Table :data=\"state.categories.data\"\n                   @onEdit=\"onEdit\"\n                   @onDestroy=\"onDestroy\"\n                   :canDestroy=\"can('destroy-categories')\"\n            />\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.categories\"\n                          :click-handler=\"fetch\"\n                          v-model=\"state.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   :errors=\"state.errors\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   :canDestroy=\"can('destroy-categories')\"\n        ></component>\n    </ContentLayout>\n</template>\n"],"names":["Modal"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,UAAM,MAAM,OAAO,MAAM;AACzB,UAAM,EAAC,EAAC,IAAI;AAEZ,UAAM,OAAO,SAAS;AAAA,MAClB,WAAW;AAAA,MACX,MAAM;AAAA,MACN,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,OAAO;AAAA,QACH,IAAI;AAAA,QACJ,IAAI;AAAA,MACP;AAAA,MACD,YAAY;AAAA,QACR,IAAI;AAAA,QACJ,IAAI;AAAA,MACP;AAAA,MACD,kBAAkB;AAAA,QACd,IAAI;AAAA,QACJ,IAAI;AAAA,MACP;AAAA,MACD,cAAc;AAAA,QACV,IAAI;AAAA,QACJ,IAAI;AAAA,MACP;AAAA,MACD,UAAU;AAAA,QACN,IAAI;AAAA,QACJ,IAAI;AAAA,MACP;AAAA,IACL,CAAC;AAED,UAAM,QAAQ,IAAI;AAAA,MACd,YAAY,CAAE;AAAA,MACd,aAAa;AAAA,MACb,WAAW;AAAA,MACX,eAAe;AAAA,MACf,aAAa;AAAA,MACb,MAAM,CAAE;AAAA,MACR,QAAQ,CAAE;AAAA,IACd,CAAC;AAED,cAAU,MAAM;AACZ,YAAM,CAAC;AAAA,IACX,CAAC;AAED,UAAM,cAAc,SAAS,MAAM,MAAM,MAAM,gBAAgBA,cAAQ,IAAI;AAE3E,UAAM,QAAQ,OAAO,SAAS;AAC1B,YAAM,MAAM,YAAY;AACxB,UAAI,MAAM;AACN,cAAM,MAAM,cAAc;AAAA,MAC7B;AACD,YAAM,OAAO,MAAM,qBAAqB,MAAM,EAAC,QAAQ,MAAM,MAAM,YAAW,CAAC;AAC/E,YAAM,MAAM,aAAa,KAAK,UAAU,KAAK,SAAS;AACtD,YAAM,MAAM,YAAY;AAAA,IAC5B;AAEA,UAAM,YAAY,OAAO,OAAO;AAC5B,UAAI,IAAI,oBAAoB,GAAG;AAC3B,cAAM,SAAS,MAAM,KAAK;AAAA,UACtB,OAAO,EAAE,WAAW;AAAA,UACpB,MAAM;AAAA,UACN,kBAAkB;AAAA,QAC9B,CAAS;AACD,YAAI,OAAO,aAAa;AACpB,gBAAM,EAAC,QAAO,IAAI,MAAM,qBAAqB,QAAQ,EAAE;AACvD,cAAI,SAAS;AACT,kBAAM,MAAK;AACX,gBAAI,MAAM,MAAM,eAAe;AAC3B;YACH;AACD,kBAAM,KAAK;AAAA,cACP,MAAM;AAAA,cACN,OAAO,EAAE,gBAAgB;AAAA,YAC7C,CAAiB;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,IACL;AAEA,UAAM,gBAAgB,MAAM;AACxB,YAAM,MAAM,gBAAgB,CAAC,MAAM,MAAM;AAAA,IAC7C;AAEA,UAAM,SAAS,OAAO,IAAI,MAAM;AAC5B,UAAI,IAAI,iBAAiB,GAAG;AACxB,cAAM,OAAO,MAAM,qBAAqB,KAAK,EAAE;AAC/C,YAAI,KAAK,SAAS;AACd,gBAAM,MAAM,OAAO,KAAK;AACxB,gBAAM,MAAM,cAAc;AAC1B,gBAAM,MAAM,KAAK,QAAQ;AACzB;QACH;AAAA,MACJ;AAAA,IACL;AAEA,UAAM,WAAW,YAAY;AACzB,UAAI,IAAI,iBAAiB,GAAG;AACxB,cAAM,OAAO,MAAM,qBAAqB,OAAO,MAAM,MAAM,IAAI;AAC/D,cAAM,MAAM,SAAS;AACrB,YAAI,KAAK,SAAS;AACd;AACA,gBAAM,MAAK;AACX,gBAAM,KAAK;AAAA,YACP,OAAO,EAAE,cAAc;AAAA,YACvB,MAAM;AAAA,UACtB,CAAa;AAAA,QACb,OAAe;AACH,gBAAM,MAAM,SAAS;AACrB,kBAAQ,IAAI,IAAI;AAChB,gBAAM,KAAK;AAAA,YACP,OAAO,EAAE,YAAY;AAAA,YACrB,MAAM;AAAA,YACN,MAAM,EAAE,iBAAiB;AAAA,UACzC,CAAa;AAAA,QACJ;AAAA,MACJ;AAAA,IACL;AAEA,UAAM,WAAW,YAAY;AACzB,UAAI,IAAI,mBAAmB,GAAG;AAC1B,cAAM,OAAO,MAAM,qBAAqB,OAAO,MAAM,MAAM,IAAI;AAC/D,cAAM,MAAM,SAAS;AACrB,YAAI,KAAK,SAAS;AACd;AACA,gBAAM,MAAM,OAAO;AACnB,gBAAM,MAAK;AACX,gBAAM,KAAK;AAAA,YACP,OAAO,EAAE,cAAc;AAAA,YACvB,MAAM;AAAA,UACtB,CAAa;AAAA,QACb,OAAe;AACH,gBAAM,MAAM,SAAS;AACrB,kBAAQ,IAAI,IAAI;AAChB,gBAAM,KAAK;AAAA,YACP,OAAO,EAAE,YAAY;AAAA,YACrB,MAAM,EAAE,iBAAiB;AAAA,YACzB,MAAM;AAAA,UACtB,CAAa;AAAA,QACJ;AAAA,MACJ;AAAA,IACL;AAEA,UAAM,aAAa,YAAY;AAC3B,UAAI,MAAM,MAAM,gBAAgB,UAAU,IAAI,iBAAiB,GAAG;AAC9D,cAAM,SAAQ;AAAA,MACtB,WAAe,MAAM,MAAM,gBAAgB,YAAY,IAAI,mBAAmB,GAAG;AACzE,cAAM,SAAQ;AAAA,MACjB;AAAA,IACL;AAEA,UAAM,SAAS,MAAM;AACjB,UAAI,IAAI,mBAAmB,GAAG;AAC1B,eAAO,OAAO,MAAM,MAAM,MAAM,IAAI;AACpC,cAAM,MAAM,cAAc;AAC1B,cAAM,MAAM,SAAS;AACrB;MACH;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}