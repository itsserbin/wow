{"version":3,"file":"Index-40ebf174.mjs","sources":["../../../resources/js/Pages/Admin/Statistics/Costs/Index.vue"],"sourcesContent":["<script setup>\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {endOfMonth, startOfMonth} from \"date-fns\";\nimport {swal} from \"@/Includes/swal\";\n\nimport Paginate from '@/Components/Paginate.vue';\nimport Card from '@/Components/Card.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Button from '@/Components/Button.vue';\nimport Label from '@/Components/Form/Label.vue';\nimport Select from '@/Components/Form/Select.vue';\nimport ColorModal from '@/Pages/Admin/Statistics/Costs/Modal.vue';\nimport CostChart from '@/Pages/Admin/Statistics/Chart.vue';\nimport Table from '@/Pages/Admin/Statistics/Costs/Table.vue';\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\n\nconst can = inject('$can');\n\nconst item = reactive({\n    name: null,\n    date: null,\n    sum: null,\n    quantity: 1,\n    comment: null,\n    total: null,\n    cost_category_id: null,\n    cost_type: 'single',\n})\n\nconst state = ref({\n    data: [],\n    chart: [],\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: {},\n});\n\n\nconst params = ref({\n    date: [],\n    page: 1,\n})\n\nconst costCategoriesOptions = ref([]);\n\nconst getParams = computed(() => {\n    const data = {};\n    if (params.value.filter) {\n        data.filter = params.value.filter\n    }\n    if (params.value.date.length === 2) {\n        data.date_start = params.value.date[0].toLocaleDateString();\n        data.date_end = params.value.date[1].toLocaleDateString();\n    }\n    data.page = params.value.page;\n    return data;\n});\n\nonMounted(() => {\n    params.value.date[0] = startOfMonth(new Date());\n    params.value.date[1] = endOfMonth(new Date());\n    fetch();\n    axios.get(route('api.statistics.costs.categories.list'))\n        .then(({data}) => {\n            data.result.forEach((item) => {\n                costCategoriesOptions.value.push({\n                    value: item.title,\n                    key: item.id,\n                })\n            });\n        })\n        .catch((errors) => console.log(errors))\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? ColorModal : null)\n\nfunction paginate(page) {\n    if (page) {\n        params.value.page = page;\n    }\n    fetch();\n}\n\nfunction fetch() {\n    state.value.isLoading = true;\n    axios.get(route('api.statistics.costs.index', getParams.value))\n        .then(({data}) => {\n            state.value.data = data\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        });\n\n    axios.get(route('api.statistics.costs.chart', getParams.value))\n        .then(({data}) => state.value.chart = data.result)\n        .catch((errors) => console.log(errors));\n\n}\n\nfunction onDestroy(id) {\n    swal({\n        title: 'Видалити?',\n        icon: 'warning',\n        showCancelButton: true,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            axios.delete(route('api.statistics.costs.destroy', id))\n                .then(() => {\n                    fetch();\n                    if (state.value.isActiveModal) {\n                        modalFunction();\n                    }\n                    swal({\n                        icon: 'success',\n                        title: 'Destroyed!'\n                    })\n                })\n                .catch(errors => {\n                    console.log(errors);\n                    swal({\n                        icon: 'error',\n                        title: 'Error!'\n                    })\n                })\n        }\n    })\n}\n\nfunction modalFunction() {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nfunction onEdit(id, i) {\n    axios.get(route('api.statistics.costs.edit', id))\n        .then(({data}) => {\n            state.value.item = data.result;\n            state.value.modalAction = 'edit';\n            state.value.item.index = i;\n            modalFunction();\n        })\n        .catch((response) => console.log(response))\n}\n\nfunction onUpdate() {\n    axios.put(route('api.statistics.costs.update', state.value.item.id), state.value.item)\n        .then(() => {\n            modalFunction();\n            fetch();\n            swal({\n                title: 'Success!',\n                icon: 'success'\n            })\n        })\n        .catch((response) => {\n            console.log(response);\n            swal({\n                title: 'Error!',\n                icon: 'error'\n            })\n        })\n}\n\nfunction onCreate() {\n    axios.post(route('api.statistics.costs.create'), state.value.item)\n        .then(() => {\n            modalFunction();\n            state.value.item = item;\n            fetch();\n            swal({\n                title: 'Success!',\n                icon: 'success'\n            })\n        })\n        .catch((response) => {\n            console.log(response);\n            swal({\n                title: 'Error!',\n                icon: 'error'\n            })\n        })\n}\n\nfunction submitForm() {\n    if (state.value.modalAction === 'edit') {\n        onUpdate();\n    } else if (state.value.modalAction === 'create') {\n        onCreate();\n    }\n}\n\nfunction create() {\n    Object.assign(state.value.item, item);\n    state.value.modalAction = 'create';\n    modalFunction();\n}\n</script>\n\n<template>\n    <StatisticLayout title=\"Витрати\">\n        <template #header>\n            Витрати\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-bookkeeping-costs')\" class=\"grid grid-cols-1 gap-4\">\n            <div>\n                <Button type=\"btn\" @click=\"create\">\n                    Додати\n                </Button>\n            </div>\n\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-5\">\n                <div class=\"block\">\n                    <Label value=\"Фільтр по категорії\"/>\n                    <Select v-model=\"params.filter\"\n                            :options=\"costCategoriesOptions\"\n                            @change=\"fetch\"\n                    />\n                </div>\n\n                <div class=\"block\">\n                    <Label value=\"Фільтр по даті\"/>\n                    <DatepickerComponent v-model=\"params.date\" @update:modelValue=\"fetch\"/>\n                </div>\n\n            </div>\n\n            <CostChart v-if=\"state.chart\" :chart-data=\"state.chart\"/>\n\n            <div class=\"grid grid-cols-2 md:grid-cols-6\">\n                <Card v-for=\"(item,i) in state.data.generalStat\"\n                      class=\"text-center\"\n                      :title=\"i\"\n                      :description=\"$filters.formatMoney(item)\"\n                >\n                </Card>\n            </div>\n\n            <Table :data=\"state.data.result.data\" @onDestroy=\"onDestroy\" @onEdit=\"onEdit\"/>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.data.result\"\n                          :click-handler=\"fetch\"\n                          v-model=\"params.page\"\n                />\n            </div>\n\n            <component :is=\"activeModal\"\n                       :item=\"state.item\"\n                       :modalAction=\"state.modalAction\"\n                       @closeModal=\"modalFunction\"\n                       @submitForm=\"submitForm\"\n                       @declineForm=\"onDestroy\"\n            ></component>\n        </div>\n    </StatisticLayout>\n</template>\n"],"names":["item","ColorModal"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,UAAM,MAAM,OAAO,MAAM;AAEzB,UAAM,OAAO,SAAS;AAAA,MAClB,MAAM;AAAA,MACN,MAAM;AAAA,MACN,KAAK;AAAA,MACL,UAAU;AAAA,MACV,SAAS;AAAA,MACT,OAAO;AAAA,MACP,kBAAkB;AAAA,MAClB,WAAW;AAAA,IACf,CAAC;AAED,UAAM,QAAQ,IAAI;AAAA,MACd,MAAM,CAAE;AAAA,MACR,OAAO,CAAE;AAAA,MACT,WAAW;AAAA,MACX,eAAe;AAAA,MACf,aAAa;AAAA,MACb,MAAM,CAAE;AAAA,IACZ,CAAC;AAGD,UAAM,SAAS,IAAI;AAAA,MACf,MAAM,CAAE;AAAA,MACR,MAAM;AAAA,IACV,CAAC;AAED,UAAM,wBAAwB,IAAI,CAAA,CAAE;AAEpC,UAAM,YAAY,SAAS,MAAM;AAC7B,YAAM,OAAO,CAAA;AACb,UAAI,OAAO,MAAM,QAAQ;AACrB,aAAK,SAAS,OAAO,MAAM;AAAA,MAC9B;AACD,UAAI,OAAO,MAAM,KAAK,WAAW,GAAG;AAChC,aAAK,aAAa,OAAO,MAAM,KAAK,CAAC,EAAE;AACvC,aAAK,WAAW,OAAO,MAAM,KAAK,CAAC,EAAE;MACxC;AACD,WAAK,OAAO,OAAO,MAAM;AACzB,aAAO;AAAA,IACX,CAAC;AAED,cAAU,MAAM;AACZ,aAAO,MAAM,KAAK,CAAC,IAAI,aAAa,oBAAI,KAAI,CAAE;AAC9C,aAAO,MAAM,KAAK,CAAC,IAAI,WAAW,oBAAI,KAAI,CAAE;AAC5C;AACA,YAAM,IAAI,MAAM,sCAAsC,CAAC,EAClD,KAAK,CAAC,EAAC,KAAI,MAAM;AACd,aAAK,OAAO,QAAQ,CAACA,UAAS;AAC1B,gCAAsB,MAAM,KAAK;AAAA,YAC7B,OAAOA,MAAK;AAAA,YACZ,KAAKA,MAAK;AAAA,UAC9B,CAAiB;AAAA,QACjB,CAAa;AAAA,MACb,CAAS,EACA,MAAM,CAAC,WAAW,QAAQ,IAAI,MAAM,CAAC;AAAA,IAC9C,CAAC;AAED,UAAM,cAAc,SAAS,MAAM,MAAM,MAAM,gBAAgBC,cAAa,IAAI;AAShF,aAAS,QAAQ;AACb,YAAM,MAAM,YAAY;AACxB,YAAM,IAAI,MAAM,8BAA8B,UAAU,KAAK,CAAC,EACzD,KAAK,CAAC,EAAC,KAAI,MAAM;AACd,cAAM,MAAM,OAAO;AACnB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS,EACA,MAAM,YAAU;AACb,gBAAQ,IAAI,MAAM;AAClB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS;AAEL,YAAM,IAAI,MAAM,8BAA8B,UAAU,KAAK,CAAC,EACzD,KAAK,CAAC,EAAC,KAAI,MAAM,MAAM,MAAM,QAAQ,KAAK,MAAM,EAChD,MAAM,CAAC,WAAW,QAAQ,IAAI,MAAM,CAAC;AAAA,IAE9C;AAEA,aAAS,UAAU,IAAI;AACnB,WAAK;AAAA,QACD,OAAO;AAAA,QACP,MAAM;AAAA,QACN,kBAAkB;AAAA,MAC1B,CAAK,EAAE,KAAK,CAAC,WAAW;AAChB,YAAI,OAAO,aAAa;AACpB,gBAAM,OAAO,MAAM,gCAAgC,EAAE,CAAC,EACjD,KAAK,MAAM;AACR;AACA,gBAAI,MAAM,MAAM,eAAe;AAC3B;YACH;AACD,iBAAK;AAAA,cACD,MAAM;AAAA,cACN,OAAO;AAAA,YAC/B,CAAqB;AAAA,UACrB,CAAiB,EACA,MAAM,YAAU;AACb,oBAAQ,IAAI,MAAM;AAClB,iBAAK;AAAA,cACD,MAAM;AAAA,cACN,OAAO;AAAA,YAC/B,CAAqB;AAAA,UACrB,CAAiB;AAAA,QACR;AAAA,MACT,CAAK;AAAA,IACL;AAEA,aAAS,gBAAgB;AACrB,YAAM,MAAM,gBAAgB,CAAC,MAAM,MAAM;AAAA,IAC7C;AAEA,aAAS,OAAO,IAAI,GAAG;AACnB,YAAM,IAAI,MAAM,6BAA6B,EAAE,CAAC,EAC3C,KAAK,CAAC,EAAC,KAAI,MAAM;AACd,cAAM,MAAM,OAAO,KAAK;AACxB,cAAM,MAAM,cAAc;AAC1B,cAAM,MAAM,KAAK,QAAQ;AACzB;MACZ,CAAS,EACA,MAAM,CAAC,aAAa,QAAQ,IAAI,QAAQ,CAAC;AAAA,IAClD;AAEA,aAAS,WAAW;AAChB,YAAM,IAAI,MAAM,+BAA+B,MAAM,MAAM,KAAK,EAAE,GAAG,MAAM,MAAM,IAAI,EAChF,KAAK,MAAM;AACR;AACA;AACA,aAAK;AAAA,UACD,OAAO;AAAA,UACP,MAAM;AAAA,QACtB,CAAa;AAAA,MACb,CAAS,EACA,MAAM,CAAC,aAAa;AACjB,gBAAQ,IAAI,QAAQ;AACpB,aAAK;AAAA,UACD,OAAO;AAAA,UACP,MAAM;AAAA,QACtB,CAAa;AAAA,MACb,CAAS;AAAA,IACT;AAEA,aAAS,WAAW;AAChB,YAAM,KAAK,MAAM,6BAA6B,GAAG,MAAM,MAAM,IAAI,EAC5D,KAAK,MAAM;AACR;AACA,cAAM,MAAM,OAAO;AACnB;AACA,aAAK;AAAA,UACD,OAAO;AAAA,UACP,MAAM;AAAA,QACtB,CAAa;AAAA,MACb,CAAS,EACA,MAAM,CAAC,aAAa;AACjB,gBAAQ,IAAI,QAAQ;AACpB,aAAK;AAAA,UACD,OAAO;AAAA,UACP,MAAM;AAAA,QACtB,CAAa;AAAA,MACb,CAAS;AAAA,IACT;AAEA,aAAS,aAAa;AAClB,UAAI,MAAM,MAAM,gBAAgB,QAAQ;AACpC;MACH,WAAU,MAAM,MAAM,gBAAgB,UAAU;AAC7C;MACH;AAAA,IACL;AAEA,aAAS,SAAS;AACd,aAAO,OAAO,MAAM,MAAM,MAAM,IAAI;AACpC,YAAM,MAAM,cAAc;AAC1B;IACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}