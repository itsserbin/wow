{"version":3,"file":"BuyIn1ClickModal-90fee6f8.mjs","sources":["../../../resources/js/Pages/Public/Product/BuyIn1ClickModal.vue"],"sourcesContent":["<script setup>\nimport {ref} from \"vue\";\nimport {useGtm} from \"@gtm-support/vue-gtm\";\nimport {useStore} from \"vuex\";\nimport {vMaska} from \"@/Includes/maska\"\nimport eventTracking from \"@/Includes/eventTracking\";\n\nimport Modal from '@/Pages/Public/Components/Modal.vue';\nimport Input from '@/Pages/Public/Components/Input.vue';\nimport InputError from '@/Components/Form/InputError.vue';\nimport Label from '@/Pages/Public/Components/Label.vue';\n\nconst emits = defineEmits(['closeModal', 'addToCard']);\nconst props = defineProps([\n    'item',\n    'product',\n    'eventIdPurchaseIn1Click',\n    'eventIdAddToCard',\n    'isAddToCart'\n]);\n\nconst gtm = useGtm();\n\nconst order = ref({\n    name: '',\n    last_name: '',\n    middle_name: '',\n    email: null,\n    comment: null,\n    phone: null,\n    city: null,\n    postal_office: null,\n    payment_method: null,\n    event_id: props.eventIdPurchaseIn1Click\n});\n\nconst state = ref({\n    isLoading: false,\n    errors: [],\n    contentIds: [],\n    ga4ProductsArray: []\n});\n\nconst store = useStore();\n\nasync function sendForm() {\n    state.value.errors = [];\n    state.value.isLoading = true;\n\n    if (!props.isAddToCart) {\n        await axios.post(route('api.v1.cart.add'), props.item)\n            .then(() => {\n                props.isAddToCart = true;\n                if (import.meta.env.MODE === 'production') {\n                    try {\n                        eventTracking(\n                            'AddToCart',\n                            {\n                                \"value\": props.product.discount_price ? props.product.discount_price : props.product.price,\n                                \"currency\": \"UAH\",\n                                \"content_type\": \"product\",\n                                \"content_ids\": [props.item.item_id],\n                                \"content_name\": props.product.h1\n                            },\n                            props.eventIdAddToCard\n                        )\n                    } catch (e) {\n                        console.error(e);\n                    }\n                }\n                store.commit('loadCart');\n                createOrder();\n            })\n    } else {\n        await createOrder();\n    }\n}\n\nasync function createOrder() {\n    await axios.post(route('api.v1.orders.create.1click'), order.value)\n        .then(({data}) => {\n            if (import.meta.env.MODE === 'production') {\n                try {\n                    store.state.list.forEach((item) => {\n                        state.value.contentIds.push(item.id);\n                        state.value.ga4ProductsArray.push({\n                            item_name: item.name.ua ? item.name.ua : item.name.ru,\n                            item_id: item.id,\n                            price: item.discount_price ? item.discount_price : item.price,\n                            quantity: item.count\n                        })\n                    });\n\n                    eventTracking(\n                        'Purchase',\n                        {\n                            \"value\": store.state.totalPrice,\n                            \"currency\": \"UAH\",\n                            \"content_type\": \"product\",\n                            \"num_items\": store.state.totalCount,\n                            \"content_ids\": state.value.contentIds\n                        },\n                        props.eventIdPurchaseIn1Click\n                    )\n\n                    gtm.trackEvent({\n                        event: 'send_order',\n                        ecommerce: {\n                            transaction_id: data.order.id,\n                            value: data.order.total_price,\n                            currency: \"UAH\",\n                            items: state.value.ga4ProductsArray\n                        }\n                    });\n                } catch (e) {\n                    console.log(e);\n                }\n            }\n            axios.post(route('sms.new.order'), {\n                order_id: data.order.id,\n                phone: data.order.client.phone,\n            })\n            state.value.isLoading = false;\n            if (typeof window !== \"undefined\") {\n                window.location.href = route('thanks', data.order.id);\n            }\n        })\n        .catch(({response}) => {\n            state.value.errors = response.data;\n            state.value.isLoading = false;\n        });\n}\n</script>\n\n<template>\n    <Modal size=\"small\"\n           submit-button-text=\"Замовити\"\n           @submitForm=\"sendForm\"\n           @closeModal=\"$emit('closeModal')\"\n           :is-loading=\"state.isLoading\"\n    >\n        <template #content>\n            <div class=\"grid gap-4\">\n                <div class=\"block\">\n                    <Label>Ім`я</Label>\n                    <Input type=\"text\"\n                           v-model=\"order.name\"\n                           placeholder=\"Введіть ваше ім'я\"\n                    />\n                </div>\n                <div class=\"block\">\n                    <Label :required=\"true\">Ваш телефон</Label>\n                    <Input type=\"tel\"\n                           v-maska\n                           data-maska=\"+38 (0##) ###-##-##\"\n                           v-model=\"order.phone\"\n                           placeholder=\"+38 (0\"\n                           class=\"phone\"\n                    />\n                    <InputError v-if=\"state.errors.phone\" v-for=\"error in state.errors.phone\" :message=\"error\"/>\n                </div>\n            </div>\n        </template>\n    </Modal>\n</template>\n"],"names":[],"mappings":"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"}