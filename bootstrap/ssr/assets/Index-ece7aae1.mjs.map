{"version":3,"file":"Index-ece7aae1.mjs","sources":["../../../resources/js/Pages/Admin/Statistics/Orders/Index.vue"],"sourcesContent":["<script setup>\nimport {onMounted, inject, ref, computed} from \"vue\";\nimport {endOfMonth, startOfMonth} from \"date-fns\";\n\nimport Loader from '@/Components/Loader.vue';\nimport Label from '@/Components/Form/Label.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Chart from '@/Pages/Admin/Statistics/Chart.vue';\nimport Table from '@/Pages/Admin/Statistics/Orders/Table.vue';\nimport Indicators from '@/Pages/Admin/Statistics/Orders/Indicators.vue';\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\n\nconst can = inject('$can');\n\nconst state = ref({\n    orders: [],\n    chart: null,\n    indicators: null,\n    isLoading: true,\n});\n\n\nconst params = ref({\n    date: [],\n    currentPage: 1,\n})\n\nconst costCategoriesOptions = ref([]);\n\nconst getParams = computed(() => {\n    const data = {};\n    if (params.value.date.length === 2) {\n        data.date_start = params.value.date[0].toLocaleDateString();\n        data.date_end = params.value.date[1].toLocaleDateString();\n    }\n    data.page = params.value.currentPage;\n    return data;\n\n})\n\nonMounted(() => {\n    params.value.date[0] = startOfMonth(new Date());\n    params.value.date[1] = endOfMonth(new Date());\n\n    fetch();\n})\n\nfunction paginate(page) {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    fetch();\n}\n\nfunction fetch() {\n    state.value.isLoading = true;\n    axios.get(route('api.statistics.orders.index', getParams.value))\n        .then(({data}) => {\n            state.value.orders = data;\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        });\n\n    axios.get(route('api.statistics.orders.chart', getParams.value))\n        .then(({data}) => state.value.chart = data.result)\n        .catch((response) => console.log(response));\n\n    axios.get(route('api.statistics.orders.indicators', getParams.value))\n        .then(({data}) => state.value.indicators = data.result)\n        .catch((response) => console.log(response));\n\n}\n</script>\n\n<template>\n    <StatisticLayout title=\"Статистика заявок\">\n        <template #header>\n            Статистика заявок\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-bookkeeping-orders')\" class=\"grid grid-cols-1 gap-4\">\n\n            <div class=\"block\">\n                <Label value=\"Фільтр по даті\"/>\n                <DatepickerComponent v-model=\"params.date\"\n                                     @update:modelValue=\"fetch\"\n                />\n            </div>\n\n            <Chart v-if=\"state.chart\" :chart-data=\"state.chart\"/>\n\n            <Indicators :data=\"state.indicators\"/>\n\n            <Table :data=\"state.orders.result.data\"/>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.orders.result\"\n                          :click-handler=\"fetch\"\n                          v-model=\"params.currentPage\"\n                />\n            </div>\n        </div>\n    </StatisticLayout>\n</template>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,UAAM,MAAM,OAAO,MAAM;AAEzB,UAAM,QAAQ,IAAI;AAAA,MACd,QAAQ,CAAE;AAAA,MACV,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,WAAW;AAAA,IACf,CAAC;AAGD,UAAM,SAAS,IAAI;AAAA,MACf,MAAM,CAAE;AAAA,MACR,aAAa;AAAA,IACjB,CAAC;AAE6B,QAAI,EAAE;AAEpC,UAAM,YAAY,SAAS,MAAM;AAC7B,YAAM,OAAO,CAAA;AACb,UAAI,OAAO,MAAM,KAAK,WAAW,GAAG;AAChC,aAAK,aAAa,OAAO,MAAM,KAAK,CAAC,EAAE;AACvC,aAAK,WAAW,OAAO,MAAM,KAAK,CAAC,EAAE;MACxC;AACD,WAAK,OAAO,OAAO,MAAM;AACzB,aAAO;AAAA,IAEX,CAAC;AAED,cAAU,MAAM;AACZ,aAAO,MAAM,KAAK,CAAC,IAAI,aAAa,oBAAI,KAAI,CAAE;AAC9C,aAAO,MAAM,KAAK,CAAC,IAAI,WAAW,oBAAI,KAAI,CAAE;AAE5C;IACJ,CAAC;AASD,aAAS,QAAQ;AACb,YAAM,MAAM,YAAY;AACxB,YAAM,IAAI,MAAM,+BAA+B,UAAU,KAAK,CAAC,EAC1D,KAAK,CAAC,EAAC,KAAI,MAAM;AACd,cAAM,MAAM,SAAS;AACrB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS,EACA,MAAM,YAAU;AACb,gBAAQ,IAAI,MAAM;AAClB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS;AAEL,YAAM,IAAI,MAAM,+BAA+B,UAAU,KAAK,CAAC,EAC1D,KAAK,CAAC,EAAC,KAAI,MAAM,MAAM,MAAM,QAAQ,KAAK,MAAM,EAChD,MAAM,CAAC,aAAa,QAAQ,IAAI,QAAQ,CAAC;AAE9C,YAAM,IAAI,MAAM,oCAAoC,UAAU,KAAK,CAAC,EAC/D,KAAK,CAAC,EAAC,KAAI,MAAM,MAAM,MAAM,aAAa,KAAK,MAAM,EACrD,MAAM,CAAC,aAAa,QAAQ,IAAI,QAAQ,CAAC;AAAA,IAElD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}