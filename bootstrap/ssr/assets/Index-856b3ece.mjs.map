{"version":3,"file":"Index-856b3ece.mjs","sources":["../../../resources/js/Pages/Admin/Crm/Clients/Index.vue"],"sourcesContent":["<script setup>\nimport Indicators from '@/Pages/Admin/Crm/Clients/Indicators.vue';\nimport Modal from '@/Pages/Admin/Crm/Clients/Modal.vue';\nimport Table from '@/Pages/Admin/Crm/Clients/Table.vue';\nimport CrmLayout from '@/Pages/Admin/Crm/CrmLayout.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Sidebar from '@/Components/Sidebar/Sidebar.vue';\nimport SidebarItem from '@/Components/Sidebar/SidebarItem.vue';\nimport Search from '@/Components/Search.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\n\nimport {computed, inject, onMounted, ref} from \"vue\";\nimport ClientsRepository from \"@/Repositories/ClientsRepository\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst props = defineProps([\n    'statuses',\n    'subStatuses',\n    'orderStatuses'\n]);\n\nconst {t} = useI18n();\nconst can = inject('$can');\n\nconst sidebar = ref([]);\n\nconst exportSidebar = [\n    {\n        title: t('clients.export'),\n        key: 'export'\n    }\n];\n\nconst state = ref({\n    data: [],\n    indicators: {},\n    isLoading: true,\n    isActiveEditModal: false,\n    sidebarActive: 'all',\n    modal: {}\n});\n\nconst params = ref({\n    status: null,\n    currentPage: 1,\n    orderBy: {\n        key: null,\n        val: null\n    },\n    date: [],\n})\n\nconst dateRange = computed(() => {\n    if (params.value.date.length === 2) {\n        return {\n            date_start: params.value.date[0].toLocaleDateString(),\n            date_end: params.value.date[1].toLocaleDateString()\n        }\n    }\n});\n\nconst getParams = computed(() => {\n    const {currentPage, status = null, orderBy = null} = params.value;\n    return {page: currentPage, status, orderBy, ...dateRange.value};\n});\n\nconst orderBy = (key, val) => {\n    params.value.orderBy = {\n        key: key,\n        val: val\n    }\n    params.value.currentPage = 1;\n    fetch();\n}\n\nonMounted(() => {\n    fetch();\n\n    sidebar.value.push({title: t('clients.all_clients'), key: 'all'});\n    for (const [key, value] of Object.entries(props.statuses)) {\n        sidebar.value.push({\n            title: value,\n            key: key,\n        })\n    }\n\n    if (route().params.id) {\n        state.value.isLoading = true;\n        onEdit(route().params.id);\n    }\n});\n\nconst editModal = computed(() => state.value.isActiveEditModal ? Modal : null);\n\nconst exportFunction = (key) => {\n    if (key === 'export') {\n        window.location.href = route('admin.crm.clients.export');\n    }\n}\n\nconst search = async (query) => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.search(query);\n    if (data.success) {\n        state.value.sidebarActive = null;\n        params.value.currentPage = 1;\n        state.value.data = data.result;\n        state.value.isLoading = false;\n    }\n    state.value.isLoading = false;\n}\n\nconst sortByStatus = (status) => {\n    state.value.sidebarActive = status;\n    params.value.status = status === 'all' ? null : status;\n    params.value.date = [];\n    params.value.currentPage = 1;\n    fetch();\n}\n\nconst sortByDate = async () => {\n    params.value.currentPage = 1;\n    await fetch();\n}\n\nconst paginate = async (page) => {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    await fetch();\n}\n\nconst fetch = async () => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.fetch(getParams.value);\n    if (data.success) {\n        state.value.indicators = data.indicators;\n        state.value.data = data.result;\n        state.value.isLoading = false;\n    }\n}\n\nconst destroy = async (id) => {\n    if (can('destroy-clients')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n\n        if (result.isConfirmed) {\n            const {success} = await ClientsRepository.destroy(id);\n            if (success) {\n                state.value.isLoading = false;\n                await fetch();\n                if (state.value.isActiveEditModal) {\n                    editModalFunction();\n                }\n                swal({\n                    title: t('swal.destroyed'),\n                    icon: 'success'\n                })\n            }\n        }\n    }\n}\n\nconst onEdit = async (id, i) => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.edit(id);\n    if (data.success) {\n        state.value.modal.index = i;\n        state.value.modal = data.result;\n        editModalFunction();\n        state.value.isLoading = false;\n    }\n}\n\nconst onUpdate = async () => {\n    const data = await ClientsRepository.update(state.value.modal);\n\n    if (data.success) {\n        editModalFunction();\n        await fetch();\n        swal({\n            title: t('swal.updated'),\n            icon: 'success'\n        })\n    }\n}\n\nconst editModalFunction = () => {\n    state.value.isActiveEditModal = !state.value.isActiveEditModal;\n}\n</script>\n\n<template>\n    <CrmLayout :title=\"$t('clients.page_title')\">\n        <template #header>{{ $t('clients.page_title') }}</template>\n\n        <div v-if=\"can('show-clients')\">\n            <div class=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n                <div class=\"md:col-span-1\">\n                    <Sidebar class=\"mb-5\">\n                        <SidebarItem v-if=\"sidebar.length\"\n                                     v-for=\"item in sidebar\"\n                                     @click=\"sortByStatus(item.key)\"\n                                     :active=\"state.sidebarActive === item.key\"\n                        >\n                            {{ item.title }}\n                        </SidebarItem>\n                    </Sidebar>\n\n                    <Sidebar v-if=\"can('export-orders')\">\n                        <SidebarItem v-if=\"exportSidebar.length\"\n                                     v-for=\"item in exportSidebar\"\n                                     @click=\"exportFunction(item.key)\"\n                        >\n                            {{ item.title }}\n                        </SidebarItem>\n                    </Sidebar>\n                </div>\n\n\n                <div class=\"md:col-span-4\">\n                    <Loader v-if=\"state.isLoading\"/>\n                    <div v-if=\"!state.isLoading\" class=\"w-full grid grid-cols-1 gap-4\">\n                        <DatepickerComponent v-model=\"params.date\"\n                                             @update:modelValue=\"sortByDate\"\n                        />\n                        <Indicators :data=\"state.indicators\"/>\n                        <Search @search=\"search\"\n                                :clear=\"true\"\n                                :placeholder=\"$t('clients.search_placeholder')\"\n                        />\n                        <Table :data=\"state.data.data\"\n                               @onEdit=\"onEdit\"\n                               @onDestroy=\"destroy\"\n                               @orderBy=\"orderBy\"\n                               :statuses=\"statuses\"\n                               :canDestroy=\"can('destroy-clients')\"\n                        />\n                        <div class=\"text-center\">\n                            <Paginate :pagination=\"state.data\"\n                                      :click-handler=\"paginate\"\n                                      v-model=\"params.currentPage\"\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <component :is=\"editModal\"\n                       :item=\"state.modal\"\n                       :statuses=\"statuses\"\n                       :sub-statuses=\"subStatuses\"\n                       :order-statuses=\"orderStatuses\"\n                       size=\"extralarge\"\n                       @closeModal=\"editModalFunction\"\n                       @declineForm=\"destroy\"\n                       @submitForm=\"onUpdate\"\n                       :canDestroy=\"can('destroy-clients')\"\n            ></component>\n        </div>\n    </CrmLayout>\n</template>\n"],"names":["orderBy","Modal"],"mappings":"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"}