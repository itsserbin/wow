{"version":3,"file":"Index-19fcf01e.mjs","sources":["../../../resources/js/Repositories/PagesRepository.js","../../../resources/js/Pages/Admin/Content/Pages/Index.vue"],"sourcesContent":["export default {\n    async fetch(params) {\n        try {\n            const response = await axios.get(route('api.pages.index', params));\n            return response.data;\n        } catch (error) {\n            throw new Error(error.response.data);\n        }\n    },\n    async destroy(id) {\n        try {\n            const response = await axios.delete(route('api.pages.destroy', id));\n            return response.data;\n        } catch (error) {\n            throw new Error(error.response.data);\n        }\n    },\n    async edit(id) {\n        try {\n            const response = await axios.get(route('api.pages.edit', id));\n            return response.data;\n        } catch (error) {\n            throw new Error(error.response.data);\n        }\n    },\n    async update(item) {\n        try {\n            const response = await axios.put(route('api.pages.update', item.id), item);\n            return response.data;\n        } catch (error) {\n            return error.response.data;\n        }\n    },\n    async create(item) {\n        try {\n            const response = await axios.post(route('api.pages.create'), item);\n            return response.data;\n        } catch (error) {\n            return error.response.data;\n        }\n    },\n};\n","<script setup>\nimport Loader from '@/Components/Loader.vue';\nimport Button from '@/Components/Button.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Modal from '@/Pages/Admin/Content/Pages/Modal.vue';\nimport Table from '@/Pages/Admin/Content/Pages/Table.vue'\nimport ContentLayout from '@/Pages/Admin/Content/ContentLayout.vue'\nimport {swal} from \"@/Includes/swal\";\n\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport PagesRepository from \"@/Repositories/PagesRepository\";\nimport {useI18n} from 'vue-i18n'\n\nconst can = inject('$can');\nconst {t} = useI18n();\n\nconst item = reactive({\n    slug: null,\n    published: 0,\n    heading: {\n        ru: null,\n        ua: null\n    },\n    h1: {\n        ru: null,\n        ua: null\n    },\n    content: {\n        ru: null,\n        ua: null\n    },\n    meta_title: {\n        ru: null,\n        ua: null\n    },\n    meta_description: {\n        ru: null,\n        ua: null\n    }\n})\n\nconst state = ref({\n    data: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    errors: [],\n    item: {},\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nconst fetch = async (page) => {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    const data = await PagesRepository.fetch({'page': state.value.currentPage});\n    state.value.data = data.success ? data.result : [];\n    state.value.isLoading = false;\n}\n\nconst onDestroy = async (id) => {\n    if (can('destroy-pages')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n        if (result.isConfirmed) {\n            const {success} = await PagesRepository.destroy(id);\n            if (success) {\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    icon: 'success',\n                    title: t('swal.destroyed')\n                });\n            }\n        }\n    }\n}\n\nconst modalFunction = () => {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nconst onEdit = async (id, i) => {\n    if (can('edit-pages')) {\n        const data = await PagesRepository.edit(id);\n        if (data.success) {\n            state.value.item = data.result;\n            state.value.modalAction = 'edit';\n            state.value.item.index = i;\n            modalFunction();\n        }\n    }\n}\n\nconst onUpdate = async () => {\n    if (can('edit-pages')) {\n        const data = await PagesRepository.update(state.value.item);\n        if (data.success) {\n            modalFunction();\n            await fetch();\n            await swal({\n                title: t('swal.updated'),\n                icon: 'success'\n            })\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                icon: 'error',\n                text: t('swal.check_data')\n            })\n        }\n    }\n}\n\nconst onCreate = async () => {\n    if (can('create-pages')) {\n        const data = await PagesRepository.create(state.value.item);\n        if (data.success) {\n            modalFunction();\n            state.value.item = {};\n            await fetch();\n            await swal({\n                title: t('swal.created'),\n                icon: 'success'\n            });\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                text: t('swal.check_data'),\n                icon: 'error'\n            })\n        }\n    }\n}\n\nconst submitForm = async () => {\n    if (state.value.modalAction === 'edit' && can('edit-pages')) {\n        await onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-pages')) {\n        await onCreate();\n    }\n}\n\nconst create = () => {\n    if (can('create-pages')) {\n        state.value.item = item;\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n</script>\n\n<template>\n    <ContentLayout :title=\"$t('pages.page_title')\">\n        <template #header>{{ $t('pages.page_title') }}</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-pages')\" class=\"grid gap-4 grid-cols-1\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-pages')\">\n                    {{ $t('add') }}\n                </Button>\n            </div>\n\n            <div>\n                <Table :data=\"state.data.data\"\n                       @onEdit=\"onEdit\"\n                       @onDestroy=\"onDestroy\"\n                       :canDestroy=\"can('destroy-pages')\"\n                />\n            </div>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.data\"\n                          :click-handler=\"fetch\"\n                          v-model=\"state.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   :canDestroy=\"can('destroy-pages')\"\n        ></component>\n    </ContentLayout>\n</template>\n"],"names":["Modal"],"mappings":"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"}