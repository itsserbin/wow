{"version":3,"file":"Index-bc4bba34.mjs","sources":["../../../resources/js/Pages/Admin/Statistics/Managers/Index.vue"],"sourcesContent":["<script setup>\nimport {onMounted, inject, ref, computed} from \"vue\";\nimport {endOfMonth, startOfMonth} from 'date-fns';\n\nimport Paginate from '@/Components/Paginate.vue';\nimport Card from '@/Components/Card.vue';\nimport Button from '@/Components/Button.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Label from '@/Components/Form/Label.vue';\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue';\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue';\nimport Table from '@/Pages/Admin/Statistics/Managers/Table.vue';\nimport Multiselect from '@/Components/Multiselect/Multiselect.vue';\n\nconst can = inject('$can');\n\nconst state = ref({\n    data: [],\n    managers: [],\n    isLoading: true,\n});\n\nconst managers = ref([]);\n\nconst endPoint = computed(() => {\n    const data = {};\n    if (params.value.date.length === 2) {\n        data.date_start = params.value.date[0].toLocaleDateString();\n        data.date_end = params.value.date[1].toLocaleDateString();\n    }\n    if (managersArray.value) {\n        data.managers = managersArray.value;\n    }\n    data.page = params.value.currentPage;\n    return route('api.statistics.managers.index', data);\n\n})\n\nconst managersArray = computed(() => {\n    let managers = [];\n    state.value.managers.forEach((item) => {\n        managers.push(item.id)\n    })\n\n    return managers.join();\n})\n\nconst params = ref({\n    date: [],\n    managers: [],\n    currentPage: 1,\n})\n\nonMounted(() => {\n    params.value.date[0] = startOfMonth(new Date());\n    params.value.date[1] = endOfMonth(new Date());\n\n    fetch();\n\n    axios.get(route('api.users.list.managers'))\n        .then(({data}) => managers.value = data.result)\n        .catch((response) => console.log(response))\n})\n\nfunction fetchClear() {\n    params.value.managers = [];\n    params.value.date = [];\n    params.value.managers = [];\n    state.value.managers = [];\n    fetch();\n}\n\nfunction paginate(page) {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    fetch();\n}\n\nfunction fetch() {\n    state.value.isLoading = true;\n    axios.get(endPoint.value)\n        .then(({data}) => {\n            state.value.data = data;\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        })\n}\n</script>\n\n<template>\n    <StatisticLayout title=\"Статистика для менеджерів\">\n        <template #header>\n            Статистика для менеджерів\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-bookkeeping-managers')\" class=\"grid grid-cols-1 gap-4\">\n\n            <div class=\"grid grid-cols-1 md:grid-cols-12 gap-4 mt-5\">\n                <div class=\"block col-span-2 text-center\">\n                    <Label value=\"&nbsp;\"/>\n                    <Button type=\"button\" @click=\"fetchClear\">\n                        Очистити\n                    </Button>\n                </div>\n                <div class=\"block col-span-4\">\n                    <Label value=\"Фільтр по даті\"/>\n                    <DatepickerComponent v-model=\"params.date\"/>\n                </div>\n\n                <div class=\"block col-span-4\">\n                    <Label value=\"Фільтр по менеджерам\"/>\n                    <multiselect\n                        v-model=\"state.managers\"\n                        :options=\"managers\"\n                        label=\"name\"\n                        placeholder=\"Оберіть менеджерів\"\n                        track-by=\"id\"\n                        :searchable=\"true\"\n                        :close-on-select=\"false\"\n                        multiple\n                    />\n                </div>\n\n                <div class=\"block col-span-2 text-center\">\n                    <Label value=\"&nbsp;\"/>\n                    <Button type=\"button\" @click=\"fetch\">\n                        Пошук\n                    </Button>\n                </div>\n            </div>\n\n            <div class=\"grid grid-cols-2 md:grid-cols-4\">\n                <Card v-for=\"(item,i) in state.data.generalStat\"\n                      class=\"text-center\"\n                      :title=\"i\"\n                      :description=\"item\"\n                >\n                </Card>\n            </div>\n\n            <Table :data=\"state.data.result.data\"/>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.data.result\"\n                          :click-handler=\"fetch\"\n                          v-model=\"params.currentPage\"\n                />\n            </div>\n        </div>\n    </StatisticLayout>\n</template>\n"],"names":["managers"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAcA,UAAM,MAAM,OAAO,MAAM;AAEzB,UAAM,QAAQ,IAAI;AAAA,MACd,MAAM,CAAE;AAAA,MACR,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,IACf,CAAC;AAED,UAAM,WAAW,IAAI,CAAA,CAAE;AAEvB,UAAM,WAAW,SAAS,MAAM;AAC5B,YAAM,OAAO,CAAA;AACb,UAAI,OAAO,MAAM,KAAK,WAAW,GAAG;AAChC,aAAK,aAAa,OAAO,MAAM,KAAK,CAAC,EAAE;AACvC,aAAK,WAAW,OAAO,MAAM,KAAK,CAAC,EAAE;MACxC;AACD,UAAI,cAAc,OAAO;AACrB,aAAK,WAAW,cAAc;AAAA,MACjC;AACD,WAAK,OAAO,OAAO,MAAM;AACzB,aAAO,MAAM,iCAAiC,IAAI;AAAA,IAEtD,CAAC;AAED,UAAM,gBAAgB,SAAS,MAAM;AACjC,UAAIA,YAAW,CAAA;AACf,YAAM,MAAM,SAAS,QAAQ,CAAC,SAAS;AACnC,QAAAA,UAAS,KAAK,KAAK,EAAE;AAAA,MAC7B,CAAK;AAED,aAAOA,UAAS;IACpB,CAAC;AAED,UAAM,SAAS,IAAI;AAAA,MACf,MAAM,CAAE;AAAA,MACR,UAAU,CAAE;AAAA,MACZ,aAAa;AAAA,IACjB,CAAC;AAED,cAAU,MAAM;AACZ,aAAO,MAAM,KAAK,CAAC,IAAI,aAAa,oBAAI,KAAI,CAAE;AAC9C,aAAO,MAAM,KAAK,CAAC,IAAI,WAAW,oBAAI,KAAI,CAAE;AAE5C;AAEA,YAAM,IAAI,MAAM,yBAAyB,CAAC,EACrC,KAAK,CAAC,EAAC,KAAI,MAAM,SAAS,QAAQ,KAAK,MAAM,EAC7C,MAAM,CAAC,aAAa,QAAQ,IAAI,QAAQ,CAAC;AAAA,IAClD,CAAC;AAED,aAAS,aAAa;AAClB,aAAO,MAAM,WAAW;AACxB,aAAO,MAAM,OAAO;AACpB,aAAO,MAAM,WAAW;AACxB,YAAM,MAAM,WAAW;AACvB;IACJ;AASA,aAAS,QAAQ;AACb,YAAM,MAAM,YAAY;AACxB,YAAM,IAAI,SAAS,KAAK,EACnB,KAAK,CAAC,EAAC,KAAI,MAAM;AACd,cAAM,MAAM,OAAO;AACnB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS,EACA,MAAM,YAAU;AACb,gBAAQ,IAAI,MAAM;AAClB,cAAM,MAAM,YAAY;AAAA,MACpC,CAAS;AAAA,IACT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}