{"version":3,"file":"Index-7fc2a0ed.js","sources":["../../../resources/js/Pages/Admin/Crm/Invoices/Index.vue"],"sourcesContent":["<script setup>\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {swal} from \"@/Includes/swal\";\n\nimport Paginate from '@/Components/Paginate.vue';\nimport Button from '@/Components/Button.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Sidebar from '@/Components/Sidebar/Sidebar.vue';\nimport SidebarItem from '@/Components/Sidebar/SidebarItem.vue';\nimport Modal from '@/Pages/Admin/Crm/Invoices/Modal.vue';\nimport Table from '@/Pages/Admin/Crm/Invoices/Table.vue';\nimport CrmLayout from '@/Pages/Admin/Crm/CrmLayout.vue';\n\nconst props = defineProps(['statuses']);\nconst can = inject('$can');\n\nconst item = reactive({\n    order_id: null,\n    sum: null,\n})\n\nconst state = ref({\n    data: [],\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: {},\n    sidebarActive: 'all',\n});\n\nconst sidebar = ref([]);\n\nconst params = ref({\n    status: null,\n    currentPage: 1,\n})\n\nconst getParams = computed(() => {\n    const data = {};\n    data.page = params.value.currentPage;\n    if (params.value.status) {\n        data.status = params.value.status;\n    }\n    return data;\n})\n\n\nonMounted(() => {\n    fetch(1);\n\n    sidebar.value.push({title: 'Всі', key: 'all'});\n    for (const [key, value] of Object.entries(props.statuses)) {\n        sidebar.value.push({\n            title: value,\n            key: key,\n        })\n    }\n\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nfunction sortByStatus(status) {\n    state.value.sidebarActive = status;\n    if (status === 'all') {\n        params.value.status = null\n    } else {\n        params.value.status = status\n    }\n    params.value.currentPage = 1;\n    fetch();\n}\n\nfunction fetch(page) {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    axios.get(route('api.invoices.index', getParams.value))\n        .then(({data}) => {\n            state.value.data = data.result;\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        })\n}\n\nfunction onDestroy(id) {\n    if (can('destroy-invoices')) {\n        swal({\n            title: 'Видалити?',\n            icon: 'warning',\n            showCancelButton: true,\n        }).then((result) => {\n            if (result.isConfirmed) {\n                axios.delete(route('api.invoices.destroy', id))\n                    .then(() => {\n                        fetch();\n                        if (state.value.isActiveModal) {\n                            modalFunction();\n                        }\n                        swal({\n                            icon: 'success',\n                            title: 'Destroyed!'\n                        })\n                    })\n                    .catch(errors => {\n                        console.log(errors);\n                        swal({\n                            icon: 'error',\n                            title: 'Error!'\n                        })\n                    })\n            }\n        })\n\n    }\n}\n\nfunction modalFunction() {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nfunction onEdit(id, i) {\n    if (can('edit-invoices')) {\n        axios.get(route('api.invoices.edit', id))\n            .then(({data}) => {\n                state.value.item = data.result;\n                state.value.modalAction = 'edit';\n                state.value.item.index = i;\n                modalFunction();\n            })\n            .catch((response) => console.log(response))\n    }\n}\n\nfunction onUpdate() {\n    if (can('edit-invoices')) {\n        axios.put(route('api.invoices.update', state.value.item.id), state.value.item)\n            .then(() => {\n                modalFunction();\n                fetch();\n                swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction onCreate() {\n    if (can('create-invoices')) {\n        axios.post(route('api.invoices.create'), state.value.item)\n            .then(({data}) => {\n                state.value.item = data.result;\n                state.value.modalAction = 'edit';\n                modalFunction();\n                fetch();\n                navigator.clipboard.writeText(data.result.data.invoice_url);\n                swal({\n                    title: 'Успішно!',\n                    text: 'Рахунок був успішно створений, посилання на оплату скопійовано в буфер обміну',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction submitForm() {\n    if (state.value.modalAction === 'edit' && can('edit-invoices')) {\n        onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-invoices')) {\n        onCreate();\n    }\n}\n\nfunction create() {\n    if (can('create-invoices')) {\n        state.value.item = item;\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n\nfunction onSendInvoiceSms() {\n    swal({\n        title: 'Успішно',\n        text: 'Посилання на оплату надіслано клієнту',\n        icon: 'success'\n    });\n    fetch();\n}\n</script>\n\n<template>\n    <CrmLayout title=\"Рахунки\">\n        <template #header>Рахунки</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-invoices')\">\n            <div class=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n\n                <div class=\"md:col-span-1\">\n                    <Sidebar>\n                        <SidebarItem v-if=\"sidebar.length\"\n                                     v-for=\"item in sidebar\"\n                                     @click=\"sortByStatus(item.key)\"\n                                     :active=\"state.sidebarActive === item.key\"\n                        >\n                            {{ item.title }}\n                        </SidebarItem>\n                    </Sidebar>\n                </div>\n\n                <div class=\"w-full md:col-span-4 grid gap-4 grid-cols-1\">\n                    <div>\n                        <Button type=\"btn\" @click=\"create\" v-if=\"can('create-invoices')\">\n                            Додати\n                        </Button>\n                    </div>\n\n                    <Table :data=\"state.data.data\"\n                           :statuses=\"statuses\"\n                           @onEdit=\"onEdit\"\n                           @onDestroy=\"onDestroy\"\n                           :can-destroy=\"can('destroy-invoices')\"\n                           @onSendInvoiceSms=\"onSendInvoiceSms\"\n                    />\n\n                    <div class=\"text-center\">\n                        <Paginate :pagination=\"state.data\"\n                                  :click-handler=\"fetch\"\n                                  v-model=\"params.currentPage\"\n                        />\n                    </div>\n                </div>\n            </div>\n\n            <component :is=\"activeModal\"\n                       :item=\"state.item\"\n                       @closeModal=\"modalFunction\"\n                       @submitForm=\"submitForm\"\n                       @declineForm=\"onDestroy\"\n                       :statuses=\"statuses\"\n                       :can-destroy=\"can('destroy-invoices')\"\n            ></component>\n        </div>\n    </CrmLayout>\n</template>\n"],"names":["can","inject","item","reactive","state","ref","sidebar","params","getParams","computed","data","onMounted","fetch","key","value","props","activeModal","Modal","sortByStatus","status","page","errors","onDestroy","id","swal","result","modalFunction","onEdit","i","response","onUpdate","onCreate","submitForm","create","onSendInvoiceSms"],"mappings":"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"}