{"version":3,"file":"Index-74646af3.js","sources":["../../../resources/js/Pages/Admin/Crm/Clients/Index.vue"],"sourcesContent":["<script setup>\nimport Indicators from '@/Pages/Admin/Crm/Clients/Indicators.vue';\nimport Modal from '@/Pages/Admin/Crm/Clients/Modal.vue';\nimport Table from '@/Pages/Admin/Crm/Clients/Table.vue';\nimport CrmLayout from '@/Pages/Admin/Crm/CrmLayout.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Sidebar from '@/Components/Sidebar/Sidebar.vue';\nimport SidebarItem from '@/Components/Sidebar/SidebarItem.vue';\nimport Search from '@/Components/Search.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\n\nimport {computed, inject, onMounted, ref} from \"vue\";\nimport ClientsRepository from \"@/Repositories/ClientsRepository\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst props = defineProps([\n    'statuses',\n    'subStatuses',\n    'orderStatuses'\n]);\n\nconst {t} = useI18n();\nconst can = inject('$can');\n\nconst sidebar = ref([]);\n\nconst exportSidebar = [\n    {\n        title: t('clients.export'),\n        key: 'export'\n    }\n];\n\nconst state = ref({\n    data: [],\n    indicators: {},\n    isLoading: true,\n    isActiveEditModal: false,\n    sidebarActive: 'all',\n    modal: {}\n});\n\nconst params = ref({\n    status: null,\n    currentPage: 1,\n    orderBy: {\n        key: null,\n        val: null\n    },\n    date: [],\n})\n\nconst dateRange = computed(() => {\n    if (params.value.date.length === 2) {\n        return {\n            date_start: params.value.date[0].toLocaleDateString(),\n            date_end: params.value.date[1].toLocaleDateString()\n        }\n    }\n});\n\nconst getParams = computed(() => {\n    const {currentPage, status = null, orderBy = null} = params.value;\n    return {page: currentPage, status, orderBy, ...dateRange.value};\n});\n\nconst orderBy = (key, val) => {\n    params.value.orderBy = {\n        key: key,\n        val: val\n    }\n    params.value.currentPage = 1;\n    fetch();\n}\n\nonMounted(() => {\n    fetch();\n\n    sidebar.value.push({title: t('clients.all_clients'), key: 'all'});\n    for (const [key, value] of Object.entries(props.statuses)) {\n        sidebar.value.push({\n            title: value,\n            key: key,\n        })\n    }\n\n    if (route().params.id) {\n        state.value.isLoading = true;\n        onEdit(route().params.id);\n    }\n});\n\nconst editModal = computed(() => state.value.isActiveEditModal ? Modal : null);\n\nconst exportFunction = (key) => {\n    if (key === 'export') {\n        window.location.href = route('admin.crm.clients.export');\n    }\n}\n\nconst search = async (query) => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.search(query);\n    if (data.success) {\n        state.value.sidebarActive = null;\n        params.value.currentPage = 1;\n        state.value.data = data.result;\n        state.value.isLoading = false;\n    }\n    state.value.isLoading = false;\n}\n\nconst sortByStatus = (status) => {\n    state.value.sidebarActive = status;\n    params.value.status = status === 'all' ? null : status;\n    params.value.date = [];\n    params.value.currentPage = 1;\n    fetch();\n}\n\nconst sortByDate = async () => {\n    params.value.currentPage = 1;\n    await fetch();\n}\n\nconst paginate = async (page) => {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    await fetch();\n}\n\nconst fetch = async () => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.fetch(getParams.value);\n    if (data.success) {\n        state.value.indicators = data.indicators;\n        state.value.data = data.result;\n        state.value.isLoading = false;\n    }\n}\n\nconst destroy = async (id) => {\n    if (can('destroy-clients')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n\n        if (result.isConfirmed) {\n            const {success} = await ClientsRepository.destroy(id);\n            if (success) {\n                state.value.isLoading = false;\n                await fetch();\n                if (state.value.isActiveEditModal) {\n                    editModalFunction();\n                }\n                swal({\n                    title: t('swal.destroyed'),\n                    icon: 'success'\n                })\n            }\n        }\n    }\n}\n\nconst onEdit = async (id, i) => {\n    state.value.isLoading = true;\n    const data = await ClientsRepository.edit(id);\n    if (data.success) {\n        state.value.modal.index = i;\n        state.value.modal = data.result;\n        editModalFunction();\n        state.value.isLoading = false;\n    }\n}\n\nconst onUpdate = async () => {\n    const data = await ClientsRepository.update(state.value.modal);\n\n    if (data.success) {\n        editModalFunction();\n        await fetch();\n        swal({\n            title: t('swal.updated'),\n            icon: 'success'\n        })\n    }\n}\n\nconst editModalFunction = () => {\n    state.value.isActiveEditModal = !state.value.isActiveEditModal;\n}\n</script>\n\n<template>\n    <CrmLayout :title=\"$t('clients.page_title')\">\n        <template #header>{{ $t('clients.page_title') }}</template>\n\n        <div v-if=\"can('show-clients')\">\n            <div class=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n                <div class=\"md:col-span-1\">\n                    <Sidebar class=\"mb-5\">\n                        <SidebarItem v-if=\"sidebar.length\"\n                                     v-for=\"item in sidebar\"\n                                     @click=\"sortByStatus(item.key)\"\n                                     :active=\"state.sidebarActive === item.key\"\n                        >\n                            {{ item.title }}\n                        </SidebarItem>\n                    </Sidebar>\n\n                    <Sidebar v-if=\"can('export-orders')\">\n                        <SidebarItem v-if=\"exportSidebar.length\"\n                                     v-for=\"item in exportSidebar\"\n                                     @click=\"exportFunction(item.key)\"\n                        >\n                            {{ item.title }}\n                        </SidebarItem>\n                    </Sidebar>\n                </div>\n\n\n                <div class=\"md:col-span-4\">\n                    <Loader v-if=\"state.isLoading\"/>\n                    <div v-if=\"!state.isLoading\" class=\"w-full grid grid-cols-1 gap-4\">\n                        <DatepickerComponent v-model=\"params.date\"\n                                             @update:modelValue=\"sortByDate\"\n                        />\n                        <Indicators :data=\"state.indicators\"/>\n                        <Search @search=\"search\"\n                                :clear=\"true\"\n                                :placeholder=\"$t('clients.search_placeholder')\"\n                        />\n                        <Table :data=\"state.data.data\"\n                               @onEdit=\"onEdit\"\n                               @onDestroy=\"destroy\"\n                               @orderBy=\"orderBy\"\n                               :statuses=\"statuses\"\n                               :canDestroy=\"can('destroy-clients')\"\n                        />\n                        <div class=\"text-center\">\n                            <Paginate :pagination=\"state.data\"\n                                      :click-handler=\"paginate\"\n                                      v-model=\"params.currentPage\"\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <component :is=\"editModal\"\n                       :item=\"state.modal\"\n                       :statuses=\"statuses\"\n                       :sub-statuses=\"subStatuses\"\n                       :order-statuses=\"orderStatuses\"\n                       size=\"extralarge\"\n                       @closeModal=\"editModalFunction\"\n                       @declineForm=\"destroy\"\n                       @submitForm=\"onUpdate\"\n                       :canDestroy=\"can('destroy-clients')\"\n            ></component>\n        </div>\n    </CrmLayout>\n</template>\n"],"names":["t","useI18n","can","inject","sidebar","ref","exportSidebar","state","params","dateRange","computed","getParams","currentPage","status","orderBy","key","val","fetch","onMounted","value","props","onEdit","editModal","Modal","exportFunction","search","query","data","ClientsRepository","sortByStatus","sortByDate","paginate","page","destroy","id","swal","success","editModalFunction","i","onUpdate"],"mappings":"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"}