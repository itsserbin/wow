{"version":3,"file":"Index-9b7baf3b.js","sources":["../../../resources/js/Pages/Admin/Statistics/Profits/Index.vue"],"sourcesContent":["<script setup>\nimport {onMounted, inject, ref, computed} from \"vue\";\nimport {endOfMonth, startOfMonth} from \"date-fns\";\n\nimport Card from '@/Components/Card.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Label from '@/Components/Form/Label.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Chart from '@/Pages/Admin/Statistics/Chart.vue';\nimport Table from '@/Pages/Admin/Statistics/Profits/Table.vue';\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\n\nconst can = inject('$can');\n\nconst state = ref({\n    profits: [],\n    chart: null,\n    isLoading: true,\n});\n\nconst params = ref({\n    date: [],\n    currentPage: 1,\n})\n\nconst costCategoriesOptions = ref([]);\n\nconst dateRange = computed(() => {\n    if (params.value.date.length === 2) {\n        return {\n            date_start: params.value.date[0].toLocaleDateString(),\n            date_end: params.value.date[1].toLocaleDateString()\n        }\n    }\n});\n\nconst last = computed(() => params.value.last);\n\nconst getParams = computed(() => ({\n    ...dateRange.value,\n    last: last.value,\n    page: params.value.currentPage\n}));\n\nonMounted(() => {\n    params.value.date[0] = startOfMonth(new Date());\n    params.value.date[1] = endOfMonth(new Date());\n\n    fetch();\n})\n\nfunction paginate(page) {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    fetch();\n}\n\nfunction fetch() {\n    state.value.isLoading = true;\n    axios.get(route('api.statistics.profits.index', getParams.value))\n        .then(({data}) => {\n            state.value.profits = data;\n            state.value.isLoading = false;\n        })\n        .catch((response) => {\n            console.log(response);\n            state.value.isLoading = false;\n        });\n\n    axios.get(route('api.statistics.profits.chart', getParams.value))\n        .then(({data}) => state.value.chart = data.result)\n        .catch((response) => console.log(response))\n}\n</script>\n\n<template>\n    <StatisticLayout title=\"Прибуток\">\n        <template #header>\n            Прибуток\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-bookkeeping-profits')\" class=\"grid grid-cols-1 gap-4\">\n            <div class=\"block\">\n                <Label value=\"Фільтр по даті\"/>\n                <DatepickerComponent v-model=\"params.date\"\n                                     @update:modelValue=\"fetch\"\n                />\n            </div>\n\n            <Chart v-if=\"state.chart\" :chart-data=\"state.chart\"/>\n\n            <div class=\"grid grid-cols-2 md:grid-cols-4\">\n                <Card v-for=\"(item,i) in state.profits.generalStat\"\n                      class=\"text-center\"\n                      :title=\"i\"\n                      :description=\"$filters.formatMoney(item)\"\n                >\n                </Card>\n            </div>\n\n            <Table :data=\"state.profits.result.data\"/>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.profits.result\"\n                          :click-handler=\"fetch\"\n                          v-model=\"params.currentPage\"\n                />\n            </div>\n        </div>\n    </StatisticLayout>\n</template>\n"],"names":["can","inject","state","ref","params","dateRange","computed","last","getParams","onMounted","startOfMonth","endOfMonth","fetch","data","response"],"mappings":"65BAaA,MAAMA,EAAMC,EAAO,MAAM,EAEnBC,EAAQC,EAAI,CACd,QAAS,CAAE,EACX,MAAO,KACP,UAAW,EACf,CAAC,EAEKC,EAASD,EAAI,CACf,KAAM,CAAE,EACR,YAAa,CACjB,CAAC,EAE6BA,EAAI,EAAE,EAEpC,MAAME,EAAYC,EAAS,IAAM,CAC7B,GAAIF,EAAO,MAAM,KAAK,SAAW,EAC7B,MAAO,CACH,WAAYA,EAAO,MAAM,KAAK,CAAC,EAAE,mBAAoB,EACrD,SAAUA,EAAO,MAAM,KAAK,CAAC,EAAE,mBAAoB,CACtD,CAET,CAAC,EAEKG,EAAOD,EAAS,IAAMF,EAAO,MAAM,IAAI,EAEvCI,EAAYF,EAAS,KAAO,CAC9B,GAAGD,EAAU,MACb,KAAME,EAAK,MACX,KAAMH,EAAO,MAAM,WACvB,EAAE,EAEFK,EAAU,IAAM,CACZL,EAAO,MAAM,KAAK,CAAC,EAAIM,EAAa,IAAI,IAAM,EAC9CN,EAAO,MAAM,KAAK,CAAC,EAAIO,EAAW,IAAI,IAAM,EAE5CC,GACJ,CAAC,EASD,SAASA,GAAQ,CACbV,EAAM,MAAM,UAAY,GACxB,MAAM,IAAI,MAAM,+BAAgCM,EAAU,KAAK,CAAC,EAC3D,KAAK,CAAC,CAAC,KAAAK,CAAI,IAAM,CACdX,EAAM,MAAM,QAAUW,EACtBX,EAAM,MAAM,UAAY,EACpC,CAAS,EACA,MAAOY,GAAa,CACjB,QAAQ,IAAIA,CAAQ,EACpBZ,EAAM,MAAM,UAAY,EACpC,CAAS,EAEL,MAAM,IAAI,MAAM,+BAAgCM,EAAU,KAAK,CAAC,EAC3D,KAAK,CAAC,CAAC,KAAAK,CAAI,IAAMX,EAAM,MAAM,MAAQW,EAAK,MAAM,EAChD,MAAOC,GAAa,QAAQ,IAAIA,CAAQ,CAAC,CAClD"}