{"version":3,"file":"BuyIn1ClickModal-25970657.js","sources":["../../../resources/js/Pages/Public/Product/BuyIn1ClickModal.vue"],"sourcesContent":["<script setup>\nimport {ref} from \"vue\";\nimport {useGtm} from \"@gtm-support/vue-gtm\";\nimport {useStore} from \"vuex\";\nimport {vMaska} from \"@/Includes/maska\"\nimport eventTracking from \"@/Includes/eventTracking\";\n\nimport Modal from '@/Pages/Public/Components/Modal.vue';\nimport Input from '@/Pages/Public/Components/Input.vue';\nimport InputError from '@/Components/Form/InputError.vue';\nimport Label from '@/Pages/Public/Components/Label.vue';\n\nconst emits = defineEmits(['closeModal', 'addToCard']);\nconst props = defineProps([\n    'item',\n    'product',\n    'eventIdPurchaseIn1Click',\n    'eventIdAddToCard',\n    'isAddToCart'\n]);\n\nconst gtm = useGtm();\n\nconst order = ref({\n    name: '',\n    last_name: '',\n    middle_name: '',\n    email: null,\n    comment: null,\n    phone: null,\n    city: null,\n    postal_office: null,\n    payment_method: null,\n    event_id: props.eventIdPurchaseIn1Click\n});\n\nconst state = ref({\n    isLoading: false,\n    errors: [],\n    contentIds: [],\n    ga4ProductsArray: []\n});\n\nconst store = useStore();\n\nasync function sendForm() {\n    state.value.errors = [];\n    state.value.isLoading = true;\n\n    if (!props.isAddToCart) {\n        await axios.post(route('api.v1.cart.add'), props.item)\n            .then(() => {\n                props.isAddToCart = true;\n                if (import.meta.env.MODE === 'production') {\n                    try {\n                        eventTracking(\n                            'AddToCart',\n                            {\n                                \"value\": props.product.discount_price ? props.product.discount_price : props.product.price,\n                                \"currency\": \"UAH\",\n                                \"content_type\": \"product\",\n                                \"content_ids\": [props.item.item_id],\n                                \"content_name\": props.product.h1\n                            },\n                            props.eventIdAddToCard\n                        )\n                    } catch (e) {\n                        console.error(e);\n                    }\n                }\n                store.commit('loadCart');\n                createOrder();\n            })\n    } else {\n        await createOrder();\n    }\n}\n\nasync function createOrder() {\n    await axios.post(route('api.v1.orders.create.1click'), order.value)\n        .then(({data}) => {\n            if (import.meta.env.MODE === 'production') {\n                try {\n                    store.state.list.forEach((item) => {\n                        state.value.contentIds.push(item.id);\n                        state.value.ga4ProductsArray.push({\n                            item_name: item.name.ua ? item.name.ua : item.name.ru,\n                            item_id: item.id,\n                            price: item.discount_price ? item.discount_price : item.price,\n                            quantity: item.count\n                        })\n                    });\n\n                    eventTracking(\n                        'Purchase',\n                        {\n                            \"value\": store.state.totalPrice,\n                            \"currency\": \"UAH\",\n                            \"content_type\": \"product\",\n                            \"num_items\": store.state.totalCount,\n                            \"content_ids\": state.value.contentIds\n                        },\n                        props.eventIdPurchaseIn1Click\n                    )\n\n                    gtm.trackEvent({\n                        event: 'send_order',\n                        ecommerce: {\n                            transaction_id: data.order.id,\n                            value: data.order.total_price,\n                            currency: \"UAH\",\n                            items: state.value.ga4ProductsArray\n                        }\n                    });\n                } catch (e) {\n                    console.log(e);\n                }\n            }\n            axios.post(route('sms.new.order'), {\n                order_id: data.order.id,\n                phone: data.order.client.phone,\n            })\n            state.value.isLoading = false;\n            if (typeof window !== \"undefined\") {\n                window.location.href = route('thanks', data.order.id);\n            }\n        })\n        .catch(({response}) => {\n            state.value.errors = response.data;\n            state.value.isLoading = false;\n        });\n}\n</script>\n\n<template>\n    <Modal size=\"small\"\n           submit-button-text=\"Замовити\"\n           @submitForm=\"sendForm\"\n           @closeModal=\"$emit('closeModal')\"\n           :is-loading=\"state.isLoading\"\n    >\n        <template #content>\n            <div class=\"grid gap-4\">\n                <div class=\"block\">\n                    <Label>Ім`я</Label>\n                    <Input type=\"text\"\n                           v-model=\"order.name\"\n                           placeholder=\"Введіть ваше ім'я\"\n                    />\n                </div>\n                <div class=\"block\">\n                    <Label :required=\"true\">Ваш телефон</Label>\n                    <Input type=\"tel\"\n                           v-maska\n                           data-maska=\"+38 (0##) ###-##-##\"\n                           v-model=\"order.phone\"\n                           placeholder=\"+38 (0\"\n                           class=\"phone\"\n                    />\n                    <InputError v-if=\"state.errors.phone\" v-for=\"error in state.errors.phone\" :message=\"error\"/>\n                </div>\n            </div>\n        </template>\n    </Modal>\n</template>\n"],"names":["gtm","useGtm","order","ref","props","state","store","useStore","sendForm","createOrder","eventTracking","e","data","item","response"],"mappings":"6vBAqBMA,EAAMC,EAAM,EAEZC,EAAQC,EAAI,CACd,KAAM,GACN,UAAW,GACX,YAAa,GACb,MAAO,KACP,QAAS,KACT,MAAO,KACP,KAAM,KACN,cAAe,KACf,eAAgB,KAChB,SAAUC,EAAM,uBACpB,CAAC,EAEKC,EAAQF,EAAI,CACd,UAAW,GACX,OAAQ,CAAE,EACV,WAAY,CAAE,EACd,iBAAkB,CAAE,CACxB,CAAC,EAEKG,EAAQC,EAAQ,EAEtB,eAAeC,GAAW,CACtBH,EAAM,MAAM,OAAS,GACrBA,EAAM,MAAM,UAAY,GAEnBD,EAAM,YAyBP,MAAMK,EAAW,EAxBjB,MAAM,MAAM,KAAK,MAAM,iBAAiB,EAAGL,EAAM,IAAI,EAChD,KAAK,IAAM,CACRA,EAAM,YAAc,GAEhB,GAAI,CACAM,EACI,YACA,CACI,MAASN,EAAM,QAAQ,eAAiBA,EAAM,QAAQ,eAAiBA,EAAM,QAAQ,MACrF,SAAY,MACZ,aAAgB,UAChB,YAAe,CAACA,EAAM,KAAK,OAAO,EAClC,aAAgBA,EAAM,QAAQ,EACjC,EACDA,EAAM,gBACT,CACJ,OAAQO,EAAP,CACE,QAAQ,MAAMA,CAAC,CAClB,CAELL,EAAM,OAAO,UAAU,EACvBG,GAChB,CAAa,CAIb,CAEA,eAAeA,GAAc,CACzB,MAAM,MAAM,KAAK,MAAM,6BAA6B,EAAGP,EAAM,KAAK,EAC7D,KAAK,CAAC,CAAC,KAAAU,CAAI,IAAM,CAEV,GAAI,CACAN,EAAM,MAAM,KAAK,QAASO,GAAS,CAC/BR,EAAM,MAAM,WAAW,KAAKQ,EAAK,EAAE,EACnCR,EAAM,MAAM,iBAAiB,KAAK,CAC9B,UAAWQ,EAAK,KAAK,GAAKA,EAAK,KAAK,GAAKA,EAAK,KAAK,GACnD,QAASA,EAAK,GACd,MAAOA,EAAK,eAAiBA,EAAK,eAAiBA,EAAK,MACxD,SAAUA,EAAK,KAC3C,CAAyB,CACzB,CAAqB,EAEDH,EACI,WACA,CACI,MAASJ,EAAM,MAAM,WACrB,SAAY,MACZ,aAAgB,UAChB,UAAaA,EAAM,MAAM,WACzB,YAAeD,EAAM,MAAM,UAC9B,EACDD,EAAM,uBACT,EAEDJ,EAAI,WAAW,CACX,MAAO,aACP,UAAW,CACP,eAAgBY,EAAK,MAAM,GAC3B,MAAOA,EAAK,MAAM,YAClB,SAAU,MACV,MAAOP,EAAM,MAAM,gBACtB,CACzB,CAAqB,CACJ,OAAQ,EAAP,CACE,QAAQ,IAAI,CAAC,CAChB,CAEL,MAAM,KAAK,MAAM,eAAe,EAAG,CAC/B,SAAUO,EAAK,MAAM,GACrB,MAAOA,EAAK,MAAM,OAAO,KACzC,CAAa,EACDP,EAAM,MAAM,UAAY,GACpB,OAAO,OAAW,MAClB,OAAO,SAAS,KAAO,MAAM,SAAUO,EAAK,MAAM,EAAE,EAEpE,CAAS,EACA,MAAM,CAAC,CAAC,SAAAE,CAAQ,IAAM,CACnBT,EAAM,MAAM,OAASS,EAAS,KAC9BT,EAAM,MAAM,UAAY,EACpC,CAAS,CACT"}