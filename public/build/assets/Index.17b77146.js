import{z as D,A as M,D as $,K as h,J as d,O as l,R as r,F as z,W as g,Q as t,U as u,Z as p,a7 as B,bb as I,X as U,v as y}from"./_plugin-vue_export-helper.19045d4a.js";import{_ as N}from"./UploadImagesModal.a0ac3c13.js";import P from"./List.58f1276a.js";import V from"./Modal.8ed5e7c0.js";import{H as j}from"./app.e81ce1e5.js";import"./Form.535445db.js";const E=U("\u0417\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u043D\u044F"),H={key:1},O=U(" \u0414\u043E\u0434\u0430\u0442\u0438 "),X={__name:"Index",setup(T){const f=y("$swal"),n=y("$can"),e=D({imagesList:[],isActiveUploadModal:!1,isActiveImageModal:!1,imageUploadModal:[],imageModal:{id:null,src:null,alt:null},currentPage:1,isLoading:!0}),x=M(()=>e.value.isActiveUploadModal?N:null),A=M(()=>e.value.isActiveImageModal?V:null);$(()=>c());function C(a){n("create-images")&&Array.from(a).forEach(function(o){let m=new FormData;m.append("image",o),axios.post(route("api.images.upload"),m,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:i})=>{e.value.imageUploadModal.push({src:i.result}),c()}).catch(i=>console.log(i))})}function v(){e.value.isActiveUploadModal=!e.value.isActiveUploadModal}function s(){e.value.isActiveImageModal=!e.value.isActiveImageModal}function F(){e.value.imageUploadModal=[]}function L(a){s(),e.value.imageModal=a}function k(){n("edit-images")&&axios.put(route("api.images.update",e.value.imageModal.id),e.value.imageModal).then(()=>{s(),f({icon:"success",title:"Updated!"})}).catch(a=>console.log(a))}function b(a){_(a),s()}function _(a){n("destroy-images")&&axios.delete(route("api.images.destroy",a)).then(()=>{c(),f({icon:"success",title:"Destroyed!"})}).catch(o=>console.log(o))}async function c(a){e.value.isLoading=!0,a&&(e.value.currentPage=a),await axios.get(route("api.images.index",{page:e.value.currentPage})).then(o=>{Object.assign(e.value.imagesList,o.data.result),e.value.isLoading=!1}).catch(o=>{console.log(o),e.value.isLoading=!1})}return(a,o)=>{const m=g("loader-component"),i=g("button-component"),w=g("auth-layout");return t(),h(z,null,[d(l(j),{title:"\u0417\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u043D\u044F"}),d(w,null,{header:r(()=>[E]),default:r(()=>[e.value.isLoading?(t(),u(m,{key:0})):p("",!0),!e.value.isLoading&&l(n)("show-images")?(t(),h("div",H,[l(n)("create-images")?(t(),u(i,{key:0,type:"btn",onClick:B(v,["prevent"])},{default:r(()=>[O]),_:1},8,["onClick"])):p("",!0),d(P,{images:e.value.imagesList,onClickImage:L,onFetch:c,onDestroyImage:_},null,8,["images"]),(t(),u(I(l(A)),{onCloseModal:s,onSubmitForm:k,onDeclineForm:b,image:e.value.imageModal,size:"large"},null,40,["image"])),(t(),u(I(l(x)),{onCloseModal:v,onUploadImages:C,onLoadMoreImages:F,images:e.value.imageUploadModal,size:"large"},null,40,["images"]))])):p("",!0)]),_:1})],64)}}};export{X as default};
