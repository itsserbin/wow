import{x as $,az as S,w as J,S as K,y as g,z as r,M as l,B as v,O as M,Q as f,G as m,a8 as x,A as k,P as p,a7 as O,U as A,F as u}from"./moment.791e2419.js";import{_ as a,a as c,b as C,e as F,d as B,g as R,p as I}from"./app.4d34edde.js";import X from"./Modal.bc56faba.js";import Y from"./Table.d4a6ee71.js";import Z from"./ClientOrders.cd8ed14c.js";import ee from"./Table.8396e623.js";import oe from"./Modal.e42da883.js";import"./Form.04a6ddb8.js";import"./Form.60fedf13.js";const te={class:"grid gap-4"},le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},se={class:"block"},re={class:"block"},ie={class:"block"},ae=["href"],ne={class:"block"},de=r("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},null,-1),ue=r("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),ce={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},me={class:"block"},ve={class:"block"},ye={class:"block"},fe={class:"block"},he={class:"block"},be={class:"flex gap-x-2 items-center w-full"},ge=r("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve={class:"grid grid-cols-1 gap-4"},we={class:"block"},$e={class:"block"},ke={class:"block"},Ie={key:0},Me={key:1},Ce=p(") "),Fe={key:0,class:"grid grid-cols-2 gap-x-2"},_e={class:"flex gap-x-2"},Ue={class:"block"},Se=r("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),xe={class:"grid grid-cols-1 gap-y-4"},Oe={class:"block"},Ae={class:"block"},Be={class:"block"},Ee={class:"block mb-5"},De=p("\u0414\u043E\u0434\u0430\u0442\u0438 \u0442\u043E\u0432\u0430\u0440"),je={class:"grid grid-cols-2 md:grid-cols-4 mt-5"},Ne={key:1,class:"block"},ze=p(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0440\u0430\u0445\u0443\u043D\u043E\u043A "),Ke={__name:"Form",props:["order","statuses","paymentMethods","clientStatuses","invoiceStatuses"],emits:["submitItemForm","onEditClient"],setup(o,{emit:y}){const n=o,d=A("$swal"),h=A("$can"),E=$(()=>n.order.total_price-n.order.prepayment_sum),D=$(()=>{const{name:e,last_name:t,middle_name:s}=n.order.client,w=[t,e,s].filter(Boolean);return w.length?w.join(" "):"\u0414\u0430\u043D\u0456 \u043D\u0435 \u0432\u043A\u0430\u0437\u0430\u043D\u0456"}),_=S({order_id:n.order.id,sum:null}),i=J({showItemsModal:!1,showInvoicesModal:!1,itemsModalAction:"",item:{count:1,size:"",color:"",product_id:null},invoiceItem:{},statuses:[],managers:[],paymentMethods:[]});K(()=>{L();for(const[e,t]of Object.entries(n.statuses))i.value.statuses.push({key:e,value:t});for(const[e,t]of Object.entries(n.paymentMethods))i.value.paymentMethods.push({key:e,value:t})});const j=$(()=>i.value.showItemsModal?X:null),N=$(()=>i.value.showInvoicesModal?oe:null);S([{key:0,value:"\u041D\u0456"},{key:1,value:"\u0422\u0430\u043A"}]);function V(){i.value.showInvoicesModal=!i.value.showInvoicesModal}function z(e){h("destroy-invoices")&&d({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(t=>{t.isConfirmed&&axios.delete(route("api.invoices.destroy",e)).then(()=>{y("submitItemForm"),d({icon:"success",title:"Destroyed!"})}).catch(s=>{console.log(s),d({icon:"error",title:"Error!"})})})}function P(){h("create-invoices")&&(i.value.invoiceItem=_,V())}function T(){axios.post(route("api.invoices.create"),i.value.invoiceItem).then(({data:e})=>{i.value.invoiceItem=_,V(),navigator.clipboard.writeText(e.result.data.invoice_url),d({title:"\u0423\u0441\u043F\u0456\u0448\u043D\u043E!",text:"\u0420\u0430\u0445\u0443\u043D\u043E\u043A \u0431\u0443\u0432 \u0443\u0441\u043F\u0456\u0448\u043D\u043E \u0441\u0442\u0432\u043E\u0440\u0435\u043D\u0438\u0439, \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F \u043D\u0430 \u043E\u043F\u043B\u0430\u0442\u0443 \u0441\u043A\u043E\u043F\u0456\u0439\u043E\u0432\u0430\u043D\u043E \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0456\u043D\u0443",icon:"success"}),y("submitItemForm",e.result)}).catch(e=>{console.log(e),d({title:"Error!",icon:"error"})})}function U(){n.order.waybill&&axios.post(route("notify.waybill"),{phone:n.order.client.phone,waybill:n.order.waybill,order_id:n.order.id}).then(({data:e})=>{e.success===!0?d({icon:"success",title:"\u041D\u043E\u043C\u0435\u0440 \u043D\u0430\u043A\u043B\u0430\u0434\u043D\u043E\u0439 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u043A\u043B\u0438\u0435\u043D\u0442\u0443",text:e.info}):d({icon:"error",title:"\u041E\u0448\u0438\u0431\u043A\u0430",text:e.info}),axios.put(route("api.orders.update",n.order.id),n.order)}).catch(e=>{d({icon:"error",title:"\u041E\u0448\u0438\u0431\u043A\u0430",text:"\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443"}),console.log(e)})}function W(){i.value.itemsModalAction==="create"?axios.post(route("api.order-items.add",n.order.id),i.value.item).then(({data:e})=>{b(),y("submitItemForm",e.result)}).catch(e=>console.log(e)):i.value.itemsModalAction==="edit"&&axios.put(route("api.order-items.update",i.value.item.id),i.value.item).then(({data:e})=>{b(),y("submitItemForm",e.result)}).catch(e=>console.log(e))}function G(){b(),i.value.itemsModalAction="create"}function b(){i.value.showItemsModal=!i.value.showItemsModal}function L(){axios.get(route("api.users.list.managers")).then(({data:e})=>{e.result.length&&e.result.forEach(t=>{i.value.managers.push({key:t.id,value:t.name})})}).catch(e=>console.log(e))}function Q(e,t){d({title:"Are you sure?",icon:"warning",showCancelButton:!0}).then(s=>{s.isConfirmed&&axios.delete(route("api.order-items.destroy",{item_id:e,order_id:n.order.id})).then(()=>{y("submitItemForm"),d({title:"Success",icon:"success"})}).catch(w=>{console.log(w),d({title:"Error",icon:"error"})})})}function q(e){b(),i.value.itemsModalAction="edit",axios.get(route("api.order-items.edit",e)).then(({data:t})=>i.value.item=t.result).catch(t=>console.log(t))}function H(){d({title:"\u0423\u0441\u043F\u0456\u0448\u043D\u043E",text:"\u041F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F \u043D\u0430 \u043E\u043F\u043B\u0430\u0442\u0443 \u043D\u0430\u0434\u0456\u0441\u043B\u0430\u043D\u043E \u043A\u043B\u0456\u0454\u043D\u0442\u0443",icon:"success"}),y("submitItemForm")}return(e,t)=>(u(),g("form",te,[r("div",le,[r("div",se,[l(a,{value:e.$t("clients.status")},null,8,["value"]),l(c,{value:o.clientStatuses[o.order.client.status],type:"text",disabled:""},null,8,["value"])]),r("div",re,[l(a,{value:e.$t("clients.name")},null,8,["value"]),l(c,{value:v(D),type:"text",disabled:""},null,8,["value"])]),r("div",ie,[l(a,{value:e.$t("clients.phone")},null,8,["value"]),r("a",{href:"tel:+"+o.order.client.phone},[l(c,{modelValue:o.order.client.phone,"onUpdate:modelValue":t[0]||(t[0]=s=>o.order.client.phone=s),type:"text",disabled:"",class:"hover:cursor-pointer"},null,8,["modelValue"])],8,ae)]),r("div",ne,[l(a,{value:"\xA0"}),l(C,{class:"w-full",type:"button",onClick:t[1]||(t[1]=s=>e.$emit("onEditClient"))},{default:M(()=>[p(k(e.$t("orders.client_card")),1)]),_:1})])]),de,o.order.client.orders.length>1?(u(),f(Z,{key:0,data:o.order.client.orders,statuses:o.statuses},null,8,["data","statuses"])):m("",!0),ue,r("div",ce,[r("div",me,[l(a,{value:e.$t("orders.status")},null,8,["value"]),l(F,{modelValue:o.order.status,"onUpdate:modelValue":t[2]||(t[2]=s=>o.order.status=s),options:i.value.statuses},null,8,["modelValue","options"])]),r("div",ve,[l(a,{value:e.$t("orders.manager_id")},null,8,["value"]),l(F,{modelValue:o.order.manager_id,"onUpdate:modelValue":t[3]||(t[3]=s=>o.order.manager_id=s),options:i.value.managers},null,8,["modelValue","options"])]),r("div",ye,[l(a,{value:e.$t("orders.payment_method")},null,8,["value"]),l(F,{modelValue:o.order.payment_method,"onUpdate:modelValue":t[4]||(t[4]=s=>o.order.payment_method=s),options:i.value.paymentMethods},null,8,["modelValue","options"])]),r("div",fe,[l(a,{value:e.$t("orders.parcel_reminder")},null,8,["value"]),r("div",he,[r("div",be,[l(B,{modelValue:o.order.parcel_reminder,"onUpdate:modelValue":t[5]||(t[5]=s=>o.order.parcel_reminder=s)},null,8,["modelValue"]),l(a,{value:o.order.parcel_reminder?"\u0422\u0430\u043A":"\u041D\u0456"},null,8,["value"])])])])]),ge,r("div",pe,[r("div",Ve,[r("div",we,[l(a,{value:e.$t("orders.city")},null,8,["value"]),l(c,{modelValue:o.order.city,"onUpdate:modelValue":t[6]||(t[6]=s=>o.order.city=s),type:"text",placeholder:e.$t("orders.enter_city")},null,8,["modelValue","placeholder"])]),r("div",$e,[l(a,{value:e.$t("orders.postal_office")},null,8,["value"]),l(c,{modelValue:o.order.postal_office,"onUpdate:modelValue":t[7]||(t[7]=s=>o.order.postal_office=s),type:"text",placeholder:e.$t("orders.enter_postal_office")},null,8,["modelValue","placeholder"])]),r("div",ke,[l(a,{value:e.$t("orders.waybill")},null,8,["value"]),l(c,{modelValue:o.order.waybill,"onUpdate:modelValue":t[8]||(t[8]=s=>o.order.waybill=s),type:"text",placeholder:e.$t("orders.enter_waybill")},null,8,["modelValue","placeholder"]),!o.order.sms_waybill_status&&o.order.waybill?(u(),g("div",Ie,[r("a",{href:"javascript:",onClick:t[9]||(t[9]=x(s=>U(o.order.client.phone,o.order.waybill),["prevent"]))},k(e.$t("orders.send_waybill_for_client")),1)])):m("",!0),o.order.sms_waybill_status?(u(),g("div",Me,[p(k(e.$t("orders.waybill_sent"))+" (",1),r("a",{href:"javascript:",onClick:t[10]||(t[10]=x(s=>U(o.order.client.phone,o.order.waybill),["prevent"]))},k(e.$t("orders.waybill_resent")),1),Ce])):m("",!0)]),o.order.status==="return"?(u(),g("div",Fe,[r("div",_e,[l(B,{modelValue:o.order.refund_other_waybill,"onUpdate:modelValue":t[11]||(t[11]=s=>o.order.refund_other_waybill=s),onChange:e.test},null,8,["modelValue","onChange"]),l(a,{value:e.$t("orders.refund_other_waybill")},null,8,["value"])]),o.order.refund_other_waybill?(u(),f(c,{key:0,modelValue:o.order.other_waybill,"onUpdate:modelValue":t[12]||(t[12]=s=>o.order.other_waybill=s),type:"text",placeholder:e.$t("orders.enter_refund_other_waybill")},null,8,["modelValue","placeholder"])):m("",!0)])):m("",!0)]),r("div",Ue,[l(a,{value:e.$t("orders.comment")},null,8,["value"]),l(R,{rows:"12",modelValue:o.order.comment,"onUpdate:modelValue":t[13]||(t[13]=s=>o.order.comment=s),placeholder:e.$t("orders.enter_comment")},null,8,["modelValue","placeholder"])])]),Se,r("div",xe,[r("div",Oe,[l(a,{value:e.$t("orders.sale_of_air")},null,8,["value"]),l(c,{modelValue:o.order.sale_of_air_price,"onUpdate:modelValue":t[14]||(t[14]=s=>o.order.sale_of_air_price=s),type:"number",placeholder:e.$t("orders.enter_sale_of_air_price")},null,8,["modelValue","placeholder"])]),r("div",Ae,[l(a,{value:e.$t("orders.discount")},null,8,["value"]),l(c,{modelValue:o.order.discount_sum,"onUpdate:modelValue":t[15]||(t[15]=s=>o.order.discount_sum=s),type:"number",placeholder:e.$t("orders.enter_discount_sum")},null,8,["modelValue","placeholder"])]),r("div",Be,[l(a,{value:"\u0417\u0430\u0433\u0430\u043B\u044C\u043D\u0430 \u0441\u0443\u043C\u0430 \u043F\u0435\u0440\u0435\u0434\u043E\u043F\u043B\u0430\u0442\u0438 (\u0433\u0440\u043D.)"}),l(c,{modelValue:o.order.prepayment_sum,"onUpdate:modelValue":t[16]||(t[16]=s=>o.order.prepayment_sum=s),type:"number",disabled:""},null,8,["modelValue"])])]),r("div",Ee,[l(C,{type:"button",onClick:G},{default:M(()=>[De]),_:1}),(u(),f(O(v(j)),{item:i.value.item,size:"medium",onCloseModal:b,onSubmitItemForm:W},null,40,["item"]))]),l(Y,{data:o.order.items,onEditOrderItem:q,onDestroyOrderItem:Q},null,8,["data"]),r("div",je,[l(I,{title:"\u041A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0442\u043E\u0432\u0430\u0440\u0456\u0432",description:o.order.total_count,class:"text-center"},null,8,["description"]),l(I,{title:"\u0417\u0430\u0433\u0430\u043B\u044C\u043D\u0430 \u0446\u0456\u043D\u0430",description:e.$filters.formatMoney(o.order.total_price),class:"text-center"},null,8,["description"]),l(I,{title:"\u0426\u0456\u043D\u0430 \u043D\u0430 \u043F\u043E\u0441\u0438\u043B\u043A\u0443",description:e.$filters.formatMoney(v(E)),class:"text-center"},null,8,["description"]),l(I,{title:"\u041F\u0440\u043E\u043C\u043E-\u043A\u043E\u0434",description:o.order.promo_code?o.order.promo_code:"\u0412\u0456\u0434\u0441\u0443\u0442\u043D\u0456\u0439",class:"text-center"},null,8,["description"])]),v(h)("show-invoices")?(u(),g("div",Ne,[v(h)("create-invoices")?(u(),f(C,{key:0,type:"button",onClick:P,class:"my-4"},{default:M(()=>[ze]),_:1})):m("",!0),o.order.invoices.length?(u(),f(ee,{key:1,data:o.order.invoices,statuses:o.invoiceStatuses,"can-destroy":v(h)("destroy-invoices"),onOnDestroy:z,onOnSendInvoiceSms:H},null,8,["data","statuses","can-destroy"])):m("",!0),(u(),f(O(v(N)),{item:i.value.invoiceItem,onCloseModal:V,onSubmitForm:T,onDeclineForm:V},null,40,["item"]))])):m("",!0)]))}};export{Ke as default};
