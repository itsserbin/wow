{"version":3,"file":"Index-0a6ae580.js","sources":["../../../resources/js/Pages/Admin/Content/Categories/Index.vue"],"sourcesContent":["<script setup>\nimport Modal from '@/Pages/Admin/Content/Categories/Modal.vue';\nimport Table from '@/Pages/Admin/Content/Categories/Table.vue';\nimport ContentLayout from '@/Pages/Admin/Content/ContentLayout.vue'\nimport Loader from '@/Components/Loader.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Button from '@/Components/Button.vue';\nimport CategoriesRepository from \"@/Repositories/CategoriesRepository\";\n\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst can = inject('$can');\nconst {t} = useI18n();\n\nconst item = reactive({\n    published: 0,\n    slug: null,\n    parent_id: null,\n    preview_id: null,\n    preview: null,\n    title: {\n        ru: null,\n        ua: null\n    },\n    meta_title: {\n        ru: null,\n        ua: null\n    },\n    meta_description: {\n        ru: null,\n        ua: null\n    },\n    meta_keyword: {\n        ru: null,\n        ua: null\n    },\n    seo_text: {\n        ru: null,\n        ua: null\n    }\n})\n\nconst state = ref({\n    categories: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: {},\n    errors: []\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nconst fetch = async (page) => {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    const data = await CategoriesRepository.fetch({'page': state.value.currentPage});\n    state.value.categories = data.success ? data.result : [];\n    state.value.isLoading = false;\n}\n\nconst onDestroy = async (id) => {\n    if (can('destroy-categories')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n        if (result.isConfirmed) {\n            const {success} = await CategoriesRepository.destroy(id);\n            if (success) {\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    icon: 'success',\n                    title: t('swal.destroyed')\n                })\n            }\n        }\n    }\n}\n\nconst modalFunction = () => {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nconst onEdit = async (id, i) => {\n    if (can('edit-categories')) {\n        const data = await CategoriesRepository.edit(id);\n        if (data.success) {\n            state.value.item = data.result;\n            state.value.modalAction = 'edit';\n            state.value.item.index = i;\n            modalFunction();\n        }\n    }\n}\n\nconst onUpdate = async () => {\n    if (can('edit-categories')) {\n        const data = await CategoriesRepository.update(state.value.item);\n        state.value.errors = [];\n        if (data.success) {\n            modalFunction();\n            await fetch();\n            await swal({\n                title: t('swal.updated'),\n                icon: 'success'\n            })\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                icon: 'error',\n                text: t('swal.check_data')\n            })\n        }\n    }\n}\n\nconst onCreate = async () => {\n    if (can('create-categories')) {\n        const data = await CategoriesRepository.create(state.value.item);\n        state.value.errors = [];\n        if (data.success) {\n            modalFunction();\n            state.value.item = {};\n            await fetch();\n            await swal({\n                title: t('swal.created'),\n                icon: 'success'\n            });\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                text: t('swal.check_data'),\n                icon: 'error'\n            })\n        }\n    }\n}\n\nconst submitForm = async () => {\n    if (state.value.modalAction === 'edit' && can('edit-categories')) {\n        await onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-categories')) {\n        await onCreate();\n    }\n}\n\nconst create = () => {\n    if (can('create-categories')) {\n        Object.assign(state.value.item, item);\n        state.value.modalAction = 'create';\n        state.value.errors = [];\n        modalFunction();\n    }\n}\n</script>\n\n<template>\n    <ContentLayout :title=\"$t('categories.page_title')\">\n        <template #header>{{ $t('categories.page_title') }}</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-categories')\" class=\"grid gap-4 grid-cols-1\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-categories')\">\n                    {{ $t('add') }}\n                </Button>\n            </div>\n\n            <Table :data=\"state.categories.data\"\n                   @onEdit=\"onEdit\"\n                   @onDestroy=\"onDestroy\"\n                   :canDestroy=\"can('destroy-categories')\"\n            />\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.categories\"\n                          :click-handler=\"fetch\"\n                          v-model=\"state.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   :errors=\"state.errors\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   :canDestroy=\"can('destroy-categories')\"\n        ></component>\n    </ContentLayout>\n</template>\n"],"names":["can","inject","t","useI18n","item","reactive","state","ref","onMounted","fetch","activeModal","computed","Modal","page","data","CategoriesRepository","onDestroy","id","swal","success","modalFunction","onEdit","onUpdate","onCreate","submitForm","create"],"mappings":"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"}