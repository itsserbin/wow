{"version":3,"file":"Index-31c0cec7.js","sources":["../../../resources/js/Pages/Admin/Content/Products/Index.vue"],"sourcesContent":["<script setup>\nimport ProductModal from '@/Pages/Admin/Content/Products/Modal.vue';\nimport Table from '@/Pages/Admin/Content/Products/Table.vue'\nimport Loader from '@/Components/Loader.vue'\nimport Button from '@/Components/Button.vue'\nimport Paginate from '@/Components/Paginate.vue'\nimport Search from '@/Components/Search.vue'\nimport ContentLayout from '@/Pages/Admin/Content/ContentLayout.vue'\n\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport ProductsRepository from \"@/Repositories/ProductsRepository\";\nimport {useI18n} from 'vue-i18n';\nimport {swal} from \"@/Includes/swal\";\n\nconst can = inject('$can');\nconst {t} = useI18n();\n\nconst product = reactive({\n    status: null,\n    title: {\n        ru: null,\n        ua: null\n    },\n    characteristics: {\n        ru: null,\n        ua: null,\n    },\n    description: {\n        ru: null,\n        ua: null\n    },\n    h1: {\n        ru: null,\n        ua: null\n    },\n    content: {\n        ru: null,\n        ua: null\n    },\n    characteristicsNew: {},\n    published: 0,\n    preview: null,\n    size_table: null,\n    price: null,\n    trade_price: null,\n    discount_price: null,\n    categories: [],\n    vendor_code: null,\n    provider_id: null,\n    youtube: null,\n    sizes: [],\n    images: [],\n    colors: [],\n})\n\nconst state = ref({\n    products: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: product,\n    errors: []\n});\n\nonMounted(() => {\n    let id = new URLSearchParams(new URL(window.location.href).search).get('product');\n    if (id) {\n        onEdit(id);\n    }\n\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? ProductModal : null)\n\nconst search = async (query) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.search(query);\n    if (data.success) {\n        state.value.currentPage = 1;\n        state.value.products = data.result;\n    }\n    state.value.isLoading = false;\n}\n\nconst fetch = async (page) => {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    const data = await ProductsRepository.fetch({'page': state.value.currentPage});\n    state.value.products = data.success ? data.result : [];\n    state.value.isLoading = false;\n}\n\nconst onDestroy = async (id) => {\n    if (can('destroy-products')) {\n        const result = await swal({\n            title: t('swal.sure'),\n            icon: 'warning',\n            showCancelButton: true,\n        })\n        if (result.isConfirmed) {\n            const {success} = await ProductsRepository.destroy(id);\n            if (success) {\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    icon: 'success',\n                    title: t('swal.destroyed')\n                })\n            }\n        }\n    }\n}\n\nconst modalFunction = () => {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nconst onEdit = async (id) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.edit(id);\n    if (data.success) {\n        state.value.item = data.result;\n        state.value.item.characteristicsNew = {};\n        if (state.value.item.characteristics_new.length) {\n            state.value.item.characteristics_new.forEach((item) => {\n                state.value.item.characteristicsNew[item.characteristic_id] = [];\n            })\n            state.value.item.characteristics_new.forEach((item) => {\n                state.value.item.characteristicsNew[item.characteristic_id].push(item);\n            })\n        }\n        state.value.modalAction = 'edit';\n        modalFunction();\n    }\n    state.value.isLoading = false;\n}\n\nconst onUpdate = async () => {\n    if (can('edit-products')) {\n        const data = await ProductsRepository.update(state.value.item);\n        if (data.success) {\n            modalFunction();\n            await fetch();\n            await swal({\n                title: t('swal.updated'),\n                icon: 'success'\n            })\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                icon: 'error',\n                text: t('swal.check_data')\n            })\n        }\n    }\n}\n\nconst onCreate = async () => {\n    if (can('create-products')) {\n        const data = await ProductsRepository.create(state.value.item);\n        if (data.success) {\n            modalFunction();\n            state.value.item = product;\n            await fetch();\n            await swal({\n                title: t('swal.created'),\n                icon: 'success'\n            });\n        } else {\n            state.value.errors = data;\n            console.log(data);\n            await swal({\n                title: t('swal.error'),\n                text: t('swal.check_data'),\n                icon: 'error'\n            })\n        }\n    }\n}\n\nconst submitForm = async () => {\n    if (state.value.modalAction === 'edit' && can('edit-products')) {\n        await onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-products')) {\n        await onCreate();\n    }\n}\n\nconst create = () => {\n    if (can('create-products')) {\n        state.value.item = product;\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n\nconst setProductImages = (images) => {\n    state.value.item.images = state.value.item.images.concat(images);\n}\n\nconst destroyImage = (image) => {\n    let index = state.value.item.images.findIndex((item) => {\n        return item.id === image;\n    })\n    state.value.item.images.splice(index, 1)\n}\n\nconst onUpdateProductSort = async (product_id, sort) => {\n    state.value.isLoading = true;\n    const data = await ProductsRepository.updateSort(product_id, sort);\n    if (data.success) {\n        await swal({\n            title: t('swal.updated'),\n            icon: 'success'\n        })\n    }\n    state.value.isLoading = false;\n}\n</script>\n\n<template>\n    <ContentLayout :title=\"$t('products.page_title')\">\n        <template #header>{{ $t('products.page_title') }}</template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-products')\" class=\"grid gap-4 grid-cols-1\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-products')\">\n                    {{ $t('add') }}\n                </Button>\n            </div>\n\n            <div class=\"grid grid-cols-1 gap-4\">\n                <Search @search=\"search\"\n                        :clear=\"true\"\n                        :placeholder=\"$t('products.search_placeholder')\"\n                        @onClear=\"fetch\"\n                />\n                <Table :data=\"state.products.data\"\n                       @onEdit=\"onEdit\"\n                       @onDestroy=\"onDestroy\"\n                       :canDestroy=\"can('destroy-products')\"\n                       @onUpdateProductSort=\"onUpdateProductSort\"\n                />\n            </div>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.products\"\n                          :click-handler=\"fetch\"\n                          v-model=\"state.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   @setProductImages=\"setProductImages\"\n                   @destroyImage=\"destroyImage\"\n                   :canDestroy=\"can('destroy-products')\"\n        ></component>\n    </ContentLayout>\n</template>\n"],"names":["can","inject","t","useI18n","product","reactive","state","ref","onMounted","id","onEdit","fetch","activeModal","computed","ProductModal","search","query","data","ProductsRepository","page","onDestroy","swal","success","modalFunction","item","onUpdate","onCreate","submitForm","create","setProductImages","images","destroyImage","image","index","onUpdateProductSort","product_id","sort"],"mappings":"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"}