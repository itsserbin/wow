import I from"./Modal.d14ef27a.js";import"./app.22f6e2f6.js";import{z as P,u as j,D as B,A as U,bN as s,U as m,R as n,V as i,Q as p,W as y,O as b,K as z,J as v,L as k,M as _,Z as h,bb as O,v as w}from"./_plugin-vue_export-helper.a5aa4da2.js";import"./Form.44d7ea84.js";import"./ItemsModal.6c7c4742.js";import"./ItemsForm.f318a510.js";const J=h(" \u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F "),K={key:1},Q=["onClick"],R=["onClick"],H={__name:"Index",props:["statuses","payment_methods"],setup(E){const f=E,e=P({orders:[],currentPage:1,isLoading:!0,isActiveEditModal:!1,orderModal:{}}),d=w("$swal"),l=w("$can"),x=j([{label:"ID",key:"id"},{label:"\u0421\u0442\u0430\u0442\u0443\u0441",key:"status"},{label:"\u0406\u043C\u02BC\u044F",key:"first_name"},{label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",key:"phone"},{label:"\u041D\u0430\u043A\u043B\u0430\u0434\u043A\u0430",key:"waybill"},{label:"\u0422\u043E\u0432\u0430\u0440\u0456\u0432",key:"total_count"},{label:"\u0421\u0443\u043C\u0430",key:"total_price"},{label:"\u041E\u043D\u043E\u0432\u043B\u0435\u043D\u043E<hr class='my-1'>\u0421\u0442\u0432\u043E\u0440\u0435\u043D\u043E",key:"timestamps"},{label:"#",key:"actions"}]);B(()=>c());function g(t){let o=[];return t.forEach(a=>{o.push({id:a.id,title:a.product.title,count:a.count,sale_price:a.sale_price,total_price:a.total_price,resale:a.resale?"Yes":"No",discount:a.discount,vendor_code:a.vendor_code,actions:""})}),o}const C=U(()=>e.value.isActiveEditModal?I:null);function L(t){l("edit-orders")&&(s.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal),s.get(route("api.orders.edit",t.order_id)).then(({data:o})=>{e.value.orderModal=o.result,e.value.orderModal.items=g(o.result.items)}).catch(o=>console.log(o)))}function c(t){e.value.isLoading=!0,t&&(e.value.currentPage=t),s.get(route("api.orders.index",{page:e.value.currentPage})).then(o=>{Object.assign(e.value.orders,o.data.result),e.value.isLoading=!1}).catch(o=>{console.log(o),e.value.isLoading=!1})}function M(t){l("destroy-orders")&&(e.value.isLoading=!0,s.delete(route("api.orders.destroy",t)).then(()=>{e.value.isLoading=!1,c(),e.value.isActiveEditModal&&u(),d({title:"Success!",icon:"success"})}).catch(o=>{console.log(o),d({title:"Error!",icon:"error"})}))}function V(t,o){l("edit-orders")&&s.get(route("api.orders.edit",t)).then(({data:a})=>{e.value.orderModal.index=o,e.value.orderModal=a.result,e.value.orderModal.items=g(a.result.items),u()}).catch(a=>console.log(a))}function F(){l("edit-orders")&&s.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal).then(()=>{u(),c(),d({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),d({title:"Error!",icon:"error"})})}function u(){e.value.isActiveEditModal=!e.value.isActiveEditModal}return(t,o)=>{const a=i("loader-component"),$=i("xcircle-component"),A=i("table-component"),N=i("paginate"),S=i("auth-layout");return p(),m(S,{title:"\u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F"},{header:n(()=>[J]),default:n(()=>[e.value.isLoading?(p(),m(a,{key:0})):y("",!0),!e.value.isLoading&&b(l)("show-orders")?(p(),z("div",K,[v(A,{headings:x,isSlotMode:!0,rows:e.value.orders.data},{id:n(({data:r})=>[k("a",{href:"javascript:",onClick:D=>V(r.row.id,r.i)},_(r.row.id),9,Q)]),created_at:n(({data:r})=>[h(_(t.$filters.dateFormat(r.row.created_at)),1)]),updated_at:n(({data:r})=>[h(_(t.$filters.dateFormat(r.row.updated_at)),1)]),actions:n(({data:r})=>[k("a",{href:"javascript:",onClick:D=>M(r.row.id)},[v($)],8,R)]),_:1},8,["headings","rows"]),v(N,{pagination:e.value.orders,"click-handler":c,modelValue:e.value.currentPage,"onUpdate:modelValue":o[0]||(o[0]=r=>e.value.currentPage=r)},null,8,["pagination","modelValue"]),(p(),m(O(b(C)),{order:e.value.orderModal,statuses:f.statuses,paymentMethods:f.payment_methods,size:"extralarge",onCloseModal:u,onDeclineForm:M,onSubmitForm:F,onSubmitItemForm:L},null,40,["order","statuses","paymentMethods"]))])):y("",!0)]),_:1})}}};export{H as default};
