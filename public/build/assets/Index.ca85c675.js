import{j as X,r as L,S as B,q as G,k as H}from"./app.d5d36829.js";import W from"./Modal.a119e4b5.js";import Y from"./Modal.0d9c3816.js";import Z from"./Table.844d2c24.js";import ee from"./CrmLayout.db5753d7.js";import{w as _,x as w,S as te,bU as re,Q as l,K as m,X as P,F as n,P as u,B as d,y as S,z as h,J as k,M as $,O as F,L as b,A as D,a2 as O}from"./___vite-browser-external_commonjs-proxy.4f2b06be.js";import"./Form.116ff326.js";import"./ItemsTable.07dd3858.js";import"./Form.00428fd6.js";import"./ItemsModal.05d5f208.js";import"./ItemsForm.b46c983b.js";import"./ItemsTable.736c519f.js";import"./ClientOrders.10e43a13.js";import"./Table.a3c6f757.js";import"./Modal.a1930da3.js";import"./Form.458afa8e.js";const p=()=>({fetch:async function(a){try{return(await axios.get(route("api.orders.index",a))).data}catch(r){return console.error(r)}},edit:async function(a){try{return(await axios.get(route("api.orders.edit",a))).data}catch(r){return console.log(r)}},destroy:async function(a){try{return(await axios.delete(route("api.orders.destroy",a))).data}catch(r){return console.log(r)}},update:async function(a,r){try{return(await axios.put(route("api.orders.update",a),r)).data}catch(e){return console.log(e)}},search:async function(a){try{return(await axios.get(route("api.orders.search",a))).data}catch(r){return console.log(r)}}}),ae=()=>({fetch:async function(a){try{return(await axios.get(route("api.clients.index",a))).data}catch(r){return console.error(r)}},edit:async function(a){try{return(await axios.get(route("api.clients.edit",a))).data}catch(r){return console.log(r)}},destroy:async function(a){try{return(await axios.delete(route("api.clients.destroy",a))).data}catch(r){return console.log(r)}},update:async function(a,r){try{return(await axios.put(route("api.clients.update",a),r)).data}catch(e){return console.log(e)}},search:async function(a){try{return(await axios.get(route("api.clients.search",a))).data}catch(r){return console.log(r)}}}),se=b(" \u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F "),oe={key:1},ne={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ie={class:"md:col-span-1 gap-4"},ce={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},le={class:"text-center"},Ae={__name:"Index",props:["statuses","payment_methods","invoiceStatuses"],setup(a){const r=a,e=_({orders:[],currentPage:1,isLoading:!0,isActiveEditModal:!1,isActiveClientModal:!1,sidebarActive:"all",orderModal:{},clientModal:{},clientsStatuses:null,clientsSubStatuses:null}),g=_([]),A=[{title:"\u0415\u043A\u0441\u043F\u043E\u0440\u0442\u0443\u0432\u0430\u0442\u0438",key:"export"}],i=P("$swal"),v=P("$can"),c=_({status:null,currentPage:1,orderBy:{key:null,val:null}}),V=w(()=>{const{currentPage:t,status:s=null,orderBy:o=null}=c.value;return{page:t,status:s,orderBy:o}}),N=(t,s)=>{c.value.orderBy={key:t,val:s},c.value.currentPage=1,y()};te(()=>{y(),g.value.push({title:"\u0412\u0441\u0456 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F",key:"all"});for(const[t,s]of Object.entries(r.statuses))g.value.push({title:s,key:t});route().params.id&&(e.value.isLoading=!0,E(route().params.id)),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.clientsStatuses=t.statuses,e.value.clientsSubStatuses=t.subStatuses})});const U=w(()=>e.value.isActiveEditModal?Y:null),j=w(()=>e.value.isActiveClientModal?W:null),y=async()=>{try{const t=await p().fetch(V.value);t.success&&(e.value.orders=t.result),e.value.isLoading=!1}catch(t){console.error(t),e.value.isLoading=!1}},z=async()=>{const t=await ae().edit(e.value.orderModal.client.id);t.success&&(e.value.clientModal=t.result,M())},I=t=>{t==="export"&&(window.location.href=route("admin.crm.orders.export"))},M=()=>{e.value.isActiveClientModal=!e.value.isActiveClientModal},R=()=>{axios.put(route("api.clients.update",e.value.clientModal.id),e.value.clientModal).then(()=>{M(),axios.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal).then(()=>{axios.get(route("api.orders.edit",e.value.orderModal.id)).then(({data:t})=>{e.value.orderModal=t.result,i({title:"Success!",icon:"success"})}).catch(t=>console.log(t))})}).catch(t=>{console.log(t),i({title:"Error!",icon:"error"})})},q=async()=>{try{const{success:t}=await p().update(e.value.orderModal.id,e.value.orderModal);if(t){const{result:s}=await p().edit(e.value.orderModal.id);e.value.orderModal=s}}catch(t){console.error(t),i({title:"Error!",icon:"error",text:t.response.data.message||"An error occurred, please try again later"})}},J=re.debounce(t=>{e.value.sidebarActive!==t&&(c.value.orderBy={key:null,val:null},e.value.sidebarActive=t,c.value.status=t==="all"?null:t,y())},250),K=t=>{c.value.currentPage=t||c.value.currentPage,y()},Q=async t=>{try{const{result:s,success:o}=await p().search(t);o&&(e.value.sidebarActive=null,c.value.currentPage=1,e.value.orders=s,e.value.isLoading=!1)}catch(s){console.error(s),i({title:"Error!",icon:"error",text:s.response.data.message||"An error occurred, please try again later"})}},C=async t=>{try{v("destroy-orders")&&(await i({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0})).isConfirmed&&(await p().destroy(t),e.value.isLoading=!1,await y(),e.value.isActiveEditModal&&f(),i({title:"Success!",icon:"success"}))}catch(s){console.error(s),i({title:"Error!",icon:"error",text:s.response.data.message||"An error occurred, please try again later"})}},E=async(t,s)=>{try{const{result:o,success:x}=await p().edit(t);x&&(e.value.orderModal.index=s,e.value.orderModal=o,f(),e.value.isLoading=!1)}catch(o){e.value.isLoading=!1,console.error(o),i({title:"Error!",icon:"error",text:o.response.data.message||"An error occurred, please try again later"})}},T=async()=>{try{if(v("edit-orders")){const{success:t}=await p().update(e.value.orderModal.id,e.value.orderModal);t&&(f(),await y(),i({title:"Success!",icon:"success"}))}}catch(t){e.value.isLoading=!1,console.error(t),i({title:"Error!",icon:"error",text:t.response.data.message||"An error occurred, please try again later"})}},f=()=>{e.value.isActiveEditModal=!e.value.isActiveEditModal};return(t,s)=>(n(),l(ee,{title:"\u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F"},{header:m(()=>[se]),default:m(()=>[e.value.isLoading?(n(),l(X,{key:0})):u("",!0),!e.value.isLoading&&d(v)("show-orders")?(n(),S("div",oe,[h("div",ne,[h("div",ie,[k(B,{class:"mb-5"},{default:m(()=>[g.value.length?(n(!0),S($,{key:0},F(g.value,o=>(n(),l(L,{onClick:x=>d(J)(o.key),active:e.value.sidebarActive===o.key},{default:m(()=>[b(D(o.title),1)]),_:2},1032,["onClick","active"]))),256)):u("",!0)]),_:1}),d(v)("export-orders")?(n(),l(B,{key:0},{default:m(()=>[A.length?(n(),S($,{key:0},F(A,o=>k(L,{onClick:x=>I(o.key)},{default:m(()=>[b(D(o.title),1)]),_:2},1032,["onClick"])),64)):u("",!0)]),_:1})):u("",!0)]),h("div",ce,[k(G,{onSearch:Q,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, \u043D\u0430\u043A\u043B\u0430\u0434\u043A\u0430, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),e.value.orders?(n(),l(Z,{key:0,data:e.value.orders.data,onOnEdit:E,onOnDestroy:C,onOrderBy:N,statuses:a.statuses,canDestroy:d(v)("destroy-orders")},null,8,["data","statuses","canDestroy"])):u("",!0),h("div",le,[e.value.orders?(n(),l(H,{key:0,pagination:e.value.orders,"click-handler":K,modelValue:e.value.currentPage,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.currentPage=o)},null,8,["pagination","modelValue"])):u("",!0)])])]),(n(),l(O(d(U)),{order:e.value.orderModal,statuses:r.statuses,invoiceStatuses:r.invoiceStatuses,paymentMethods:r.payment_methods,size:"extralarge",onCloseModal:f,onDeclineForm:C,onSubmitForm:T,onSubmitItemForm:q,canDestroy:d(v)("destroy-orders"),onOnEditClient:z},null,40,["order","statuses","invoiceStatuses","paymentMethods","canDestroy"])),(n(),l(O(d(j)),{item:e.value.clientModal,statuses:e.value.clientsStatuses,"sub-statuses":e.value.clientsSubStatuses,size:"extralarge",onCloseModal:M,onSubmitForm:R},null,40,["item","statuses","sub-statuses"]))])):u("",!0)]),_:1}))}};export{Ae as default};
