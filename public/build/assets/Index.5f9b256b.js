import X from"./Modal.763f1187.js";import Y from"./Chart.d0eab3cc.js";import z from"./StatisticLayout.6047f21f.js";import H from"./LastParams.1a91c023.js";import{A as k,B as $,G as J,v as Q,V as f,S as s,R as r,$ as h,P as b,L as A,M as g,K as u,F as W,U as Z,O as _,Y as p,bc as ee,x as L,X as i}from"./moment.e1708d83.js";import"./Form.0f47ca35.js";import"./index.6a92ebc3.js";import"./app.b6e043f1.js";const te=p(" \u0412\u0438\u0442\u0440\u0430\u0442\u0438 "),oe={key:1},ae=p(" \u0414\u043E\u0434\u0430\u0442\u0438 "),le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-5"},se={class:"block"},ne={class:"block"},ie={class:"grid grid-cols-2 md:grid-cols-6"},ce=["onClick"],re=["onClick"],ye={__name:"Index",setup(ue){const d=L("$swal"),n=L("$can"),w={name:null,date:null,sum:null,quantity:1,comment:null,total:null,cost_category_id:null},t=k({data:[],chart:[],isLoading:!0,isActiveModal:!1,modalAction:"",item:{}}),a=k({date:[],filter:null,last:"one-month",page:1}),C=k([]),x=$(()=>{const e={};return a.value.filter&&(e.filter=a.value.filter),a.value.date.length===2&&(e.date_start=a.value.date[0],e.date_end=a.value.date[1]),a.value.last&&(e.last=a.value.last),e.page=a.value.page,e});function B(e){e?a.value.last=e:a.value={date:[],filter:null,last:null,page:1},c()}J(()=>{c(),axios.get(route("api.statistics.costs.categories.list")).then(({data:e})=>{e.result.forEach(l=>{C.value.push({value:l.title,key:l.id})})}).catch(e=>console.log(e))});const S=$(()=>t.value.isActiveModal?X:null),D=Q([{label:"ID",key:"id"},{label:"\u0414\u0430\u0442\u0430",key:"date"},{label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u044F",key:"category"},{label:"\u041A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C",key:"quantity"},{label:"\u0421\u0443\u043C\u0430",key:"sum"},{label:"\u0417\u0430\u0433\u0430\u043B\u043E\u043C",key:"total"},{label:"\u0412\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0430\u043B\u044C\u043D\u0438\u0439",key:"user"},{label:"\u041A\u043E\u043C\u0435\u043D\u0442\u0430\u0440",key:"comment"},{label:"\u041E\u043D\u043E\u0432\u043B\u0435\u043D\u043E<hr class='my-1'>\u0421\u0442\u0432\u043E\u0440\u0435\u043D\u043E",key:"timestamps"},{label:"#",key:"actions"}]);function F(){a.value.last="range",c()}function c(){t.value.isLoading=!0,axios.get(route("api.statistics.costs.index",x.value)).then(({data:e})=>{t.value.data=e,t.value.isLoading=!1}).catch(e=>{console.log(e),t.value.isLoading=!1}),axios.get(route("api.statistics.costs.chart",x.value)).then(({data:e})=>t.value.chart=e.result).catch(e=>console.log(e))}function V(e){n("destroy-colors")&&d({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(l=>{l.isConfirmed&&axios.delete(route("api.statistics.costs.destroy",e)).then(()=>{c(),t.value.isActiveModal&&v(),d({icon:"success",title:"Destroyed!"})}).catch(m=>{console.log(m),d({icon:"error",title:"Error!"})})})}function v(){t.value.isActiveModal=!t.value.isActiveModal}function E(e,l){n("edit-costs")&&axios.get(route("api.statistics.costs.edit",e)).then(({data:m})=>{t.value.item=m.result,t.value.modalAction="edit",t.value.item.index=l,v()}).catch(m=>console.log(m))}function U(){n("edit-costs")&&axios.put(route("api.statistics.costs.update",t.value.item.id),t.value.item).then(()=>{v(),c(),d({title:"Success!",icon:"success"})}).catch(e=>{console.log(e),d({title:"Error!",icon:"error"})})}function j(){n("create-costs")&&axios.post(route("api.statistics.costs.create"),t.value.item).then(()=>{v(),t.value.item=w,c(),d({title:"Success!",icon:"success"})}).catch(e=>{console.log(e),d({title:"Error!",icon:"error"})})}function N(){t.value.modalAction==="edit"&&n("edit-costs")?U():t.value.modalAction==="create"&&n("create-costs")&&j()}function O(){n("create-costs")&&(Object.assign(t.value.item,w),t.value.modalAction="create",v())}return(e,l)=>{const m=i("loader-component"),P=i("button-component"),M=i("label-component"),q=i("select-component"),I=i("Datepicker"),R=i("card-component"),T=i("xcircle-component"),G=i("table-component"),K=i("pagination");return r(),f(z,{title:"\u0412\u0438\u0442\u0440\u0430\u0442\u0438"},{header:s(()=>[te]),default:s(()=>[t.value.isLoading?(r(),f(m,{key:0})):h("",!0),!t.value.isLoading&&b(n)("show-bookkeeping-costs")?(r(),A("div",oe,[b(n)("create-costs")?(r(),f(P,{key:0,type:"btn",onClick:O},{default:s(()=>[ae]),_:1})):h("",!0),g("div",le,[g("div",se,[u(M,{value:"\u0424\u0456\u043B\u044C\u0442\u0440 \u043F\u043E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u0457"}),u(q,{modelValue:a.value.filter,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.filter=o),options:C.value,onChange:c},null,8,["modelValue","options"])]),g("div",ne,[u(M,{value:"\u0424\u0456\u043B\u044C\u0442\u0440 \u043F\u043E \u0434\u0430\u0442\u0456"}),u(I,{modelValue:a.value.date,"onUpdate:modelValue":[l[1]||(l[1]=o=>a.value.date=o),F],class:"w-100",locale:"ru",placeholder:"\u041E\u0431\u0435\u0440\u0456\u0442\u044C \u0434\u0430\u0442\u0443",autoApply:"",monthChangeOnScroll:!1,enableTimePicker:!1,range:""},null,8,["modelValue"])])]),u(H,{"active-item":a.value.last,onSortByLast:B},null,8,["active-item"]),t.value.chart?(r(),f(Y,{key:1,"chart-data":t.value.chart},null,8,["chart-data"])):h("",!0),g("div",ie,[(r(!0),A(W,null,Z(t.value.data.generalStat,(o,y)=>(r(),f(R,{class:"text-center",title:y,description:e.$filters.formatMoney(o)},null,8,["title","description"]))),256))]),u(G,{headings:D,rows:t.value.data.result.data,isSlotMode:!0},{id:s(({data:o})=>[g("a",{href:"javascript:",onClick:y=>E(o.row.id,o.i)},_(o.row.id),9,ce)]),date:s(({data:o})=>[p(_(e.$filters.dateFormat(o.row.date)),1)]),category:s(({data:o})=>[p(_(o.row.category.title),1)]),sum:s(({data:o})=>[p(_(e.$filters.formatMoney(o.row.sum)),1)]),total:s(({data:o})=>[p(_(e.$filters.formatMoney(o.row.total)),1)]),user:s(({data:o})=>[p(_(o.row.user?o.row.user.name:"-"),1)]),actions:s(({data:o})=>[g("a",{href:"javascript:",onClick:y=>V(o.row.id)},[u(T)],8,re)]),_:1},8,["headings","rows"]),u(K,{pagination:t.value.data.result,"click-handler":c,modelValue:a.value.page,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.page=o)},null,8,["pagination","modelValue"]),(r(),f(ee(b(S)),{item:t.value.item,onCloseModal:v,onSubmitForm:N,onDeclineForm:V},null,40,["item"]))])):h("",!0)]),_:1})}}};export{ye as default};
