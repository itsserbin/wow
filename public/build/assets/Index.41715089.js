import j from"./Modal.a119e4b5.js";import z from"./Table.1ffb8fc7.js";import U from"./CrmLayout.21d80a1a.js";import{j as q,r as w,S,q as I,k as J}from"./app.d11aea18.js";import{w as _,x as L,S as K,Q as u,K as i,X as A,F as l,P as d,B as v,y as h,z as f,J as m,M as C,O as E,L as y,A as M,a2 as Q}from"./___vite-browser-external_commonjs-proxy.4f2b06be.js";import"./Form.116ff326.js";import"./ItemsTable.07dd3858.js";const T=y(" \u041A\u043B\u0456\u0454\u043D\u0442\u0438 "),X={key:1},G={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},H={class:"md:col-span-1"},R={class:"w-full md:col-span-4 grid grid-cols-1 gap-4"},W={class:"text-center"},ie={__name:"Index",setup(Y){const x=[{title:"\u0415\u043A\u0441\u043F\u043E\u0440\u0442\u0443\u0432\u0430\u0442\u0438",key:"export"}],e=_({data:[],statuses:[],subStatuses:[],isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),o=_({status:null,currentPage:1}),$=L(()=>({page:o.value.currentPage,status:o.value.status?o.value.status:null})),p=_([]),n=A("$swal"),c=A("$can");K(()=>{r(),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.statuses=t.statuses,e.value.subStatuses=t.subStatuses,p.value.push({title:"\u0412\u0441\u0456 \u043A\u043B\u0456\u0454\u043D\u0442\u0438",key:"all"});for(const[s,a]of Object.entries(t.statuses))p.value.push({title:a,key:s})}),route().params.id&&(e.value.isLoading=!0,b(route().params.id))});const D=L(()=>e.value.isActiveEditModal?j:null),P=t=>{t==="export"&&(window.location.href=route("admin.crm.clients.export"))},B=async t=>{await axios.get(route("api.clients.search",{search:t})).then(({data:s})=>{e.value.sidebarActive=null,o.value.currentPage=1,e.value.data=s.result,e.value.isLoading=!1}).catch(s=>{console.log(s),e.value.isLoading=!1})},V=t=>{e.value.sidebarActive=t,o.value.status=t==="all"?null:t,r()},F=async t=>{t&&(o.value.currentPage=t),await r()},r=async()=>{await axios.get(route("api.clients.index",$.value)).then(({data:t})=>{e.value.data=t.result,e.value.isLoading=!1}).catch(t=>{console.log(t),e.value.isLoading=!1})},k=async t=>{c("destroy-clients")&&n({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(async s=>{s.isConfirmed&&await axios.delete(route("api.clients.destroy",t)).then(()=>{e.value.isLoading=!1,r(),e.value.isActiveEditModal&&g(),n({title:"Success!",icon:"success"})}).catch(a=>{console.log(a),n({title:"Error!",icon:"error"})})})},b=async(t,s)=>{await axios.get(route("api.clients.edit",t)).then(({data:a})=>{e.value.modal.index=s,e.value.modal=a.result,g(),e.value.isLoading=!1}).catch(a=>console.log(a))},N=async()=>{await axios.put(route("api.clients.update",e.value.modal.id),e.value.modal).then(()=>{g(),r(),n({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),n({title:"Error!",icon:"error"})})},g=()=>{e.value.isActiveEditModal=!e.value.isActiveEditModal};return(t,s)=>(l(),u(U,{title:"\u041A\u043B\u0456\u0454\u043D\u0442\u0438"},{header:i(()=>[T]),default:i(()=>[e.value.isLoading?(l(),u(q,{key:0})):d("",!0),!e.value.isLoading&&v(c)("show-clients")?(l(),h("div",X,[f("div",G,[f("div",H,[m(S,{class:"mb-5"},{default:i(()=>[p.value.length?(l(!0),h(C,{key:0},E(p.value,a=>(l(),u(w,{onClick:O=>V(a.key),active:e.value.sidebarActive===a.key},{default:i(()=>[y(M(a.title),1)]),_:2},1032,["onClick","active"]))),256)):d("",!0)]),_:1}),v(c)("export-orders")?(l(),u(S,{key:0},{default:i(()=>[x.length?(l(),h(C,{key:0},E(x,a=>m(w,{onClick:O=>P(a.key)},{default:i(()=>[y(M(a.title),1)]),_:2},1032,["onClick"])),64)):d("",!0)]),_:1})):d("",!0)]),f("div",R,[m(I,{onSearch:B,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u043F\u043E-\u0431\u0430\u0442\u044C\u043A\u043E\u0432\u0456, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, email, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),m(z,{data:e.value.data.data,onOnEdit:b,onOnDestroy:k,statuses:e.value.statuses,canDestroy:v(c)("destroy-clients")},null,8,["data","statuses","canDestroy"]),f("div",W,[m(J,{pagination:e.value.data,"click-handler":F,modelValue:o.value.currentPage,"onUpdate:modelValue":s[0]||(s[0]=a=>o.value.currentPage=a)},null,8,["pagination","modelValue"])])])]),(l(),u(Q(v(D)),{item:e.value.modal,statuses:e.value.statuses,"sub-statuses":e.value.subStatuses,size:"extralarge",onCloseModal:g,onDeclineForm:k,onSubmitForm:N,canDestroy:v(c)("destroy-clients")},null,40,["item","statuses","sub-statuses","canDestroy"]))])):d("",!0)]),_:1}))}};export{ie as default};
