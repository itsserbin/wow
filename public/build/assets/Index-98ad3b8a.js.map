{"version":3,"file":"Index-98ad3b8a.js","sources":["../../../resources/js/Pages/Admin/Statistics/CashFlow/Index.vue"],"sourcesContent":["<script setup>\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DataTable from 'primevue/datatable';\nimport Column from 'primevue/column';\nimport {computed, onMounted, reactive, ref} from \"vue\";\nimport Button from 'primevue/button';\nimport MultiSelect from 'primevue/multiselect';\nimport Chart from './Chart.vue';\n\nconst state = reactive({\n    data: [],\n    isLoading: true,\n});\n\nconst lazyParams = ref({\n    date: null,\n    page: 0,\n    first: 0,\n    rows: 15,\n    sortField: null,\n    sortOrder: null,\n});\n\nconst columns = reactive([\n    {name: 'Місяць', code: 'month'},\n    {name: 'Залишок на початок місяця', code: 'start_month_balance'},\n    {name: 'Надходження', code: 'approved_income'},\n    {name: 'Списання', code: 'approved_consumption'},\n    {name: 'Залишок на кінець місяця', code: 'end_month_balance'},\n    {name: 'Чистий грошовий потік', code: 'difference'},\n]);\n\nconst selectedColumns = ref(columns);\nconst expandedRows = ref([]);\nconst expandRowData = reactive({});\n\nconst getParams = computed(() => {\n    let sort = {};\n\n    if (lazyParams.value.sortField) {\n        sort.sort = lazyParams.value.sortField;\n\n        if (lazyParams.value.sortOrder === 1) {\n            sort.param = 'asc';\n        } else if (lazyParams.value.sortOrder === -1) {\n            sort.param = 'desc';\n        }\n    }\n\n    return {\n        perPage: lazyParams.value.rows || 15,\n        sort: sort.sort && sort.param ? sort.sort : null,\n        param: sort.sort && sort.param ? sort.param : null,\n        page: (lazyParams.value.page || 0) + 1,\n    };\n});\n\nonMounted(async () => {\n    await fetch();\n})\n\nconst fetch = async () => {\n    state.isLoading = true;\n    await axios.get(route('api.statistics.cash-flow', getParams.value))\n        .then(({data}) => state.data = data.result)\n        .catch((errors) => console.log(errors));\n    state.isLoading = false;\n}\n\nconst isSelectedColumn = (val) => {\n    return selectedColumns.value.some(item => item.code === val);\n}\n\nconst onPage = async (e) => {\n    lazyParams.value = e;\n    await fetch();\n}\n\nconst onSort = async (e) => {\n    lazyParams.value = e;\n    await fetch();\n}\n//\n// const onSelectDate = async (val) => {\n//     params.date = {\n//         startDate: val.startDate,\n//         endDate: val.endDate,\n//     }\n//     params.page = 1;\n//     await fetch();\n// }\n//\n// const getAllData = async () => {\n//     params.date = {\n//         startDate: null,\n//         endDate: null,\n//     }\n//     params.page = 1;\n//     await fetch();\n// }\n\nconst onRowExpand = async (event) => {\n    state.isLoading = true;\n    await axios.get(route('api.statistics.bank-card-movements.cost-and-profit', event.data.month))\n        .then(({data}) => {\n            expandRowData[event.data.id] = data.result;\n            state.isLoading = false;\n        });\n};\n</script>\n\n<template>\n    <StatisticLayout>\n        <template #header>\n            CashFlow\n        </template>\n\n        <div class=\"grid grid-cols-1 gap-4\">\n            <Chart v-if=\"state.data.data\" :data=\"state.data.data\"/>\n\n            <DataTable\n                resizableColumns\n                columnResizeMode=\"expand\"\n                v-model:expandedRows=\"expandedRows\"\n                @rowExpand=\"onRowExpand\"\n                selectionMode=\"single\"\n                ref=\"dt\"\n                dataKey=\"month\"\n                :loading=\"state.isLoading\"\n                :value=\"state.data.data\"\n                class=\"p-datatable-sm cash-flow-table\"\n                lazy\n                paginator\n                :rows=\"state.data.per_page\"\n                :totalRecords=\"state.data.total\"\n                @page=\"onPage($event)\"\n                @sort=\"onSort($event)\"\n                :rowsPerPageOptions=\"[15, 50, 100, 500]\"\n                paginatorTemplate=\"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown\"\n            >\n                <template #header>\n                    <MultiSelect v-model=\"selectedColumns\"\n                                 :options=\"columns\"\n                                 optionLabel=\"name\"\n                                 placeholder=\"Оберіть стовпці\"\n                                 class=\"w-full md:w-20rem\"\n                    />\n                </template>\n\n                <Column expander/>\n\n                <Column v-if=\"isSelectedColumn('month')\"\n                        sortable=\"\"\n                        field=\"month\"\n                        header=\"Місяць\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.dateFormat(data.month) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('start_month_balance')\"\n                        sortable=\"\"\n                        field=\"start_month_balance\"\n                >\n                    <template #header>\n                        Залишок<br>на початок місяця\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.start_month_balance) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('approved_income')\"\n                        sortable=\"\"\n                        field=\"approved_income\"\n                        header=\"Надходження\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.approved_income) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('approved_consumption')\"\n                        sortable=\"\"\n                        field=\"approved_consumption\"\n                        header=\"Списання\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.approved_consumption) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('end_month_balance')\"\n                        sortable=\"\"\n                        field=\"end_month_balance\"\n                >\n                    <template #header>\n                        Залишок<br>на кінець місяця\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.end_month_balance) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('difference')\"\n                        sortable=\"\"\n                        field=\"difference\"\n                >\n                    <template #header>\n                        Чистий<br>грошовий<br>потік\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.difference) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <template #footer>\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div class=\"flex items-center\">\n                            Показано з {{ state.data.from }} по {{ state.data.to }} із {{ state.data.total }} записів\n                        </div>\n                        <div class=\"flex justify-end\">\n                            <Button icon=\"pi pi-file-export\"\n                                    iconPos=\"right\"\n                                    type=\"button\"\n                                    label=\"Експортувати\"\n                                    @click=\"\"\n                            />\n                        </div>\n                    </div>\n                </template>\n\n                <template #expansion=\"slotProps\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <DataTable v-if=\"expandRowData[slotProps.data.id]\"\n                                   :value=\"expandRowData[slotProps.data.id].costs\"\n                                   class=\"p-datatable cash-flow-profits-table\"\n                        >\n                            <Column header=\"Витрати\">\n                                <template #body=\"{data}\">\n                                    {{ data.key }}\n                                </template>\n                            </Column>\n\n                            <Column>\n                                <template #body=\"{data}\">\n                                    {{ $filters.formatMoney(-data.value) }}\n                                </template>\n                            </Column>\n                        </DataTable>\n\n                        <DataTable v-if=\"expandRowData[slotProps.data.id]\"\n                                   :value=\"expandRowData[slotProps.data.id].profits\"\n                                   class=\"p-datatable cash-flow-profits-table\"\n                        >\n                            <Column header=\"Надходження\">\n                                <template #body=\"{data}\">\n                                    {{ data.key }}\n                                </template>\n                            </Column>\n\n                            <Column>\n                                <template #body=\"{data}\">\n                                    {{ $filters.formatMoney(data.value) }}\n                                </template>\n                            </Column>\n                        </DataTable>\n                    </div>\n                </template>\n            </DataTable>\n        </div>\n    </StatisticLayout>\n</template>\n\n<style>\n.cash-flow-table.p-datatable .p-column-header-content {\n    justify-content: center;\n    text-align: center;\n}\n\n.cash-flow-profits-table.p-datatable .p-column-header-content {\n    justify-content: start;\n}\n</style>\n"],"names":["state","reactive","lazyParams","ref","columns","selectedColumns","expandedRows","expandRowData","getParams","computed","sort","onMounted","fetch","data","errors","isSelectedColumn","val","item","onPage","onSort","onRowExpand","event"],"mappings":"ixCASA,MAAMA,EAAQC,EAAS,CACnB,KAAM,CAAE,EACR,UAAW,EACf,CAAC,EAEKC,EAAaC,EAAI,CACnB,KAAM,KACN,KAAM,EACN,MAAO,EACP,KAAM,GACN,UAAW,KACX,UAAW,IACf,CAAC,EAEKC,EAAUH,EAAS,CACrB,CAAC,KAAM,SAAU,KAAM,OAAO,EAC9B,CAAC,KAAM,4BAA6B,KAAM,qBAAqB,EAC/D,CAAC,KAAM,cAAe,KAAM,iBAAiB,EAC7C,CAAC,KAAM,WAAY,KAAM,sBAAsB,EAC/C,CAAC,KAAM,2BAA4B,KAAM,mBAAmB,EAC5D,CAAC,KAAM,wBAAyB,KAAM,YAAY,CACtD,CAAC,EAEKI,EAAkBF,EAAIC,CAAO,EAC7BE,EAAeH,EAAI,CAAA,CAAE,EACrBI,EAAgBN,EAAS,CAAA,CAAE,EAE3BO,EAAYC,EAAS,IAAM,CAC7B,IAAIC,EAAO,CAAA,EAEX,OAAIR,EAAW,MAAM,YACjBQ,EAAK,KAAOR,EAAW,MAAM,UAEzBA,EAAW,MAAM,YAAc,EAC/BQ,EAAK,MAAQ,MACNR,EAAW,MAAM,YAAc,KACtCQ,EAAK,MAAQ,SAId,CACH,QAASR,EAAW,MAAM,MAAQ,GAClC,KAAMQ,EAAK,MAAQA,EAAK,MAAQA,EAAK,KAAO,KAC5C,MAAOA,EAAK,MAAQA,EAAK,MAAQA,EAAK,MAAQ,KAC9C,MAAOR,EAAW,MAAM,MAAQ,GAAK,CAC7C,CACA,CAAC,EAEDS,EAAU,SAAY,CAClB,MAAMC,EAAK,CACf,CAAC,EAED,MAAMA,EAAQ,SAAY,CACtBZ,EAAM,UAAY,GAClB,MAAM,MAAM,IAAI,MAAM,2BAA4BQ,EAAU,KAAK,CAAC,EAC7D,KAAK,CAAC,CAAC,KAAAK,CAAI,IAAMb,EAAM,KAAOa,EAAK,MAAM,EACzC,MAAOC,GAAW,QAAQ,IAAIA,CAAM,CAAC,EAC1Cd,EAAM,UAAY,EACtB,EAEMe,EAAoBC,GACfX,EAAgB,MAAM,KAAKY,GAAQA,EAAK,OAASD,CAAG,EAGzDE,EAAS,MAAO,GAAM,CACxBhB,EAAW,MAAQ,EACnB,MAAMU,EAAK,CACf,EAEMO,EAAS,MAAO,GAAM,CACxBjB,EAAW,MAAQ,EACnB,MAAMU,EAAK,CACf,EAoBMQ,EAAc,MAAOC,GAAU,CACjCrB,EAAM,UAAY,GAClB,MAAM,MAAM,IAAI,MAAM,qDAAsDqB,EAAM,KAAK,KAAK,CAAC,EACxF,KAAK,CAAC,CAAC,KAAAR,CAAI,IAAM,CACdN,EAAcc,EAAM,KAAK,EAAE,EAAIR,EAAK,OACpCb,EAAM,UAAY,EAC9B,CAAS,CACT"}