import x from"./Modal-9b5813a2.js";import I from"./Table-23250d3b.js";import{L as V}from"./Loader-3f12bd2d.js";import{_ as b}from"./Button-18e692de.js";import{_ as B}from"./Paginate-7604e12b.js";import{_ as U}from"./Search-3c60f6f7.js";import E from"./ContentLayout-6476cabf.js";import{P as r}from"./ProductsRepository-30e2f09f.js";import{u as F}from"./vue-i18n.esm-bundler-39f45a4f.js";import{s as c}from"./swal-76588f7d.js";import{i as O,G as R,r as j,o as z,j as q,p as u,D as m,x as v,A as y,B as L,C as f,t as d,q as G,v as w,l as g,J}from"./app-6d1ec759.js";import"./Modal-1e77e375.js";import"./Form-d0f7a1ba.js";import"./Images-69b4c0a2.js";import"./ImageCard-f6ab6853.js";import"./XCircle-0fb660d3.js";import"./swiper-slide-5d66ba81.js";import"./navigation-26d64441.js";import"./ImagesSelectModal-13ddc8c3.js";import"./UploadImagesModal-764d5655.js";import"./UploadImagesInput-b445dfef.js";import"./Label-646a10b8.js";import"./Textarea-8cacefaf.js";import"./Input-335d7e3d.js";import"./Select-ffba6ec3.js";import"./LangTabs-75b411e7.js";import"./CharacteristicsRepository-3e7466ab.js";import"./Multiselect-55904e29.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Editor-b0ed515a.js";import"./Table-d4015883.js";import"./AuthenticatedLayout-53775af0.js";import"./index.esm-09a1b1ab.js";import"./Logo-7b0b10d2.js";const T={key:1,class:"grid gap-4 grid-cols-1"},H={class:"grid grid-cols-1 gap-4"},K={class:"text-center"},Se={__name:"Index",setup(Q){const o=O("$can"),{t:i}=F(),p=R({status:null,title:{ru:null,ua:null},characteristics:{ru:null,ua:null},description:{ru:null,ua:null},h1:{ru:null,ua:null},content:{ru:null,ua:null},characteristicsNew:{},published:0,preview:null,size_table:null,price:null,trade_price:null,discount_price:null,categories:[],vendor_code:null,provider_id:null,youtube:null,sizes:[],images:[],colors:[]}),e=j({products:[],currentPage:1,isLoading:!0,isActiveModal:!1,modalAction:"",item:p,errors:[]});z(()=>{let t=new URLSearchParams(new URL(window.location.href).search).get("product");t&&h(t),l(1)});const P=q(()=>e.value.isActiveModal?x:null),A=async t=>{e.value.isLoading=!0;const a=await r.search(t);a.success&&(e.value.currentPage=1,e.value.products=a.result),e.value.isLoading=!1},l=async t=>{e.value.isLoading=!0,t&&(e.value.currentPage=t);const a=await r.fetch({page:e.value.currentPage});e.value.products=a.success?a.result:[],e.value.isLoading=!1},_=async t=>{if(o("destroy-products")&&(await c({title:i("swal.sure"),icon:"warning",showCancelButton:!0})).isConfirmed){const{success:s}=await r.destroy(t);s&&(await l(),e.value.isActiveModal&&n(),await c({icon:"success",title:i("swal.destroyed")}))}},n=()=>{e.value.isActiveModal=!e.value.isActiveModal},h=async t=>{e.value.isLoading=!0;const a=await r.edit(t);a.success&&(e.value.item=a.result,e.value.item.characteristicsNew={},e.value.item.characteristics_new.length&&(e.value.item.characteristics_new.forEach(s=>{e.value.item.characteristicsNew[s.characteristic_id]=[]}),e.value.item.characteristics_new.forEach(s=>{e.value.item.characteristicsNew[s.characteristic_id].push(s)})),e.value.modalAction="edit",n()),e.value.isLoading=!1},D=async()=>{if(o("edit-products")){const t=await r.update(e.value.item);t.success?(n(),await l(),await c({title:i("swal.updated"),icon:"success"})):(e.value.errors=t,console.log(t),await c({title:i("swal.error"),icon:"error",text:i("swal.check_data")}))}},$=async()=>{if(o("create-products")){const t=await r.create(e.value.item);t.success?(n(),e.value.item=p,await l(),await c({title:i("swal.created"),icon:"success"})):(e.value.errors=t,console.log(t),await c({title:i("swal.error"),text:i("swal.check_data"),icon:"error"}))}},k=async()=>{e.value.modalAction==="edit"&&o("edit-products")?await D():e.value.modalAction==="create"&&o("create-products")&&await $()},C=()=>{o("create-products")&&(e.value.item=p,e.value.modalAction="create",n())},M=t=>{e.value.item.images=e.value.item.images.concat(t)},N=t=>{let a=e.value.item.images.findIndex(s=>s.id===t);e.value.item.images.splice(a,1)},S=async(t,a)=>{e.value.isLoading=!0,(await r.updateSort(t,a)).success&&await c({title:i("swal.updated"),icon:"success"}),e.value.isLoading=!1};return(t,a)=>(u(),m(E,{title:t.$t("products.page_title")},{header:v(()=>[y(L(t.$t("products.page_title")),1)]),default:v(()=>[e.value.isLoading?(u(),m(V,{key:0})):f("",!0),!e.value.isLoading&&d(o)("show-products")?(u(),G("div",T,[w("div",null,[d(o)("create-products")?(u(),m(b,{key:0,type:"btn",onClick:C},{default:v(()=>[y(L(t.$t("add")),1)]),_:1})):f("",!0)]),w("div",H,[g(U,{onSearch:A,clear:!0,placeholder:t.$t("products.search_placeholder"),onOnClear:l},null,8,["placeholder"]),g(I,{data:e.value.products.data,onOnEdit:h,onOnDestroy:_,canDestroy:d(o)("destroy-products"),onOnUpdateProductSort:S},null,8,["data","canDestroy"])]),w("div",K,[g(B,{pagination:e.value.products,"click-handler":l,modelValue:e.value.currentPage,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.currentPage=s)},null,8,["pagination","modelValue"])])])):f("",!0),(u(),m(J(d(P)),{item:e.value.item,onCloseModal:n,onSubmitForm:k,onDeclineForm:_,onSetProductImages:M,onDestroyImage:N,canDestroy:d(o)("destroy-products")},null,40,["item","canDestroy"]))]),_:1},8,["title"]))}};export{Se as default};
