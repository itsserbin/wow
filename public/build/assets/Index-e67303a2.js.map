{"version":3,"file":"Index-e67303a2.js","sources":["../../../resources/js/Pages/Admin/Statistics/ProfitAndLoss/Index.vue"],"sourcesContent":["<script setup>\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DataTable from 'primevue/datatable';\nimport Column from 'primevue/column';\nimport {computed, onMounted, reactive, ref} from \"vue\";\nimport Button from 'primevue/button';\nimport MultiSelect from 'primevue/multiselect';\nimport Chart from './Chart.vue';\n\nconst state = reactive({\n    data: [],\n    isLoading: true,\n});\n\nconst lazyParams = ref({\n    date: null,\n    page: 0,\n    first: 0,\n    rows: 15,\n    sortField: null,\n    sortOrder: null,\n});\n\nconst columns = reactive([\n    {name: 'Місяць', code: 'month'},\n    {name: 'Загальна виручка', code: 'total_revenues'},\n    {name: 'Витрати', code: 'costs'},\n    {name: 'Інвестиції', code: 'investments'},\n    {name: 'Повернення інвестицій', code: 'returned_investments'},\n    {name: 'Дивіденди', code: 'dividends'},\n    {name: 'Ціна закупки', code: 'purchase_cost'},\n    {name: 'Чистий прибуток', code: 'net_profit'},\n    {name: 'Рентабельність', code: 'business_profitability'},\n]);\n\nconst selectedColumns = ref(columns);\n\nconst expandedRows = ref([]);\nconst expandRowData = reactive({});\n\nconst getParams = computed(() => {\n    let sort = {};\n\n    if (lazyParams.value.sortField) {\n        sort.sort = lazyParams.value.sortField;\n\n        if (lazyParams.value.sortOrder === 1) {\n            sort.param = 'asc';\n        } else if (lazyParams.value.sortOrder === -1) {\n            sort.param = 'desc';\n        }\n    }\n\n    return {\n        perPage: lazyParams.value.rows || 15,\n        sort: sort.sort && sort.param ? sort.sort : null,\n        param: sort.sort && sort.param ? sort.param : null,\n        page: (lazyParams.value.page || 0) + 1,\n    };\n});\n\nonMounted(async () => {\n    await fetch();\n})\n\n\nconst onRowExpand = async (event) => {\n    state.isLoading = true;\n    const {data} = await axios.get(route('api.statistics.bank-card-movements.cost-and-profit', event.data.month))\n    if (data.success) {\n        expandRowData[event.data.id] = data.result\n    }\n    state.isLoading = false;\n};\n\nconst isSelectedColumn = (val) => {\n    return selectedColumns.value.some(item => item.code === val);\n}\n\nconst fetch = async () => {\n    state.isLoading = true;\n    await axios.get(route('api.statistics.profit-and-loss', getParams.value))\n        .then(({data}) => state.data = data.result)\n        .catch((errors) => console.log(errors));\n    state.isLoading = false;\n}\n\nconst onPage = async (e) => {\n    lazyParams.value = e;\n    await fetch();\n}\n\nconst onSort = async (e) => {\n    lazyParams.value = e;\n    await fetch();\n}\n\n\n</script>\n\n<template>\n    <StatisticLayout>\n        <template #header>\n            P&L\n        </template>\n\n        <div class=\"grid grid-cols-1 gap-4\">\n            <Chart v-if=\"state.data.data\" :data=\"state.data.data\"/>\n            <DataTable\n                resizableColumns\n                columnResizeMode=\"expand\"\n                v-model:expandedRows=\"expandedRows\"\n                @rowExpand=\"onRowExpand\"\n                selectionMode=\"single\"\n                ref=\"dt\"\n                dataKey=\"month\"\n                :loading=\"state.isLoading\"\n                :value=\"state.data.data\"\n                class=\"p-datatable-sm profit-and-loss-table\"\n                lazy\n                paginator\n                :rows=\"state.data.per_page\"\n                :totalRecords=\"state.data.total\"\n                @page=\"onPage($event)\"\n                @sort=\"onSort($event)\"\n                :rowsPerPageOptions=\"[15, 50, 100, 500]\"\n                paginatorTemplate=\"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown\"\n            >\n                <template #header>\n                    <MultiSelect v-model=\"selectedColumns\"\n                                 :options=\"columns\"\n                                 optionLabel=\"name\"\n                                 placeholder=\"Оберіть стовпці\"\n                                 class=\"w-full md:w-20rem\"\n                    />\n                </template>\n\n                <Column expander/>\n\n                <Column v-if=\"isSelectedColumn('month')\"\n                        sortable\n                        field=\"month\"\n                        header=\"Місяць\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.monthFormat(data.month) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('total_revenues')\"\n                        sortable\n                        field=\"total_revenues\"\n                >\n                    <template #header>\n                        Загальна<br/>виручка\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.total_revenues) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('costs')\"\n                        sortable\n                        field=\"costs\"\n                        header=\"Витрати\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(-data.costs) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('investments')\"\n                        sortable\n                        field=\"investments\"\n                        header=\"Інвестиції\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.investments) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('returned_investments')\"\n                        sortable\n                        field=\"returned_investments\"\n                >\n                    <template #header>\n                        Повернення<br/>інвестицій\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(-data.returned_investments) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('dividends')\"\n                        sortable\n                        field=\"dividends\"\n                        header=\"Дивіденди\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(-data.dividends) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('purchase_cost')\"\n                        sortable\n                        field=\"purchase_cost\"\n                >\n                    <template #header>\n                        Ціна<br/>закупки\n                    </template>\n\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.purchase_cost) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('net_profit')\"\n                        sortable\n                        field=\"net_profit\"\n                >\n                    <template #header>\n                        Чистий<br/>прибуток\n                    </template>\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ $filters.formatMoney(data.net_profit) }}\n                        </div>\n                    </template>\n                </Column>\n\n                <Column v-if=\"isSelectedColumn('business_profitability')\"\n                        sortable\n                        field=\"business_profitability\"\n                        header=\"Рентабельність\"\n                >\n                    <template #body=\"{data}\">\n                        <div class=\"text-center whitespace-nowrap\">\n                            {{ data.business_profitability }} %\n                        </div>\n                    </template>\n                </Column>\n\n                <template #footer>\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div class=\"flex items-center\">\n                            Показано з {{ state.data.from }} по {{ state.data.to }} із {{ state.data.total }} записів\n                        </div>\n                        <div class=\"flex justify-end\">\n                            <Button icon=\"pi pi-file-export\"\n                                    iconPos=\"right\"\n                                    type=\"button\"\n                                    label=\"Експортувати\"\n                                    @click=\"\"\n                            />\n                        </div>\n                    </div>\n                </template>\n\n                <template #expansion=\"slotProps\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <DataTable v-if=\"expandRowData[slotProps.data.id]\"\n                                   :value=\"expandRowData[slotProps.data.id].costs\"\n                                   class=\"p-datatable profit-and-loss-inner-table\"\n                        >\n                            <Column header=\"Витрати\">\n                                <template #body=\"{data}\">\n                                    {{ data.key }}\n                                </template>\n                            </Column>\n\n                            <Column>\n                                <template #body=\"{data}\">\n                                    {{ $filters.formatMoney(-data.value) }}\n                                </template>\n                            </Column>\n                        </DataTable>\n\n                        <DataTable v-if=\"expandRowData[slotProps.data.id]\"\n                                   :value=\"expandRowData[slotProps.data.id].profits\"\n                                   class=\"p-datatable profit-and-loss-inner-table\"\n                        >\n                            <Column header=\"Надходження\">\n                                <template #body=\"{data}\">\n                                    {{ data.key }}\n                                </template>\n                            </Column>\n\n                            <Column>\n                                <template #body=\"{data}\">\n                                    {{ $filters.formatMoney(data.value) }}\n                                </template>\n                            </Column>\n                        </DataTable>\n                    </div>\n                </template>\n\n            </DataTable>\n        </div>\n    </StatisticLayout>\n</template>\n\n<style>\n.profit-and-loss-table.p-datatable .p-column-header-content {\n    justify-content: center;\n    text-align: center;\n}\n\n.profit-and-loss-inner-table.p-datatable .p-column-header-content {\n    justify-content: start;\n}\n</style>\n"],"names":["state","reactive","lazyParams","ref","columns","selectedColumns","expandedRows","expandRowData","getParams","computed","sort","onMounted","fetch","onRowExpand","event","data","isSelectedColumn","val","item","errors","onPage","onSort"],"mappings":"q4CASA,MAAMA,EAAQC,EAAS,CACnB,KAAM,CAAE,EACR,UAAW,EACf,CAAC,EAEKC,EAAaC,EAAI,CACnB,KAAM,KACN,KAAM,EACN,MAAO,EACP,KAAM,GACN,UAAW,KACX,UAAW,IACf,CAAC,EAEKC,EAAUH,EAAS,CACrB,CAAC,KAAM,SAAU,KAAM,OAAO,EAC9B,CAAC,KAAM,mBAAoB,KAAM,gBAAgB,EACjD,CAAC,KAAM,UAAW,KAAM,OAAO,EAC/B,CAAC,KAAM,aAAc,KAAM,aAAa,EACxC,CAAC,KAAM,wBAAyB,KAAM,sBAAsB,EAC5D,CAAC,KAAM,YAAa,KAAM,WAAW,EACrC,CAAC,KAAM,eAAgB,KAAM,eAAe,EAC5C,CAAC,KAAM,kBAAmB,KAAM,YAAY,EAC5C,CAAC,KAAM,iBAAkB,KAAM,wBAAwB,CAC3D,CAAC,EAEKI,EAAkBF,EAAIC,CAAO,EAE7BE,EAAeH,EAAI,CAAA,CAAE,EACrBI,EAAgBN,EAAS,CAAA,CAAE,EAE3BO,EAAYC,EAAS,IAAM,CAC7B,IAAIC,EAAO,CAAA,EAEX,OAAIR,EAAW,MAAM,YACjBQ,EAAK,KAAOR,EAAW,MAAM,UAEzBA,EAAW,MAAM,YAAc,EAC/BQ,EAAK,MAAQ,MACNR,EAAW,MAAM,YAAc,KACtCQ,EAAK,MAAQ,SAId,CACH,QAASR,EAAW,MAAM,MAAQ,GAClC,KAAMQ,EAAK,MAAQA,EAAK,MAAQA,EAAK,KAAO,KAC5C,MAAOA,EAAK,MAAQA,EAAK,MAAQA,EAAK,MAAQ,KAC9C,MAAOR,EAAW,MAAM,MAAQ,GAAK,CAC7C,CACA,CAAC,EAEDS,EAAU,SAAY,CAClB,MAAMC,EAAK,CACf,CAAC,EAGD,MAAMC,EAAc,MAAOC,GAAU,CACjCd,EAAM,UAAY,GAClB,KAAM,CAAC,KAAAe,CAAI,EAAI,MAAM,MAAM,IAAI,MAAM,qDAAsDD,EAAM,KAAK,KAAK,CAAC,EACxGC,EAAK,UACLR,EAAcO,EAAM,KAAK,EAAE,EAAIC,EAAK,QAExCf,EAAM,UAAY,EACtB,EAEMgB,EAAoBC,GACfZ,EAAgB,MAAM,KAAKa,GAAQA,EAAK,OAASD,CAAG,EAGzDL,EAAQ,SAAY,CACtBZ,EAAM,UAAY,GAClB,MAAM,MAAM,IAAI,MAAM,iCAAkCQ,EAAU,KAAK,CAAC,EACnE,KAAK,CAAC,CAAC,KAAAO,CAAI,IAAMf,EAAM,KAAOe,EAAK,MAAM,EACzC,MAAOI,GAAW,QAAQ,IAAIA,CAAM,CAAC,EAC1CnB,EAAM,UAAY,EACtB,EAEMoB,EAAS,MAAO,GAAM,CACxBlB,EAAW,MAAQ,EACnB,MAAMU,EAAK,CACf,EAEMS,EAAS,MAAO,GAAM,CACxBnB,EAAW,MAAQ,EACnB,MAAMU,EAAK,CACf"}