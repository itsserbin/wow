/*! maska v2.1.8 | (c) Alexander Shabunevich | Released under the MIT license */var W=Object.defineProperty,L=(n,t,s)=>t in n?W(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,g=(n,t,s)=>(L(n,typeof t!="symbol"?t+"":t,s),s);const b={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class w{constructor(t={}){g(this,"opts",{}),g(this,"memo",new Map);var s;const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...b,...e.tokens};for(const a of Object.values(e.tokens))typeof a.pattern=="string"&&(a.pattern=new RegExp(a.pattern))}else e.tokens=b;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((a,i)=>a.length-i.length):e.mask=(s=e.mask[0])!=null?s:""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const s=this.findMask(t);if(this.opts.mask==null||s==null)return!1;const e=this.process(t,s).length;return typeof this.opts.mask=="string"?e>=this.opts.mask.length:typeof this.opts.mask=="function"?e>=s.length:this.opts.mask.filter(a=>e>=a.length).length===this.opts.mask.length}findMask(t){var s,e;const a=this.opts.mask;if(a==null)return null;if(typeof a=="string")return a;if(typeof a=="function")return a(t);const i=this.process(t,(s=a.slice(-1).pop())!=null?s:"",!1);return(e=a.find(r=>this.process(t,r,!1).length>=i.length))!=null?e:""}escapeMask(t){const s=[],e=[];return t.split("").forEach((a,i)=>{a==="!"&&t[i-1]!=="!"?e.push(i-e.length):s.push(a)}),{mask:s.join(""),escaped:e}}process(t,s,e=!0){var a;if(s==null)return t;const i=`value=${t},mask=${s},masked=${e?1:0}`;if(this.memo.has(i))return this.memo.get(i);const{mask:r,escaped:p}=this.escapeMask(s),h=[],m=this.opts.tokens!=null?this.opts.tokens:{},l=this.isReversed()?-1:1,d=this.isReversed()?"unshift":"push",v=this.isReversed()?0:r.length-1,S=this.isReversed()?()=>o>-1&&u>-1:()=>o<r.length&&u<t.length,V=k=>!this.isReversed()&&k<=v||this.isReversed()&&k>=v;let y,f=-1,o=this.isReversed()?r.length-1:0,u=this.isReversed()?t.length-1:0;for(;S();){const k=r.charAt(o),c=m[k],E=(c==null?void 0:c.transform)!=null?c.transform(t.charAt(u)):t.charAt(u);if(!p.includes(o)&&c!=null){if(E.match(c.pattern)!=null)h[d](E),c.repeated?(f===-1?f=o:o===v&&o!==f&&(o=f-l),v===f&&(o-=l)):c.multiple&&(o-=l),o+=l;else if(c.multiple){const P=((a=h[u-l])==null?void 0:a.match(c.pattern))!=null,R=r.charAt(o+l);P&&R!==""&&m[R]==null?(o+=l,u-=l):h[d]("")}else E===y?y=void 0:c.optional&&(o+=l,u-=l);u+=l}else e&&!this.isEager()&&h[d](k),E===k&&!this.isEager()?u+=l:y=k,this.isEager()||(o+=l);if(this.isEager())for(;V(o)&&(m[r.charAt(o)]==null||p.includes(o));)e?h[d](r.charAt(o)):r.charAt(o)===t.charAt(u)&&(u+=l),o+=l}return this.memo.set(i,h.join("")),this.memo.get(i)}}const T=n=>JSON.parse(n.replaceAll("'",'"')),O=(n,t={})=>{const s={...t};return n.dataset.maska!=null&&n.dataset.maska!==""&&(s.mask=j(n.dataset.maska)),n.dataset.maskaEager!=null&&(s.eager=M(n.dataset.maskaEager)),n.dataset.maskaReversed!=null&&(s.reversed=M(n.dataset.maskaReversed)),n.dataset.maskaTokensReplace!=null&&(s.tokensReplace=M(n.dataset.maskaTokensReplace)),n.dataset.maskaTokens!=null&&(s.tokens=C(n.dataset.maskaTokens)),s},M=n=>n!==""?!!JSON.parse(n):!0,j=n=>n.startsWith("[")&&n.endsWith("]")?T(n):n,C=n=>{if(n.startsWith("{")&&n.endsWith("}"))return T(n);const t={};return n.split("|").forEach(s=>{const e=s.split(":");t[e[0]]={pattern:new RegExp(e[1]),optional:e[2]==="optional",multiple:e[2]==="multiple",repeated:e[2]==="repeated"}}),t};class J{constructor(t,s={}){g(this,"items",new Map),g(this,"beforeinputEvent",e=>{const a=e.target,i=this.items.get(a);i.isEager()&&"inputType"in e&&e.inputType.startsWith("delete")&&i.unmasked(a.value).length<=1&&this.setMaskedValue(a,"")}),g(this,"inputEvent",e=>{if(e instanceof CustomEvent&&e.type==="input"&&e.detail!=null&&typeof e.detail=="object"&&"masked"in e.detail)return;const a=e.target,i=this.items.get(a),r=a.value,p=a.selectionStart,h=a.selectionEnd;let m=r;if(i.isEager()){const l=i.masked(r),d=i.unmasked(r);d===""&&"data"in e&&e.data!=null?m=e.data:d!==i.unmasked(l)&&(m=d)}if(this.setMaskedValue(a,m),"inputType"in e&&(e.inputType.startsWith("delete")||p!=null&&p<r.length))try{a.setSelectionRange(p,h)}catch{}}),this.options=s,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(s)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(s))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,s){const e=this.items.get(t),a=new w(O(t,this.getMaskOpts(s)));return JSON.stringify(e.opts)!==JSON.stringify(a.opts)}needUpdateValue(t){const s=t.dataset.maskaValue;return s==null&&t.value!==""||s!=null&&s!==t.value}getMaskOpts(t){const{onMaska:s,preProcess:e,postProcess:a,...i}=t;return i}init(t,s){for(const e of t){const a=new w(O(e,s));this.items.set(e,a),e.value!==""&&this.setMaskedValue(e,e.value),e.addEventListener("input",this.inputEvent),e.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,s){const e=this.items.get(t);this.options.preProcess!=null&&(s=this.options.preProcess(s));const a=e.masked(s),i=e.unmasked(e.isEager()?a:s),r=e.completed(s),p={masked:a,unmasked:i,completed:r};s=a,this.options.postProcess!=null&&(s=this.options.postProcess(s)),t.value=s,t.dataset.maskaValue=s,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(h=>h(p)):this.options.onMaska(p)),t.dispatchEvent(new CustomEvent("maska",{detail:p})),t.dispatchEvent(new CustomEvent("input",{detail:p}))}}const A=new WeakMap,N=n=>{setTimeout(()=>{var t;((t=A.get(n))==null?void 0:t.needUpdateValue(n))===!0&&n.dispatchEvent(new CustomEvent("input"))})},U=(n,t)=>{const s=n instanceof HTMLInputElement?n:n.querySelector("input"),e={...t.arg};if(s==null)return;N(s);const a=A.get(s);if(a!=null){if(!a.needUpdateOptions(s,e))return;a.destroy()}if(t.value!=null){const i=t.value,r=p=>{i.masked=p.masked,i.unmasked=p.unmasked,i.completed=p.completed};e.onMaska=e.onMaska==null?r:Array.isArray(e.onMaska)?[...e.onMaska,r]:[e.onMaska,r]}A.set(s,new J(s,e))};export{U};
