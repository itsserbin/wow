import J from"./Indicators.f933bdbf.js";import K from"./Modal.2a674d3c.js";import Q from"./Table.e45cf83c.js";import X from"./CrmLayout.ce84bb25.js";import{j as G,r as C,S as D,q as H,k as W}from"./app.aaf89546.js";import{_ as Y}from"./Datepicker.93212538.js";import{C as v}from"./ClientsRepository.843bcbc3.js";import{bT as Z,w,x as h,S as ee,Q as m,K as r,X as P,F as o,L,A as b,P as f,B as g,y as $,z as _,J as i,M as A,O as M,a2 as ae}from"./___vite-browser-external_commonjs-proxy.4f2b06be.js";import"./Form.477723c8.js";import"./ItemsTable.0d23e31e.js";const te={key:1},se={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},le={class:"md:col-span-1"},oe={class:"w-full md:col-span-4 grid grid-cols-1 gap-4"},ne={class:"text-center"},pe={__name:"Index",props:["statuses","subStatuses","orderStatuses"],setup(u){const V=u,{t:c}=Z(),k=P("$swal"),d=P("$can"),y=w([]),S=[{title:c("clients.export"),key:"export"}],a=w({data:[],indicators:{},isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),s=w({status:null,currentPage:1,orderBy:{key:null,val:null},date:[]}),E=h(()=>{if(s.value.date.length===2)return{date_start:s.value.date[0].toLocaleDateString(),date_end:s.value.date[1].toLocaleDateString()}}),F=h(()=>{const{currentPage:e,status:l=null,orderBy:t=null}=s.value;return{page:e,status:l,orderBy:t,...E.value}}),O=(e,l)=>{s.value.orderBy={key:e,val:l},s.value.currentPage=1,n()};ee(()=>{n(),y.value.push({title:c("clients.all_clients"),key:"all"});for(const[e,l]of Object.entries(V.statuses))y.value.push({title:l,key:e});route().params.id&&(a.value.isLoading=!0,B(route().params.id))});const N=h(()=>a.value.isActiveEditModal?K:null),j=e=>{e==="export"&&(window.location.href=route("admin.crm.clients.export"))},U=async e=>{a.value.isLoading=!0;const l=await v.search(e);l.success&&(a.value.sidebarActive=null,s.value.currentPage=1,a.value.data=l.result,a.value.isLoading=!1),a.value.isLoading=!1},z=e=>{a.value.sidebarActive=e,s.value.status=e==="all"?null:e,s.value.date=[],s.value.currentPage=1,n()},I=async()=>{s.value.currentPage=1,await n()},R=async e=>{e&&(s.value.currentPage=e),await n()},n=async()=>{a.value.isLoading=!0;const e=await v.fetch(F.value);e.success&&(a.value.indicators=e.indicators,a.value.data=e.result,a.value.isLoading=!1)},x=async e=>{if(d("destroy-clients")&&(await k({title:c("swal.sure"),icon:"warning",showCancelButton:!0})).isConfirmed){const{success:t}=await v.destroy(e);t&&(a.value.isLoading=!1,await n(),a.value.isActiveEditModal&&p(),k({title:c("swal.destroyed"),icon:"success"}))}},B=async(e,l)=>{a.value.isLoading=!0;const t=await v.edit(e);t.success&&(a.value.modal.index=l,a.value.modal=t.result,p(),a.value.isLoading=!1)},T=async()=>{(await v.update(a.value.modal)).success&&(p(),await n(),k({title:c("swal.updated"),icon:"success"}))},p=()=>{a.value.isActiveEditModal=!a.value.isActiveEditModal};return(e,l)=>(o(),m(X,{title:e.$t("clients.page_title")},{header:r(()=>[L(b(e.$t("clients.page_title")),1)]),default:r(()=>[a.value.isLoading?(o(),m(G,{key:0})):f("",!0),!a.value.isLoading&&g(d)("show-clients")?(o(),$("div",te,[_("div",se,[_("div",le,[i(D,{class:"mb-5"},{default:r(()=>[y.value.length?(o(!0),$(A,{key:0},M(y.value,t=>(o(),m(C,{onClick:q=>z(t.key),active:a.value.sidebarActive===t.key},{default:r(()=>[L(b(t.title),1)]),_:2},1032,["onClick","active"]))),256)):f("",!0)]),_:1}),g(d)("export-orders")?(o(),m(D,{key:0},{default:r(()=>[S.length?(o(),$(A,{key:0},M(S,t=>i(C,{onClick:q=>j(t.key)},{default:r(()=>[L(b(t.title),1)]),_:2},1032,["onClick"])),64)):f("",!0)]),_:1})):f("",!0)]),_("div",oe,[i(Y,{modelValue:s.value.date,"onUpdate:modelValue":[l[0]||(l[0]=t=>s.value.date=t),I]},null,8,["modelValue"]),i(J,{data:a.value.indicators},null,8,["data"]),i(H,{onSearch:U,clear:!0,placeholder:e.$t("clients.search_placeholder")},null,8,["placeholder"]),i(Q,{data:a.value.data.data,onOnEdit:B,onOnDestroy:x,onOrderBy:O,statuses:u.statuses,canDestroy:g(d)("destroy-clients")},null,8,["data","statuses","canDestroy"]),_("div",ne,[i(W,{pagination:a.value.data,"click-handler":R,modelValue:s.value.currentPage,"onUpdate:modelValue":l[1]||(l[1]=t=>s.value.currentPage=t)},null,8,["pagination","modelValue"])])])]),(o(),m(ae(g(N)),{item:a.value.modal,statuses:u.statuses,"sub-statuses":u.subStatuses,"order-statuses":u.orderStatuses,size:"extralarge",onCloseModal:p,onDeclineForm:x,onSubmitForm:T,canDestroy:g(d)("destroy-clients")},null,40,["item","statuses","sub-statuses","order-statuses","canDestroy"]))])):f("",!0)]),_:1},8,["title"]))}};export{pe as default};
