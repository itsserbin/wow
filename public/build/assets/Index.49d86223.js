import X from"./Modal.f636ee26.js";import Y from"./Modal.286832b4.js";import Z from"./Table.ee5074fa.js";import q from"./CrmLayout.5c6be500.js";import{y,z as x,C as G,a0 as c,X as g,B as A,V as d,S as i,_ as b,P as v,L as E,M as f,K as h,F as H,Z as J,Y as F,O as Q,bg as L}from"./___vite-browser-external_commonjs-proxy.af1999bf.js";import"./Form.74bfbc13.js";import"./ItemsTable.4446611c.js";import"./Form.2a695ec2.js";import"./ItemsModal.1efefcf6.js";import"./ItemsForm.42ea30d6.js";import"./ItemsTable.b3b762ea.js";import"./ClientOrders.6224da27.js";import"./app.da88e093.js";const R=F(" \u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F "),W={key:1},ee={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},te={class:"md:col-span-1"},oe={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},ae={class:"text-center"},_e={__name:"Index",props:["statuses","payment_methods"],setup(S){const _=S,e=y({orders:[],currentPage:1,isLoading:!0,isActiveEditModal:!1,isActiveClientModal:!1,sidebarActive:"all",orderModal:{},clientModal:{},clientsStatuses:null,clientsSubStatuses:null}),p=y([]),a=A("$swal"),n=A("$can"),s=y({status:null,currentPage:1}),P=x(()=>{const t={};return t.page=s.value.currentPage,s.value.status&&(t.status=s.value.status),t});G(()=>{r(),p.value.push({title:"\u0412\u0441\u0456 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F",key:"all"});for(const[t,o]of Object.entries(_.statuses))p.value.push({title:o,key:t});route().params.id&&(e.value.isLoading=!0,k(route().params.id)),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.clientsStatuses=t.statuses,e.value.clientsSubStatuses=t.subStatuses})});const D=x(()=>e.value.isActiveEditModal?Y:null),V=x(()=>e.value.isActiveClientModal?X:null);function w(){axios.get(route("api.clients.edit",e.value.orderModal.client.id)).then(({data:t})=>{e.value.clientModal=t.result,M()}).catch(t=>console.log(t))}function M(){e.value.isActiveClientModal=!e.value.isActiveClientModal}function B(){axios.put(route("api.clients.update",e.value.clientModal.id),e.value.clientModal).then(()=>{M(),axios.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal).then(()=>{axios.get(route("api.orders.edit",e.value.orderModal.id)).then(({data:t})=>{e.value.orderModal=t.result,a({title:"Success!",icon:"success"})}).catch(t=>console.log(t))})}).catch(t=>{console.log(t),a({title:"Error!",icon:"error"})})}function $(){n("edit-orders")&&(axios.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal),axios.get(route("api.orders.edit",e.value.orderModal.id)).then(({data:t})=>e.value.orderModal=t.result).catch(t=>console.log(t)))}function O(t){e.value.sidebarActive=t,t==="all"?s.value.status=null:s.value.status=t,r()}function N(t){t&&(s.value.currentPage=t),r()}function z(t){axios.get(route("api.orders.search",t)).then(({data:o})=>{e.value.sidebarActive=null,s.value.currentPage=1,e.value.orders=o.result,e.value.isLoading=!1}).catch(o=>{console.log(o),e.value.isLoading=!1})}function r(){axios.get(route("api.orders.index",P.value)).then(({data:t})=>{e.value.orders=t.result,e.value.isLoading=!1}).catch(t=>{console.log(t),e.value.isLoading=!1})}function C(t){n("destroy-orders")&&a({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(o=>{o.isConfirmed&&axios.delete(route("api.orders.destroy",t)).then(()=>{e.value.isLoading=!1,r(),e.value.isActiveEditModal&&m(),a({title:"Success!",icon:"success"})}).catch(l=>{console.log(l),a({title:"Error!",icon:"error"})})})}function k(t,o){axios.get(route("api.orders.edit",t)).then(({data:l})=>{e.value.orderModal.index=o,e.value.orderModal=l.result,m(),e.value.isLoading=!1}).catch(l=>console.log(l))}function I(){n("edit-orders")&&axios.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal).then(()=>{m(),r(),a({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),a({title:"Error!",icon:"error"})})}function m(){e.value.isActiveEditModal=!e.value.isActiveEditModal}return(t,o)=>{const l=d("loader-component"),U=d("sidebar-item"),j=d("sidebar-component"),K=d("search-component"),T=d("pagination");return i(),c(q,{title:"\u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F"},{header:g(()=>[R]),default:g(()=>[e.value.isLoading?(i(),c(l,{key:0})):b("",!0),!e.value.isLoading&&v(n)("show-orders")?(i(),E("div",W,[f("div",ee,[f("div",te,[h(j,null,{default:g(()=>[p.value.length?(i(!0),E(H,{key:0},J(p.value,u=>(i(),c(U,{onClick:se=>O(u.key),active:e.value.sidebarActive===u.key},{default:g(()=>[F(Q(u.title),1)]),_:2},1032,["onClick","active"]))),256)):b("",!0)]),_:1})]),f("div",oe,[h(K,{onSearch:z,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, \u043D\u0430\u043A\u043B\u0430\u0434\u043A\u0430, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),h(Z,{data:e.value.orders.data,onOnEdit:k,onOnDestroy:C,statuses:S.statuses,canDestroy:v(n)("destroy-orders")},null,8,["data","statuses","canDestroy"]),f("div",ae,[h(T,{pagination:e.value.orders,"click-handler":N,modelValue:e.value.currentPage,"onUpdate:modelValue":o[0]||(o[0]=u=>e.value.currentPage=u)},null,8,["pagination","modelValue"])])])]),(i(),c(L(v(D)),{order:e.value.orderModal,statuses:_.statuses,paymentMethods:_.payment_methods,size:"extralarge",onCloseModal:m,onDeclineForm:C,onSubmitForm:I,onSubmitItemForm:$,canDestroy:v(n)("destroy-orders"),onOnEditClient:w},null,40,["order","statuses","paymentMethods","canDestroy"])),(i(),c(L(v(V)),{item:e.value.clientModal,statuses:e.value.clientsStatuses,"sub-statuses":e.value.clientsSubStatuses,size:"extralarge",onCloseModal:M,onSubmitForm:B},null,40,["item","statuses","sub-statuses"]))])):b("",!0)]),_:1})}}};export{_e as default};
