import q from"./Indicators.c8d88ee9.js";import I from"./Modal.a119e4b5.js";import J from"./Table.0f043c00.js";import K from"./CrmLayout.ff73b356.js";import{j as Q,r as S,S as L,q as R,k as T}from"./app.1e23a217.js";import{_ as X}from"./Datepicker.9f1df47f.js";import{w as y,x as _,S as G,Q as d,K as r,X as B,F as l,P as v,B as m,y as h,z as f,J as i,M as $,O as D,L as k,A as P,a2 as H}from"./___vite-browser-external_commonjs-proxy.4f2b06be.js";import"./Form.116ff326.js";import"./ItemsTable.07dd3858.js";const W=k(" \u041A\u043B\u0456\u0454\u043D\u0442\u0438 "),Y={key:1},Z={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ee={class:"md:col-span-1"},ae={class:"w-full md:col-span-4 grid grid-cols-1 gap-4"},te={class:"text-center"},me={__name:"Index",setup(se){const x=[{title:"\u0415\u043A\u0441\u043F\u043E\u0440\u0442\u0443\u0432\u0430\u0442\u0438",key:"export"}],e=y({data:[],indicators:{},statuses:[],subStatuses:[],isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),o=y({status:null,currentPage:1,orderBy:{key:null,val:null},date:[]}),A=_(()=>{if(o.value.date.length===2)return{date_start:o.value.date[0].toLocaleDateString(),date_end:o.value.date[1].toLocaleDateString()}}),C=_(()=>{const{currentPage:a,status:s=null,orderBy:t=null}=o.value;return{page:a,status:s,orderBy:t,...A.value}}),E=(a,s)=>{o.value.orderBy={key:a,val:s},o.value.currentPage=1,n()},g=y([]),u=B("$swal"),c=B("$can");G(()=>{n(),axios.get(route("api.clients.statuses")).then(({data:a})=>{e.value.statuses=a.statuses,e.value.subStatuses=a.subStatuses,g.value.push({title:"\u0412\u0441\u0456 \u043A\u043B\u0456\u0454\u043D\u0442\u0438",key:"all"});for(const[s,t]of Object.entries(a.statuses))g.value.push({title:t,key:s})}),route().params.id&&(e.value.isLoading=!0,b(route().params.id))});const M=_(()=>e.value.isActiveEditModal?I:null),V=a=>{a==="export"&&(window.location.href=route("admin.crm.clients.export"))},F=async a=>{await axios.get(route("api.clients.search",{search:a})).then(({data:s})=>{e.value.sidebarActive=null,o.value.currentPage=1,e.value.data=s.result,e.value.isLoading=!1}).catch(s=>{console.log(s),e.value.isLoading=!1})},O=a=>{e.value.sidebarActive=a,o.value.status=a==="all"?null:a,o.value.date=[],o.value.currentPage=1,n()},N=async()=>{o.value.currentPage=1,await n()},j=async a=>{a&&(o.value.currentPage=a),await n()},n=async()=>{await axios.get(route("api.clients.index",C.value)).then(({data:a})=>{e.value.indicators=a.indicators,e.value.data=a.result,e.value.isLoading=!1}).catch(a=>{console.log(a),e.value.isLoading=!1})},w=async a=>{c("destroy-clients")&&u({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(async s=>{s.isConfirmed&&await axios.delete(route("api.clients.destroy",a)).then(()=>{e.value.isLoading=!1,n(),e.value.isActiveEditModal&&p(),u({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),u({title:"Error!",icon:"error"})})})},b=async(a,s)=>{await axios.get(route("api.clients.edit",a)).then(({data:t})=>{e.value.modal.index=s,e.value.modal=t.result,p(),e.value.isLoading=!1}).catch(t=>console.log(t))},U=async()=>{await axios.put(route("api.clients.update",e.value.modal.id),e.value.modal).then(()=>{p(),n(),u({title:"Success!",icon:"success"})}).catch(a=>{console.log(a),u({title:"Error!",icon:"error"})})},p=()=>{e.value.isActiveEditModal=!e.value.isActiveEditModal};return(a,s)=>(l(),d(K,{title:"\u041A\u043B\u0456\u0454\u043D\u0442\u0438"},{header:r(()=>[W]),default:r(()=>[e.value.isLoading?(l(),d(Q,{key:0})):v("",!0),!e.value.isLoading&&m(c)("show-clients")?(l(),h("div",Y,[f("div",Z,[f("div",ee,[i(L,{class:"mb-5"},{default:r(()=>[g.value.length?(l(!0),h($,{key:0},D(g.value,t=>(l(),d(S,{onClick:z=>O(t.key),active:e.value.sidebarActive===t.key},{default:r(()=>[k(P(t.title),1)]),_:2},1032,["onClick","active"]))),256)):v("",!0)]),_:1}),m(c)("export-orders")?(l(),d(L,{key:0},{default:r(()=>[x.length?(l(),h($,{key:0},D(x,t=>i(S,{onClick:z=>V(t.key)},{default:r(()=>[k(P(t.title),1)]),_:2},1032,["onClick"])),64)):v("",!0)]),_:1})):v("",!0)]),f("div",ae,[i(X,{modelValue:o.value.date,"onUpdate:modelValue":[s[0]||(s[0]=t=>o.value.date=t),N]},null,8,["modelValue"]),i(q,{data:e.value.indicators},null,8,["data"]),i(R,{onSearch:F,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u043F\u043E-\u0431\u0430\u0442\u044C\u043A\u043E\u0432\u0456, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, email, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),i(J,{data:e.value.data.data,onOnEdit:b,onOnDestroy:w,onOrderBy:E,statuses:e.value.statuses,canDestroy:m(c)("destroy-clients")},null,8,["data","statuses","canDestroy"]),f("div",te,[i(T,{pagination:e.value.data,"click-handler":j,modelValue:o.value.currentPage,"onUpdate:modelValue":s[1]||(s[1]=t=>o.value.currentPage=t)},null,8,["pagination","modelValue"])])])]),(l(),d(H(m(M)),{item:e.value.modal,statuses:e.value.statuses,"sub-statuses":e.value.subStatuses,size:"extralarge",onCloseModal:p,onDeclineForm:w,onSubmitForm:U,canDestroy:m(c)("destroy-clients")},null,40,["item","statuses","sub-statuses","canDestroy"]))])):v("",!0)]),_:1}))}};export{me as default};
