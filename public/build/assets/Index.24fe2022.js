import W from"./Modal.16104bf2.js";import Y from"./Chart.00bd2055.js";import Z from"./StatisticLayout.ee69e03f.js";import H from"./LastParams.6786c2ed.js";import{ax as A,y as h,z as V,G as J,W as g,U as n,S as d,a0 as y,P as M,L as $,K as s,M as v,F as Q,V as X,O as f,Z as m,be as ee,D as L,Y as i}from"./moment.325cf309.js";import"./Form.85c9a11d.js";import"./index.caa0c941.js";import"./app.6a44ab02.js";const te=m(" \u0412\u0438\u0442\u0440\u0430\u0442\u0438 "),oe={key:1},ae=m(" \u0414\u043E\u0434\u0430\u0442\u0438 "),le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-5"},ne={class:"block"},se={class:"block"},ie={class:"grid grid-cols-2 md:grid-cols-6"},ce=["onClick"],re=["onClick"],ye={__name:"Index",setup(ue){const r=L("$swal"),D=L("$can"),k=A({name:null,date:null,sum:null,quantity:1,comment:null,total:null,cost_category_id:null,cost_type:"single"}),t=h({data:[],chart:[],isLoading:!0,isActiveModal:!1,modalAction:"",item:{}}),a=h({date:[],filter:null,last:"one-month",page:1}),b=h([]),w=V(()=>{const e={};return a.value.filter&&(e.filter=a.value.filter),a.value.date.length===2&&(e.date_start=a.value.date[0],e.date_end=a.value.date[1]),a.value.last&&(e.last=a.value.last),e.page=a.value.page,e});function S(e){e?a.value.last=e:a.value={date:[],filter:null,last:null,page:1},c()}J(()=>{c(),axios.get(route("api.statistics.costs.categories.list")).then(({data:e})=>{e.result.forEach(l=>{b.value.push({value:l.title,key:l.id})})}).catch(e=>console.log(e))});const B=V(()=>t.value.isActiveModal?W:null),F=A([{label:"ID",key:"id"},{label:"\u0414\u0430\u0442\u0430",key:"date"},{label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u044F",key:"category"},{label:"\u041A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C",key:"quantity"},{label:"\u0421\u0443\u043C\u0430",key:"sum"},{label:"\u0417\u0430\u0433\u0430\u043B\u043E\u043C",key:"total"},{label:"\u0412\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0430\u043B\u044C\u043D\u0438\u0439",key:"user"},{label:"\u041A\u043E\u043C\u0435\u043D\u0442\u0430\u0440",key:"comment"},{label:"\u041E\u043D\u043E\u0432\u043B\u0435\u043D\u043E<hr class='my-1'>\u0421\u0442\u0432\u043E\u0440\u0435\u043D\u043E",key:"timestamps"},{label:"#",key:"actions"}]);function E(){a.value.last="range",c()}function c(){t.value.isLoading=!0,axios.get(route("api.statistics.costs.index",w.value)).then(({data:e})=>{t.value.data=e,t.value.isLoading=!1}).catch(e=>{console.log(e),t.value.isLoading=!1}),axios.get(route("api.statistics.costs.chart",w.value)).then(({data:e})=>t.value.chart=e.result).catch(e=>console.log(e))}function C(e){r({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(l=>{l.isConfirmed&&axios.delete(route("api.statistics.costs.destroy",e)).then(()=>{c(),t.value.isActiveModal&&p(),r({icon:"success",title:"Destroyed!"})}).catch(u=>{console.log(u),r({icon:"error",title:"Error!"})})})}function p(){t.value.isActiveModal=!t.value.isActiveModal}function U(e,l){axios.get(route("api.statistics.costs.edit",e)).then(({data:u})=>{t.value.item=u.result,t.value.modalAction="edit",t.value.item.index=l,p()}).catch(u=>console.log(u))}function j(){axios.put(route("api.statistics.costs.update",t.value.item.id),t.value.item).then(()=>{p(),c(),r({title:"Success!",icon:"success"})}).catch(e=>{console.log(e),r({title:"Error!",icon:"error"})})}function N(){axios.post(route("api.statistics.costs.create"),t.value.item).then(()=>{p(),t.value.item=k,c(),r({title:"Success!",icon:"success"})}).catch(e=>{console.log(e),r({title:"Error!",icon:"error"})})}function O(){t.value.modalAction==="edit"?j():t.value.modalAction==="create"&&N()}function P(){Object.assign(t.value.item,k),t.value.modalAction="create",p()}return(e,l)=>{const u=i("loader-component"),q=i("button-component"),x=i("label-component"),I=i("select-component"),T=i("Datepicker"),z=i("card-component"),G=i("xcircle-component"),K=i("table-component"),R=i("pagination");return d(),g(Z,{title:"\u0412\u0438\u0442\u0440\u0430\u0442\u0438"},{header:n(()=>[te]),default:n(()=>[t.value.isLoading?(d(),g(u,{key:0})):y("",!0),!t.value.isLoading&&M(D)("show-bookkeeping-costs")?(d(),$("div",oe,[s(q,{type:"btn",onClick:P},{default:n(()=>[ae]),_:1}),v("div",le,[v("div",ne,[s(x,{value:"\u0424\u0456\u043B\u044C\u0442\u0440 \u043F\u043E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u0457"}),s(I,{modelValue:a.value.filter,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.filter=o),options:b.value,onChange:c},null,8,["modelValue","options"])]),v("div",se,[s(x,{value:"\u0424\u0456\u043B\u044C\u0442\u0440 \u043F\u043E \u0434\u0430\u0442\u0456"}),s(T,{modelValue:a.value.date,"onUpdate:modelValue":[l[1]||(l[1]=o=>a.value.date=o),E],class:"w-100",locale:"ru",placeholder:"\u041E\u0431\u0435\u0440\u0456\u0442\u044C \u0434\u0430\u0442\u0443",autoApply:"",monthChangeOnScroll:!1,enableTimePicker:!1,range:""},null,8,["modelValue"])])]),s(H,{"active-item":a.value.last,onSortByLast:S},null,8,["active-item"]),t.value.chart?(d(),g(Y,{key:0,"chart-data":t.value.chart},null,8,["chart-data"])):y("",!0),v("div",ie,[(d(!0),$(Q,null,X(t.value.data.generalStat,(o,_)=>(d(),g(z,{class:"text-center",title:_,description:e.$filters.formatMoney(o)},null,8,["title","description"]))),256))]),s(K,{headings:F,rows:t.value.data.result.data,isSlotMode:!0},{id:n(({data:o})=>[v("a",{href:"javascript:",onClick:_=>U(o.row.id,o.i)},f(o.row.id),9,ce)]),date:n(({data:o})=>[m(f(e.$filters.dateFormat(o.row.date)),1)]),category:n(({data:o})=>[m(f(o.row.category.title),1)]),sum:n(({data:o})=>[m(f(e.$filters.formatMoney(o.row.sum)),1)]),total:n(({data:o})=>[m(f(e.$filters.formatMoney(o.row.total)),1)]),user:n(({data:o})=>[m(f(o.row.user?o.row.user.name:"-"),1)]),actions:n(({data:o})=>[v("a",{href:"javascript:",onClick:_=>C(o.row.id)},[s(G)],8,re)]),_:1},8,["headings","rows"]),s(R,{pagination:t.value.data.result,"click-handler":c,modelValue:a.value.page,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.page=o)},null,8,["pagination","modelValue"]),(d(),g(ee(M(B)),{item:t.value.item,modalAction:t.value.modalAction,onCloseModal:p,onSubmitForm:O,onDeclineForm:C},null,40,["item","modalAction"]))])):y("",!0)]),_:1})}}};export{ye as default};
