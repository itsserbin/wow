import{l as Z,m as L,S as $,n as q,o as G}from"./app.55b2190b.js";import H from"./Modal.1ab3d1c8.js";import J from"./Modal.d8de6c6c.js";import Q from"./Table.35d63373.js";import W from"./CrmLayout.178904a4.js";import{y as x,z as w,C as ee,bS as te,a0 as c,X as v,B as F,S as n,_ as l,P as u,L as S,M as h,K as b,F as P,Z as D,Y as k,O as B,ab as V}from"./___vite-browser-external_commonjs-proxy.86165f86.js";import"./Form.e7a4fda4.js";import"./ItemsTable.b3dfa553.js";import"./Form.cdfd8a68.js";import"./ItemsModal.0fc12749.js";import"./ItemsForm.c44bb49e.js";import"./ItemsTable.53f40c11.js";import"./ClientOrders.c3baf6f4.js";import"./Table.8ebdec24.js";import"./Modal.9570f5a2.js";import"./Form.10160bf5.js";const d=()=>({fetch:async function(s){try{return(await axios.get(route("api.orders.index",s))).data}catch(a){return console.error(a)}},edit:async function(s){try{return(await axios.get(route("api.orders.edit",s))).data}catch(a){return console.log(a)}},destroy:async function(s){try{return(await axios.delete(route("api.orders.destroy",s))).data}catch(a){return console.log(a)}},update:async function(s,a){try{return(await axios.put(route("api.orders.update",s),a)).data}catch(e){return console.log(e)}},search:async function(s){try{return(await axios.get(route("api.orders.search",s))).data}catch(a){return console.log(a)}}}),ae=()=>({fetch:async function(s){try{return(await axios.get(route("api.clients.index",s))).data}catch(a){return console.error(a)}},edit:async function(s){try{return(await axios.get(route("api.clients.edit",s))).data}catch(a){return console.log(a)}},destroy:async function(s){try{return(await axios.delete(route("api.clients.destroy",s))).data}catch(a){return console.log(a)}},update:async function(s,a){try{return(await axios.put(route("api.clients.update",s),a)).data}catch(e){return console.log(e)}},search:async function(s){try{return(await axios.get(route("api.clients.search",s))).data}catch(a){return console.log(a)}}}),se=k(" \u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F "),re={key:1},oe={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ne={class:"md:col-span-1 gap-4"},ie={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},ce={class:"text-center"},ke={__name:"Index",props:["statuses","payment_methods","invoiceStatuses"],setup(s){const a=s,e=x({orders:[],currentPage:1,isLoading:!0,isActiveEditModal:!1,isActiveClientModal:!1,sidebarActive:"all",orderModal:{},clientModal:{},clientsStatuses:null,clientsSubStatuses:null}),g=x([]),C=[{title:"\u0415\u043A\u0441\u043F\u043E\u0440\u0442\u0443\u0432\u0430\u0442\u0438",key:"export"}],i=F("$swal"),p=F("$can"),m=x({status:null,currentPage:1}),O=w(()=>{const{currentPage:t,status:r=null}=m.value;return{page:t,status:r}});ee(()=>{y(),g.value.push({title:"\u0412\u0441\u0456 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F",key:"all"});for(const[t,r]of Object.entries(a.statuses))g.value.push({title:r,key:t});route().params.id&&(e.value.isLoading=!0,E(route().params.id)),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.clientsStatuses=t.statuses,e.value.clientsSubStatuses=t.subStatuses})});const N=w(()=>e.value.isActiveEditModal?J:null),z=w(()=>e.value.isActiveClientModal?H:null),y=async()=>{try{const t=await d().fetch(O.value);t.success&&(e.value.orders=t.result),e.value.isLoading=!1}catch(t){console.error(t),e.value.isLoading=!1}},I=async()=>{const t=await ae().edit(e.value.orderModal.client.id);t.success&&(e.value.clientModal=t.result,M())},U=t=>{t==="export"&&(window.location.href=route("admin.crm.orders.export"))},M=()=>{e.value.isActiveClientModal=!e.value.isActiveClientModal},j=()=>{axios.put(route("api.clients.update",e.value.clientModal.id),e.value.clientModal).then(()=>{M(),axios.put(route("api.orders.update",e.value.orderModal.id),e.value.orderModal).then(()=>{axios.get(route("api.orders.edit",e.value.orderModal.id)).then(({data:t})=>{e.value.orderModal=t.result,i({title:"Success!",icon:"success"})}).catch(t=>console.log(t))})}).catch(t=>{console.log(t),i({title:"Error!",icon:"error"})})},R=async()=>{try{const{success:t}=await d().update(e.value.orderModal.id,e.value.orderModal);if(t){const{result:r}=await d().edit(e.value.orderModal.id);e.value.orderModal=r}}catch(t){console.error(t),i({title:"Error!",icon:"error",text:t.response.data.message||"An error occurred, please try again later"})}},K=te.debounce(t=>{e.value.sidebarActive!==t&&(e.value.sidebarActive=t,m.value.status=t==="all"?null:t,y())},250),T=t=>{m.value.currentPage=t||m.value.currentPage,y()},X=async t=>{try{const{result:r,success:o}=await d().search(t);o&&(e.value.sidebarActive=null,m.value.currentPage=1,e.value.orders=r,e.value.isLoading=!1)}catch(r){console.error(r),i({title:"Error!",icon:"error",text:r.response.data.message||"An error occurred, please try again later"})}},A=async t=>{try{p("destroy-orders")&&(await i({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0})).isConfirmed&&(await d().destroy(t),e.value.isLoading=!1,await y(),e.value.isActiveEditModal&&f(),i({title:"Success!",icon:"success"}))}catch(r){console.error(r),i({title:"Error!",icon:"error",text:r.response.data.message||"An error occurred, please try again later"})}},E=async(t,r)=>{try{const{result:o,success:_}=await d().edit(t);_&&(e.value.orderModal.index=r,e.value.orderModal=o,f(),e.value.isLoading=!1)}catch(o){e.value.isLoading=!1,console.error(o),i({title:"Error!",icon:"error",text:o.response.data.message||"An error occurred, please try again later"})}},Y=async()=>{try{if(p("edit-orders")){const{success:t}=await d().update(e.value.orderModal.id,e.value.orderModal);t&&(f(),await y(),i({title:"Success!",icon:"success"}))}}catch(t){e.value.isLoading=!1,console.error(t),i({title:"Error!",icon:"error",text:t.response.data.message||"An error occurred, please try again later"})}},f=()=>{e.value.isActiveEditModal=!e.value.isActiveEditModal};return(t,r)=>(n(),c(W,{title:"\u0417\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F"},{header:v(()=>[se]),default:v(()=>[e.value.isLoading?(n(),c(Z,{key:0})):l("",!0),!e.value.isLoading&&u(p)("show-orders")?(n(),S("div",re,[h("div",oe,[h("div",ne,[b($,{class:"mb-5"},{default:v(()=>[g.value.length?(n(!0),S(P,{key:0},D(g.value,o=>(n(),c(L,{onClick:_=>u(K)(o.key),active:e.value.sidebarActive===o.key},{default:v(()=>[k(B(o.title),1)]),_:2},1032,["onClick","active"]))),256)):l("",!0)]),_:1}),u(p)("export-orders")?(n(),c($,{key:0},{default:v(()=>[C.length?(n(),S(P,{key:0},D(C,o=>b(L,{onClick:_=>U(o.key)},{default:v(()=>[k(B(o.title),1)]),_:2},1032,["onClick"])),64)):l("",!0)]),_:1})):l("",!0)]),h("div",ie,[b(q,{onSearch:X,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, \u043D\u0430\u043A\u043B\u0430\u0434\u043A\u0430, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),e.value.orders?(n(),c(Q,{key:0,data:e.value.orders.data,onOnEdit:E,onOnDestroy:A,statuses:s.statuses,canDestroy:u(p)("destroy-orders")},null,8,["data","statuses","canDestroy"])):l("",!0),h("div",ce,[e.value.orders?(n(),c(G,{key:0,pagination:e.value.orders,"click-handler":T,modelValue:e.value.currentPage,"onUpdate:modelValue":r[0]||(r[0]=o=>e.value.currentPage=o)},null,8,["pagination","modelValue"])):l("",!0)])])]),(n(),c(V(u(N)),{order:e.value.orderModal,statuses:a.statuses,invoiceStatuses:a.invoiceStatuses,paymentMethods:a.payment_methods,size:"extralarge",onCloseModal:f,onDeclineForm:A,onSubmitForm:Y,onSubmitItemForm:R,canDestroy:u(p)("destroy-orders"),onOnEditClient:I},null,40,["order","statuses","invoiceStatuses","paymentMethods","canDestroy"])),(n(),c(V(u(z)),{item:e.value.clientModal,statuses:e.value.clientsStatuses,"sub-statuses":e.value.clientsSubStatuses,size:"extralarge",onCloseModal:M,onSubmitForm:j},null,40,["item","statuses","sub-statuses"]))])):l("",!0)]),_:1}))}};export{ke as default};
