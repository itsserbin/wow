{"version":3,"file":"Index-565a6b25.js","sources":["../../../resources/js/Pages/Admin/Options/Characteristics/Index.vue"],"sourcesContent":["<script setup>\nimport {onMounted, inject, ref, computed} from \"vue\";\nimport {CharacteristicsRepository} from \"@/Repositories/CharacteristicsRepository.js\";\nimport {swal} from \"@/Includes/swal\";\n\nimport Button from '@/Components/Button.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Modal from '@/Pages/Admin/Options/Characteristics/Modal.vue';\nimport OptionsLayout from '@/Pages/Admin/Options/OptionsLayout.vue'\nimport Table from '@/Pages/Admin/Options/Characteristics/Table.vue'\n\nconst can = inject('$can');\n\nconst params = ref({\n    currentPage: 1,\n})\n\nconst item = {\n    title: {\n        ua: null,\n        ru: null\n    },\n    values: [\n        {\n            title: {\n                ua: null,\n                ru: null\n            }\n        }\n    ]\n};\n\nconst state = ref({\n    data: [],\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: {},\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nasync function fetch() {\n    try {\n        const data = await CharacteristicsRepository().fetch(params.value);\n        if (data.success) {\n            state.value.data = data.result;\n        }\n        state.value.isLoading = false;\n    } catch (e) {\n        console.error(e);\n        state.value.isLoading = false;\n    }\n}\n\nasync function onDestroy(id) {\n    try {\n        if (can('destroy-characteristics')) {\n            const confirm = await swal({\n                title: 'Видалити?',\n                icon: 'warning',\n                showCancelButton: true,\n            });\n            if (confirm.isConfirmed) {\n                await CharacteristicsRepository().destroy(id);\n                state.value.isLoading = false;\n                await fetch();\n                if (state.value.isActiveModal) {\n                    modalFunction();\n                }\n                await swal({\n                    title: 'Success!',\n                    icon: 'success'\n                });\n            }\n        }\n    } catch (errors) {\n        console.error(errors);\n        await swal({\n            title: 'Error!',\n            icon: 'error',\n            text: errors.response.data.message || 'An error occurred, please try again later'\n        });\n    }\n}\n\nfunction modalFunction() {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nasync function onEdit(id, i) {\n    try {\n        const {result, success} = await CharacteristicsRepository().edit(id);\n        if (success) {\n            state.value.item.index = i;\n            state.value.item = result;\n            state.value.modalAction = 'edit';\n            modalFunction();\n            state.value.isLoading = false;\n        }\n    } catch (error) {\n        state.value.isLoading = false;\n        console.error(error);\n        await swal({\n            title: 'Error!',\n            icon: 'error',\n            text: error.response.data.message || 'An error occurred, please try again later'\n        });\n    }\n}\n\nasync function onUpdate() {\n    try {\n        if (can('edit-characteristics')) {\n            const {success} = await CharacteristicsRepository().update(state.value.item.id, state.value.item);\n            if (success) {\n                modalFunction();\n                await fetch();\n                await swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            }\n        }\n    } catch (error) {\n        state.value.isLoading = false;\n        console.error(error);\n        await swal({\n            title: 'Error!',\n            icon: 'error',\n            text: error.response.data.message || 'An error occurred, please try again later'\n        });\n    }\n}\n\nasync function onCreate() {\n    try {\n        if (can('create-characteristics')) {\n            const {success} = await CharacteristicsRepository().create(state.value.item);\n            if (success) {\n                state.value.item = {};\n                modalFunction();\n                await fetch();\n                await swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            }\n        }\n    } catch (error) {\n        state.value.isLoading = false;\n        console.error(error);\n        await swal({\n            title: 'Error!',\n            icon: 'error',\n            text: error || 'An error occurred, please try again later'\n        });\n    }\n}\n\nfunction submitForm() {\n    if (state.value.modalAction === 'edit' && can('edit-characteristics')) {\n        onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-characteristics')) {\n        onCreate();\n    }\n}\n\nfunction create() {\n    if (can('create-characteristics')) {\n        state.value.item = JSON.parse(JSON.stringify(item));\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n</script>\n\n<template>\n    <OptionsLayout title=\"Характеристики товарів\">\n        <template #header>\n            Характеристики товарів\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-characteristics')\" class=\"grid grid-cols-1 gap-4\">\n            <div>\n                <Button type=\"btn\" @click=\"create\" v-if=\"can('create-characteristics')\">\n                    Додати\n                </Button>\n            </div>\n\n            <Table :data=\"state.data.data\"\n                   @onEdit=\"onEdit\"\n                   @onDestroy=\"onDestroy\"\n                   :canDestroy=\"can('destroy-characteristics')\"\n            />\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.data\"\n                          :click-handler=\"fetch\"\n                          v-model=\"params.currentPage\"\n                />\n            </div>\n        </div>\n        <component :is=\"activeModal\"\n                   :item=\"state.item\"\n                   @closeModal=\"modalFunction\"\n                   @submitForm=\"submitForm\"\n                   @declineForm=\"onDestroy\"\n                   :canDestroy=\"can('destroy-characteristics')\"\n        ></component>\n    </OptionsLayout>\n</template>\n"],"names":["can","inject","params","ref","item","state","onMounted","fetch","activeModal","computed","Modal","data","CharacteristicsRepository","e","onDestroy","id","swal","modalFunction","errors","onEdit","i","result","success","error","onUpdate","onCreate","submitForm","create"],"mappings":"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"}