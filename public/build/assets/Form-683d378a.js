import{p as u,q as f,v as s,i as Q,j as V,G as U,r as R,o as X,l,t as h,x as I,D as y,C as v,z,B as k,A as p,J as S}from"./app-f55448cf.js";import{u as Y}from"./vue-i18n.esm-bundler-d070be13.js";import{s as d}from"./swal-01ed9a07.js";import{_}from"./Card-ec829b36.js";import{_ as M}from"./Select-35904355.js";import{_ as n}from"./Label-fa7af1d1.js";import{_ as B}from"./Checkbox-8a616da0.js";import{_ as Z}from"./Textarea-faf312b0.js";import{_ as c}from"./Input-4fdb1b47.js";import{_ as C}from"./Button-3f74bcad.js";import ee from"./Modal-99c0f58a.js";import te from"./Table-a538b161.js";import oe from"./ClientOrders-82981ecb.js";import le from"./Table-c43dfcb5.js";import re from"./Modal-dce38a51.js";import"./Modal-381c1367.js";import"./Form-cee04caf.js";import"./Multiselect-325a47ec.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Table-6800669f.js";import"./XCircle-78b15e67.js";import"./Form-263a483e.js";const se=["width","height"],ie=s("path",{d:"M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"},null,-1),ae=[ie],ne={__name:"Telephone",props:{width:{default:16},height:{default:16}},setup(t){return(m,a)=>(u(),f("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,viewBox:"0 0 16 16"},ae,8,se))}},de=["width","height"],ue=s("path",{"fill-rule":"nonzero",d:"M141.44 0h172.68c4.71 0 8.91 2.27 11.54 5.77L434.11 123.1a14.37 14.37 0 0 1 3.81 9.75l.08 251.18c0 17.62-7.25 33.69-18.9 45.36l-.07.07c-11.67 11.64-27.73 18.87-45.33 18.87h-20.06c-.3 17.24-7.48 32.9-18.88 44.29-11.66 11.66-27.75 18.9-45.42 18.9H64.3c-17.67 0-33.76-7.24-45.41-18.9C7.24 480.98 0 464.9 0 447.22V135.87c0-17.68 7.23-33.78 18.88-45.42C30.52 78.8 46.62 71.57 64.3 71.57h12.84V64.3c0-17.68 7.23-33.78 18.88-45.42C107.66 7.23 123.76 0 141.44 0zm30.53 250.96c-7.97 0-14.43-6.47-14.43-14.44 0-7.96 6.46-14.43 14.43-14.43h171.2c7.97 0 14.44 6.47 14.44 14.43 0 7.97-6.47 14.44-14.44 14.44h-171.2zm0 76.86c-7.97 0-14.43-6.46-14.43-14.43 0-7.96 6.46-14.43 14.43-14.43h136.42c7.97 0 14.43 6.47 14.43 14.43 0 7.97-6.46 14.43-14.43 14.43H171.97zM322.31 44.44v49.03c.96 12.3 5.21 21.9 12.65 28.26 7.8 6.66 19.58 10.41 35.23 10.69l33.39-.04-81.27-87.94zm86.83 116.78-39.17-.06c-22.79-.35-40.77-6.5-53.72-17.57-13.48-11.54-21.1-27.86-22.66-48.03l-.14-2v-64.7H141.44c-9.73 0-18.61 4-25.03 10.41C110 45.69 106 54.57 106 64.3v319.73c0 9.74 4.01 18.61 10.42 25.02 6.42 6.42 15.29 10.42 25.02 10.42H373.7c9.75 0 18.62-3.98 25.01-10.38 6.45-6.44 10.43-15.3 10.43-25.06V161.22zm-84.38 287.11H141.44c-17.68 0-33.77-7.24-45.41-18.88-11.65-11.65-18.89-27.73-18.89-45.42v-283.6H64.3c-9.74 0-18.61 4-25.03 10.41-6.41 6.42-10.41 15.29-10.41 25.03v311.35c0 9.73 4.01 18.59 10.42 25.01 6.43 6.43 15.3 10.43 25.02 10.43h225.04c9.72 0 18.59-4 25.02-10.43 6.17-6.17 10.12-14.61 10.4-23.9z"},null,-1),ce=[ue],me={__name:"Copy",props:{width:{default:16},height:{default:16}},setup(t){return(m,a)=>(u(),f("svg",{xmlns:"http://www.w3.org/2000/svg","fill-rule":"evenodd","clip-rule":"evenodd",viewBox:"0 0 438 511.52",width:t.width,height:t.height},ce,8,de))}},ve={class:"grid gap-4"},he={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},fe={class:"block"},ye={class:"block"},ge={class:"block"},be={class:"flex items-center gap-x-2"},pe=["href"],we={class:"block"},$e=s("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},null,-1),Ve=s("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),ke={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},_e={class:"block"},Ie={class:"block"},Me={class:"block"},Ce={class:"block"},xe={class:"block"},Fe={class:"flex gap-x-2 items-center w-full"},Ue=s("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"grid grid-cols-1 gap-4"},Be={class:"block"},Oe={class:"block"},je={class:"block"},Ae={key:0},De={key:1},Ee={key:0,class:"grid grid-cols-2 gap-x-2"},Le={class:"flex gap-x-2"},He={class:"block"},Ne=s("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),Te={class:"grid grid-cols-1 gap-y-4"},Pe={class:"block"},We={class:"block"},qe={class:"block"},Ge={class:"block mb-5"},Je={class:"grid grid-cols-2 md:grid-cols-4 mt-5"},Ke={key:1,class:"block"},gt={__name:"Form",props:["order","statuses","paymentMethods","clientStatuses","invoiceStatuses"],emits:["submitItemForm","onEditClient"],setup(t,{emit:m}){const a=t,{t:O}=Y(),g=Q("$can"),j=V(()=>a.order.total_price-a.order.prepayment_sum),A=V(()=>{const{name:e,last_name:o,middle_name:r}=a.order.client,$=[o,e,r].filter(Boolean);return $.length?$.join(" "):"Дані не вказані"}),x=U({order_id:a.order.id,sum:null}),i=R({showItemsModal:!1,showInvoicesModal:!1,itemsModalAction:"",item:{count:1,size:"",color:"",product_id:null},invoiceItem:{},statuses:[],managers:[],paymentMethods:[]});X(()=>{q();for(const[e,o]of Object.entries(a.statuses))i.value.statuses.push({key:e,value:o});for(const[e,o]of Object.entries(a.paymentMethods))i.value.paymentMethods.push({key:e,value:o})});const D=V(()=>i.value.showItemsModal?ee:null),E=V(()=>i.value.showInvoicesModal?re:null);U([{key:0,value:"Ні"},{key:1,value:"Так"}]);function w(){i.value.showInvoicesModal=!i.value.showInvoicesModal}const L=()=>{navigator.clipboard.writeText(a.order.client.phone).then(()=>{d({icon:"success",title:O("swal.data_copied"),timer:1e3,showConfirmButton:!1})}).catch(e=>{console.error("Виникла помилка під час копіювання тексту:",e)})};function H(e){g("destroy-invoices")&&d({title:"Видалити?",icon:"warning",showCancelButton:!0}).then(o=>{o.isConfirmed&&axios.delete(route("api.invoices.destroy",e)).then(()=>{m("submitItemForm"),d({icon:"success",title:"Destroyed!"})}).catch(r=>{console.log(r),d({icon:"error",title:"Error!"})})})}function N(){g("create-invoices")&&(i.value.invoiceItem=x,w())}function T(){axios.post(route("api.invoices.create"),i.value.invoiceItem).then(({data:e})=>{i.value.invoiceItem=x,w(),navigator.clipboard.writeText(e.result.data.invoice_url),d({title:"Успішно!",text:"Рахунок був успішно створений, посилання на оплату скопійовано в буфер обміну",icon:"success"}),m("submitItemForm",e.result)}).catch(e=>{console.log(e),d({title:"Error!",icon:"error"})})}function F(){a.order.waybill&&axios.post(route("notify.waybill"),{phone:a.order.client.phone,waybill:a.order.waybill,order_id:a.order.id}).then(({data:e})=>{e.success===!0?d({icon:"success",title:"Номер накладной успешно отправлен клиенту",text:e.info}):d({icon:"error",title:"Ошибка",text:e.info}),axios.put(route("api.orders.update",a.order.id),a.order)}).catch(e=>{d({icon:"error",title:"Ошибка",text:"Обратитесь к администратору"}),console.log(e)})}function P(){i.value.itemsModalAction==="create"?axios.post(route("api.order-items.add",a.order.id),i.value.item).then(({data:e})=>{b(),m("submitItemForm",e.result)}).catch(e=>console.log(e)):i.value.itemsModalAction==="edit"&&axios.put(route("api.order-items.update",i.value.item.id),i.value.item).then(({data:e})=>{b(),m("submitItemForm",e.result)}).catch(e=>console.log(e))}function W(){b(),i.value.itemsModalAction="create"}function b(){i.value.showItemsModal=!i.value.showItemsModal}function q(){axios.get(route("api.users.list.managers")).then(({data:e})=>{e.result.length&&e.result.forEach(o=>{i.value.managers.push({key:o.id,value:o.name})})}).catch(e=>console.log(e))}function G(e,o){d({title:"Are you sure?",icon:"warning",showCancelButton:!0}).then(r=>{r.isConfirmed&&axios.delete(route("api.order-items.destroy",{item_id:e,order_id:a.order.id})).then(()=>{m("submitItemForm"),d({title:"Success",icon:"success"})}).catch($=>{console.log($),d({title:"Error",icon:"error"})})})}function J(e){b(),i.value.itemsModalAction="edit",axios.get(route("api.order-items.edit",e)).then(({data:o})=>i.value.item=o.result).catch(o=>console.log(o))}function K(){d({title:"Успішно",text:"Посилання на оплату надіслано клієнту",icon:"success"}),m("submitItemForm")}return(e,o)=>(u(),f("form",ve,[s("div",he,[s("div",fe,[l(n,{value:e.$t("clients.status")},null,8,["value"]),l(c,{value:t.clientStatuses[t.order.client.status],type:"text",disabled:""},null,8,["value"])]),s("div",ye,[l(n,{value:e.$t("clients.full_name")},null,8,["value"]),l(c,{value:h(A),type:"text",disabled:""},null,8,["value"])]),s("div",ge,[l(n,{value:e.$t("clients.phone")},null,8,["value"]),s("div",be,[s("a",{href:"tel:+"+t.order.client.phone,class:"border-lg rounded-lg border p-3"},[l(ne)],8,pe),l(c,{modelValue:t.order.client.phone,"onUpdate:modelValue":o[0]||(o[0]=r=>t.order.client.phone=r),type:"text",disabled:""},null,8,["modelValue"]),s("a",{href:"javascript:",onClick:L,class:"border-lg rounded-lg border p-3"},[l(me)])])]),s("div",we,[l(n,{value:" "}),l(C,{class:"w-full",type:"button",onClick:o[1]||(o[1]=r=>e.$emit("onEditClient"))},{default:I(()=>[p(k(e.$t("orders.client_card")),1)]),_:1})])]),$e,t.order.client.orders.length>1?(u(),y(oe,{key:0,data:t.order.client.orders,statuses:t.statuses},null,8,["data","statuses"])):v("",!0),Ve,s("div",ke,[s("div",_e,[l(n,{value:e.$t("orders.status")},null,8,["value"]),l(M,{modelValue:t.order.status,"onUpdate:modelValue":o[2]||(o[2]=r=>t.order.status=r),options:i.value.statuses},null,8,["modelValue","options"])]),s("div",Ie,[l(n,{value:e.$t("orders.manager_id")},null,8,["value"]),l(M,{modelValue:t.order.manager_id,"onUpdate:modelValue":o[3]||(o[3]=r=>t.order.manager_id=r),options:i.value.managers},null,8,["modelValue","options"])]),s("div",Me,[l(n,{value:e.$t("orders.payment_method")},null,8,["value"]),l(M,{modelValue:t.order.payment_method,"onUpdate:modelValue":o[4]||(o[4]=r=>t.order.payment_method=r),options:i.value.paymentMethods},null,8,["modelValue","options"])]),s("div",Ce,[l(n,{value:e.$t("orders.parcel_reminder")},null,8,["value"]),s("div",xe,[s("div",Fe,[l(B,{modelValue:t.order.parcel_reminder,"onUpdate:modelValue":o[5]||(o[5]=r=>t.order.parcel_reminder=r)},null,8,["modelValue"]),l(n,{value:t.order.parcel_reminder?"Так":"Ні"},null,8,["value"])])])])]),Ue,s("div",ze,[s("div",Se,[s("div",Be,[l(n,{value:e.$t("orders.city")},null,8,["value"]),l(c,{modelValue:t.order.city,"onUpdate:modelValue":o[6]||(o[6]=r=>t.order.city=r),type:"text",placeholder:e.$t("orders.enter_city")},null,8,["modelValue","placeholder"])]),s("div",Oe,[l(n,{value:e.$t("orders.postal_office")},null,8,["value"]),l(c,{modelValue:t.order.postal_office,"onUpdate:modelValue":o[7]||(o[7]=r=>t.order.postal_office=r),type:"text",placeholder:e.$t("orders.enter_postal_office")},null,8,["modelValue","placeholder"])]),s("div",je,[l(n,{value:e.$t("orders.waybill")},null,8,["value"]),l(c,{modelValue:t.order.waybill,"onUpdate:modelValue":o[8]||(o[8]=r=>t.order.waybill=r),type:"text",placeholder:e.$t("orders.enter_waybill")},null,8,["modelValue","placeholder"]),!t.order.sms_waybill_status&&t.order.waybill?(u(),f("div",Ae,[s("a",{href:"javascript:",onClick:o[9]||(o[9]=z(r=>F(t.order.client.phone,t.order.waybill),["prevent"]))},k(e.$t("orders.send_waybill_for_client")),1)])):v("",!0),t.order.sms_waybill_status?(u(),f("div",De,[p(k(e.$t("orders.waybill_sent"))+" (",1),s("a",{href:"javascript:",onClick:o[10]||(o[10]=z(r=>F(t.order.client.phone,t.order.waybill),["prevent"]))},k(e.$t("orders.waybill_resent")),1),p(") ")])):v("",!0)]),t.order.status==="return"?(u(),f("div",Ee,[s("div",Le,[l(B,{modelValue:t.order.refund_other_waybill,"onUpdate:modelValue":o[11]||(o[11]=r=>t.order.refund_other_waybill=r),onChange:e.test},null,8,["modelValue","onChange"]),l(n,{value:e.$t("orders.refund_other_waybill")},null,8,["value"])]),t.order.refund_other_waybill?(u(),y(c,{key:0,modelValue:t.order.other_waybill,"onUpdate:modelValue":o[12]||(o[12]=r=>t.order.other_waybill=r),type:"text",placeholder:e.$t("orders.enter_refund_other_waybill")},null,8,["modelValue","placeholder"])):v("",!0)])):v("",!0)]),s("div",He,[l(n,{value:e.$t("orders.comment")},null,8,["value"]),l(Z,{rows:"12",modelValue:t.order.comment,"onUpdate:modelValue":o[13]||(o[13]=r=>t.order.comment=r),placeholder:e.$t("orders.enter_comment")},null,8,["modelValue","placeholder"])])]),Ne,s("div",Te,[s("div",Pe,[l(n,{value:e.$t("orders.sale_of_air")},null,8,["value"]),l(c,{modelValue:t.order.sale_of_air_price,"onUpdate:modelValue":o[14]||(o[14]=r=>t.order.sale_of_air_price=r),type:"number",placeholder:e.$t("orders.enter_sale_of_air_price")},null,8,["modelValue","placeholder"])]),s("div",We,[l(n,{value:e.$t("orders.discount")},null,8,["value"]),l(c,{modelValue:t.order.discount_sum,"onUpdate:modelValue":o[15]||(o[15]=r=>t.order.discount_sum=r),type:"number",placeholder:e.$t("orders.enter_discount_sum")},null,8,["modelValue","placeholder"])]),s("div",qe,[l(n,{value:"Загальна сума передоплати (грн.)"}),l(c,{modelValue:t.order.prepayment_sum,"onUpdate:modelValue":o[16]||(o[16]=r=>t.order.prepayment_sum=r),type:"number",disabled:""},null,8,["modelValue"])])]),s("div",Ge,[l(C,{type:"button",onClick:W},{default:I(()=>[p("Додати товар")]),_:1}),(u(),y(S(h(D)),{item:i.value.item,size:"medium",onCloseModal:b,onSubmitItemForm:P},null,40,["item"]))]),l(te,{data:t.order.items,onEditOrderItem:J,onDestroyOrderItem:G},null,8,["data"]),s("div",Je,[l(_,{title:"Кількість товарів",description:t.order.total_count,class:"text-center"},null,8,["description"]),l(_,{title:"Загальна ціна",description:e.$filters.formatMoney(t.order.total_price),class:"text-center"},null,8,["description"]),l(_,{title:"Ціна на посилку",description:e.$filters.formatMoney(h(j)),class:"text-center"},null,8,["description"]),l(_,{title:"Промо-код",description:t.order.promo_code?t.order.promo_code:"Відсутній",class:"text-center"},null,8,["description"])]),h(g)("show-invoices")?(u(),f("div",Ke,[h(g)("create-invoices")?(u(),y(C,{key:0,type:"button",onClick:N,class:"my-4"},{default:I(()=>[p(" Додати рахунок ")]),_:1})):v("",!0),t.order.invoices.length?(u(),y(le,{key:1,data:t.order.invoices,statuses:t.invoiceStatuses,"can-destroy":h(g)("destroy-invoices"),onOnDestroy:H,onOnSendInvoiceSms:K},null,8,["data","statuses","can-destroy"])):v("",!0),(u(),y(S(h(E)),{item:i.value.invoiceItem,onCloseModal:w,onSubmitForm:T,onDeclineForm:w},null,40,["item"]))])):v("",!0)]))}};export{gt as default};
