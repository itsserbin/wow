import V from"./StatisticLayout-af991e7b.js";import{s as C,a as g,b as d}from"./column.esm-ad632756.js";import{s as z}from"./multiselect.esm-af9c9b5b.js";import F from"./Chart-2fe7b9f8.js";import{g as w,k,z as N,o as O,l,s as c,y as a,w as p,p as o,t as u,n as _,x as s,v as r}from"./index-a01126e2.js";import"./AuthenticatedLayout-704e8f94.js";import"./index.esm-02fff71f.js";import"./Logo-83ffc10f.js";import"./SidebarItem-446a46b0.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./app-741b04df.js";import"./moment-fbc5633a.js";import"./dropdown.esm-067e1b29.js";import"./basecomponent.esm-bc6743c9.js";import"./focustrap.esm-94bc3b5f.js";import"./index.esm-73720709.js";import"./card.esm-3b1398df.js";const S={class:"grid grid-cols-1 gap-4"},B={class:"text-center whitespace-nowrap"},D=o("br",null,null,-1),E={class:"text-center whitespace-nowrap"},I={class:"text-center whitespace-nowrap"},T={class:"text-center whitespace-nowrap"},U=o("br",null,null,-1),j={class:"text-center whitespace-nowrap"},K={class:"text-center whitespace-nowrap"},q=o("br",null,null,-1),A={class:"text-center whitespace-nowrap"},G=o("br",null,null,-1),H={class:"text-center whitespace-nowrap"},J={class:"text-center whitespace-nowrap"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},W={class:"flex items-center"},X={class:"flex justify-end"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={__name:"Index",setup(Z){const i=w({data:[],isLoading:!0}),f=k({date:null,page:0,first:0,rows:15,sortField:null,sortOrder:null}),x=w([{name:"Місяць",code:"month"},{name:"Загальна виручка",code:"total_revenues"},{name:"Витрати",code:"costs"},{name:"Інвестиції",code:"investments"},{name:"Повернення інвестицій",code:"returned_investments"},{name:"Дивіденди",code:"dividends"},{name:"Ціна закупки",code:"purchase_cost"},{name:"Чистий прибуток",code:"net_profit"},{name:"Рентабельність",code:"business_profitability"}]),h=k(x),$=k([]),y=w({}),L=N(()=>{let e={};return f.value.sortField&&(e.sort=f.value.sortField,f.value.sortOrder===1?e.param="asc":f.value.sortOrder===-1&&(e.param="desc")),{perPage:f.value.rows||15,sort:e.sort&&e.param?e.sort:null,param:e.sort&&e.param?e.param:null,page:(f.value.page||0)+1}});O(async()=>{await b()});const P=async e=>{i.isLoading=!0;const{data:n}=await axios.get(route("api.statistics.bank-card-movements.cost-and-profit",e.data.month));n.success&&(y[e.data.id]=n.result),i.isLoading=!1},m=e=>h.value.some(n=>n.code===e),b=async()=>{i.isLoading=!0,await axios.get(route("api.statistics.profit-and-loss",L.value)).then(({data:e})=>i.data=e.result).catch(e=>console.log(e)),i.isLoading=!1},M=async e=>{f.value=e,await b()},R=async e=>{f.value=e,await b()};return(e,n)=>(l(),c(V,null,{header:a(()=>[p(" P&L ")]),default:a(()=>[o("div",S,[i.data.data?(l(),c(F,{key:0,data:i.data.data},null,8,["data"])):u("",!0),_(s(g),{resizableColumns:"",columnResizeMode:"expand",expandedRows:$.value,"onUpdate:expandedRows":n[2]||(n[2]=t=>$.value=t),onRowExpand:P,selectionMode:"single",ref:"dt",dataKey:"month",loading:i.isLoading,value:i.data.data,class:"p-datatable-sm profit-and-loss-table",lazy:"",paginator:"",rows:i.data.per_page,totalRecords:i.data.total,onPage:n[3]||(n[3]=t=>M(t)),onSort:n[4]||(n[4]=t=>R(t)),rowsPerPageOptions:[15,50,100,500],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown"},{header:a(()=>[_(s(z),{modelValue:h.value,"onUpdate:modelValue":n[0]||(n[0]=t=>h.value=t),options:x,optionLabel:"name",placeholder:"Оберіть стовпці",class:"w-full md:w-20rem"},null,8,["modelValue","options"])]),footer:a(()=>[o("div",Q,[o("div",W," Показано з "+r(i.data.from)+" по "+r(i.data.to)+" із "+r(i.data.total)+" записів ",1),o("div",X,[_(s(C),{icon:"pi pi-file-export",iconPos:"right",type:"button",label:"Експортувати",onClick:n[1]||(n[1]=()=>{})})])])]),expansion:a(t=>[o("div",Y,[y[t.data.id]?(l(),c(s(g),{key:0,value:y[t.data.id].costs,class:"p-datatable profit-and-loss-inner-table"},{default:a(()=>[_(s(d),{header:"Витрати"},{body:a(({data:v})=>[p(r(v.key),1)]),_:1}),_(s(d),null,{body:a(({data:v})=>[p(r(e.$filters.formatMoney(-v.value)),1)]),_:1})]),_:2},1032,["value"])):u("",!0),y[t.data.id]?(l(),c(s(g),{key:1,value:y[t.data.id].profits,class:"p-datatable profit-and-loss-inner-table"},{default:a(()=>[_(s(d),{header:"Надходження"},{body:a(({data:v})=>[p(r(v.key),1)]),_:1}),_(s(d),null,{body:a(({data:v})=>[p(r(e.$filters.formatMoney(v.value)),1)]),_:1})]),_:2},1032,["value"])):u("",!0)])]),default:a(()=>[_(s(d),{expander:""}),m("month")?(l(),c(s(d),{key:0,sortable:"",field:"month",header:"Місяць"},{body:a(({data:t})=>[o("div",B,r(e.$filters.monthFormat(t.month)),1)]),_:1})):u("",!0),m("total_revenues")?(l(),c(s(d),{key:1,sortable:"",field:"total_revenues"},{header:a(()=>[p(" Загальна"),D,p("виручка ")]),body:a(({data:t})=>[o("div",E,r(e.$filters.formatMoney(t.total_revenues)),1)]),_:1})):u("",!0),m("costs")?(l(),c(s(d),{key:2,sortable:"",field:"costs",header:"Витрати"},{body:a(({data:t})=>[o("div",I,r(e.$filters.formatMoney(-t.costs)),1)]),_:1})):u("",!0),m("investments")?(l(),c(s(d),{key:3,sortable:"",field:"investments",header:"Інвестиції"},{body:a(({data:t})=>[o("div",T,r(e.$filters.formatMoney(t.investments)),1)]),_:1})):u("",!0),m("returned_investments")?(l(),c(s(d),{key:4,sortable:"",field:"returned_investments"},{header:a(()=>[p(" Повернення"),U,p("інвестицій ")]),body:a(({data:t})=>[o("div",j,r(e.$filters.formatMoney(-t.returned_investments)),1)]),_:1})):u("",!0),m("dividends")?(l(),c(s(d),{key:5,sortable:"",field:"dividends",header:"Дивіденди"},{body:a(({data:t})=>[o("div",K,r(e.$filters.formatMoney(-t.dividends)),1)]),_:1})):u("",!0),m("purchase_cost")?(l(),c(s(d),{key:6,sortable:"",field:"purchase_cost"},{header:a(()=>[p(" Ціна"),q,p("закупки ")]),body:a(({data:t})=>[o("div",A,r(e.$filters.formatMoney(t.purchase_cost)),1)]),_:1})):u("",!0),m("net_profit")?(l(),c(s(d),{key:7,sortable:"",field:"net_profit"},{header:a(()=>[p(" Чистий"),G,p("прибуток ")]),body:a(({data:t})=>[o("div",H,r(e.$filters.formatMoney(t.net_profit)),1)]),_:1})):u("",!0),m("business_profitability")?(l(),c(s(d),{key:8,sortable:"",field:"business_profitability",header:"Рентабельність"},{body:a(({data:t})=>[o("div",J,r(t.business_profitability)+" % ",1)]),_:1})):u("",!0)]),_:1},8,["expandedRows","loading","value","rows","totalRecords"])])]),_:1}))}};export{ye as default};
