import N from"./Modal-a6d369b9.js";import O from"./Table-183d5f0e.js";import U from"./CrmLayout-7f065217.js";import{V as z,r as k,f as x,o as I,s as m,v,y as A,D as p,p as c,k as C,j as b,u as f,g as M,i as g,z as h,F as T,x as q,l as G,a2 as H}from"./app-da11968c.js";import"./Form-db51c82d.js";import"./app-23639435.js";import"./vue-i18n.esm-bundler-7f92347f.js";import"./moment-fbc5633a.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Logo-9fe22fca.js";const J={key:1},K={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},Q={class:"md:col-span-1"},R={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},W={class:"text-center"},ce={__name:"Index",props:["statuses"],setup(_){const V=_,l=A("$swal"),o=A("$can");z({name:null,phone:null,comment:null,status:null});const e=k({data:[],isLoading:!0,isActiveModal:!1,modalAction:"",item:{},sidebarActive:"all"}),d=k([]),s=k({status:null,currentPage:1}),w=x(()=>{const t={};return t.page=s.value.currentPage,s.value.status&&(t.status=s.value.status),t});I(()=>{i(1),d.value.push({title:"Всі",key:"all"});for(const[t,a]of Object.entries(V.statuses))d.value.push({title:a,key:t})});const D=x(()=>e.value.isActiveModal?N:null);function L(t){e.value.sidebarActive=t,t==="all"?s.value.status=null:s.value.status=t,s.value.currentPage=1,i()}function i(t){e.value.isLoading=!0,t&&(e.value.currentPage=t),axios.get(route("api.callbacks.index",w.value)).then(a=>{Object.assign(e.value.data,a.data.result),e.value.isLoading=!1}).catch(a=>{console.log(a),e.value.isLoading=!1})}function y(t){o("destroy-callbacks")&&l({title:"Видалити?",icon:"warning",showCancelButton:!0}).then(a=>{a.isConfirmed&&axios.delete(route("api.callbacks.destroy",t)).then(()=>{i(),e.value.isActiveModal&&r(),l({icon:"success",title:"Destroyed!"})}).catch(n=>{console.log(n),l({icon:"error",title:"Error!"})})})}function r(){e.value.isActiveModal=!e.value.isActiveModal}function P(t,a){o("edit-callbacks")&&axios.get(route("api.callbacks.edit",t)).then(({data:n})=>{e.value.item=n.result,e.value.modalAction="edit",e.value.item.index=a,r()}).catch(n=>console.log(n))}function B(){o("edit-callbacks")&&axios.put(route("api.callbacks.update",e.value.item.id),e.value.item).then(()=>{r(),i(),l({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),l({title:"Error!",icon:"error"})})}function E(){o("create-callbacks")&&axios.post(route("api.callbacks.create"),e.value.item).then(({data:t})=>{r(),e.value.item={},i(),l({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),l({title:"Error!",icon:"error"})})}function F(){e.value.modalAction==="edit"&&o("edit-callbacks")?B():e.value.modalAction==="create"&&o("create-callbacks")&&E()}return(t,a)=>{const n=p("loader-component"),$=p("sidebar-item"),S=p("sidebar-component"),j=p("pagination");return c(),m(U,{title:"Зворотній звʼязок"},{header:v(()=>[C(" Зворотній звʼязок ")]),default:v(()=>[e.value.isLoading?(c(),m(n,{key:0})):b("",!0),!e.value.isLoading&&f(o)("show-callbacks")?(c(),M("div",J,[g("div",K,[g("div",Q,[h(S,null,{default:v(()=>[d.value.length?(c(!0),M(T,{key:0},q(d.value,u=>(c(),m($,{onClick:X=>L(u.key),active:e.value.sidebarActive===u.key},{default:v(()=>[C(G(u.title),1)]),_:2},1032,["onClick","active"]))),256)):b("",!0)]),_:1})]),g("div",R,[h(O,{data:e.value.data.data,statuses:_.statuses,onOnEdit:P,onOnDestroy:y,"can-destroy":f(o)("destroy-callbacks")},null,8,["data","statuses","can-destroy"]),g("div",W,[h(j,{pagination:e.value.data,"click-handler":i,modelValue:s.value.currentPage,"onUpdate:modelValue":a[0]||(a[0]=u=>s.value.currentPage=u)},null,8,["pagination","modelValue"])])])]),(c(),m(H(f(D)),{item:e.value.item,onCloseModal:r,onSubmitForm:F,onDeclineForm:y,statuses:_.statuses,"can-destroy":f(o)("destroy-callbacks")},null,40,["item","statuses","can-destroy"]))])):b("",!0)]),_:1})}}};export{ce as default};
