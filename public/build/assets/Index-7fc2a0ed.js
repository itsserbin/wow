import{s as n}from"./swal-01ed9a07.js";import{_ as E}from"./Paginate-b71b7269.js";import{_ as F}from"./Button-3f74bcad.js";import{L as N}from"./Loader-8bf33617.js";import{_ as O,S as j}from"./SidebarItem-eda03439.js";import I from"./Modal-dce38a51.js";import T from"./Table-c43dfcb5.js";import U from"./CrmLayout-ec648700.js";import{i as q,G,r as _,j as k,o as J,p as l,D as u,x as d,A as h,C as p,t as v,q as A,v as m,l as y,F as K,K as z,B as H,J as Q}from"./app-f55448cf.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Modal-381c1367.js";import"./Form-263a483e.js";import"./Label-fa7af1d1.js";import"./Input-4fdb1b47.js";import"./Table-6800669f.js";import"./XCircle-78b15e67.js";import"./AuthenticatedLayout-ecf8db9d.js";import"./index.esm-f21e1dfa.js";import"./Logo-edac3a30.js";import"./vue-i18n.esm-bundler-d070be13.js";const R={key:1},W={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},X={class:"md:col-span-1"},Y={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},Z={class:"text-center"},ke={__name:"Index",props:["statuses"],setup(g){const C=g,i=q("$can"),b=G({order_id:null,sum:null}),e=_({data:[],isLoading:!0,isActiveModal:!1,modalAction:"",item:{},sidebarActive:"all"}),f=_([]),s=_({status:null,currentPage:1}),S=k(()=>{const t={};return t.page=s.value.currentPage,s.value.status&&(t.status=s.value.status),t});J(()=>{c(1),f.value.push({title:"Всі",key:"all"});for(const[t,a]of Object.entries(C.statuses))f.value.push({title:a,key:t})});const L=k(()=>e.value.isActiveModal?I:null);function M(t){e.value.sidebarActive=t,t==="all"?s.value.status=null:s.value.status=t,s.value.currentPage=1,c()}function c(t){e.value.isLoading=!0,t&&(e.value.currentPage=t),axios.get(route("api.invoices.index",S.value)).then(({data:a})=>{e.value.data=a.result,e.value.isLoading=!1}).catch(a=>{console.log(a),e.value.isLoading=!1})}function x(t){i("destroy-invoices")&&n({title:"Видалити?",icon:"warning",showCancelButton:!0}).then(a=>{a.isConfirmed&&axios.delete(route("api.invoices.destroy",t)).then(()=>{c(),e.value.isActiveModal&&r(),n({icon:"success",title:"Destroyed!"})}).catch(o=>{console.log(o),n({icon:"error",title:"Error!"})})})}function r(){e.value.isActiveModal=!e.value.isActiveModal}function $(t,a){i("edit-invoices")&&axios.get(route("api.invoices.edit",t)).then(({data:o})=>{e.value.item=o.result,e.value.modalAction="edit",e.value.item.index=a,r()}).catch(o=>console.log(o))}function w(){i("edit-invoices")&&axios.put(route("api.invoices.update",e.value.item.id),e.value.item).then(()=>{r(),c(),n({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),n({title:"Error!",icon:"error"})})}function B(){i("create-invoices")&&axios.post(route("api.invoices.create"),e.value.item).then(({data:t})=>{e.value.item=t.result,e.value.modalAction="edit",r(),c(),navigator.clipboard.writeText(t.result.data.invoice_url),n({title:"Успішно!",text:"Рахунок був успішно створений, посилання на оплату скопійовано в буфер обміну",icon:"success"})}).catch(t=>{console.log(t),n({title:"Error!",icon:"error"})})}function D(){e.value.modalAction==="edit"&&i("edit-invoices")?w():e.value.modalAction==="create"&&i("create-invoices")&&B()}function P(){i("create-invoices")&&(e.value.item=b,e.value.modalAction="create",r())}function V(){n({title:"Успішно",text:"Посилання на оплату надіслано клієнту",icon:"success"}),c()}return(t,a)=>(l(),u(U,{title:"Рахунки"},{header:d(()=>[h("Рахунки")]),default:d(()=>[e.value.isLoading?(l(),u(N,{key:0})):p("",!0),!e.value.isLoading&&v(i)("show-invoices")?(l(),A("div",R,[m("div",W,[m("div",X,[y(j,null,{default:d(()=>[f.value.length?(l(!0),A(K,{key:0},z(f.value,o=>(l(),u(O,{onClick:ee=>M(o.key),active:e.value.sidebarActive===o.key},{default:d(()=>[h(H(o.title),1)]),_:2},1032,["onClick","active"]))),256)):p("",!0)]),_:1})]),m("div",Y,[m("div",null,[v(i)("create-invoices")?(l(),u(F,{key:0,type:"btn",onClick:P},{default:d(()=>[h(" Додати ")]),_:1})):p("",!0)]),y(T,{data:e.value.data.data,statuses:g.statuses,onOnEdit:$,onOnDestroy:x,"can-destroy":v(i)("destroy-invoices"),onOnSendInvoiceSms:V},null,8,["data","statuses","can-destroy"]),m("div",Z,[y(E,{pagination:e.value.data,"click-handler":c,modelValue:s.value.currentPage,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.currentPage=o)},null,8,["pagination","modelValue"])])])]),(l(),u(Q(v(L)),{item:e.value.item,onCloseModal:r,onSubmitForm:D,onDeclineForm:x,statuses:g.statuses,"can-destroy":v(i)("destroy-invoices")},null,40,["item","statuses","can-destroy"]))])):p("",!0)]),_:1}))}};export{ke as default};
