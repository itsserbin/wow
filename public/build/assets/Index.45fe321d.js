import U from"./Modal.90034f31.js";import I from"./Table.41d63be3.js";import K from"./CrmLayout.91e2f0c1.js";import"./index.ff27c2f3.js";import{az as T,y,z as x,C as X,a0 as d,X as v,B as C,V as m,S as c,_ as g,P as p,L as M,M as f,K as k,F as Y,Z,Y as b,O as q,bg as G}from"./___vite-browser-external_commonjs-proxy.f18235ae.js";import"./Form.03c04a80.js";import"./app.2c0817a6.js";const H=b("\u0420\u0430\u0445\u0443\u043D\u043A\u0438"),J={key:1},Q={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},R={class:"md:col-span-1"},W={class:"w-full md:col-span-4 grid gap-4 grid-cols-1"},ee=b(" \u0414\u043E\u0434\u0430\u0442\u0438 "),te={class:"text-center"},ue={__name:"Index",props:["statuses"],setup(h){const L=h,n=C("$swal"),a=C("$can"),P=T({invoice_url:null,order_id:null,sum:null,status:"not_paid"}),e=y({data:[],isLoading:!0,isActiveModal:!1,modalAction:"",item:{},sidebarActive:"all"}),_=y([]),i=y({status:null,currentPage:1}),V=x(()=>{const t={};return t.page=i.value.currentPage,i.value.status&&(t.status=i.value.status),t});X(()=>{l(1),_.value.push({title:"\u0412\u0441\u0456",key:"all"});for(const[t,o]of Object.entries(L.statuses))_.value.push({title:o,key:t})});const w=x(()=>e.value.isActiveModal?U:null);function B(t){e.value.sidebarActive=t,t==="all"?i.value.status=null:i.value.status=t,i.value.currentPage=1,l()}function l(t){e.value.isLoading=!0,t&&(e.value.currentPage=t),axios.get(route("api.invoices.index",V.value)).then(({data:o})=>{e.value.data=o.result,e.value.isLoading=!1}).catch(o=>{console.log(o),e.value.isLoading=!1})}function A(t){a("destroy-invoices")&&n({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(o=>{o.isConfirmed&&axios.delete(route("api.invoices.destroy",t)).then(()=>{l(),e.value.isActiveModal&&r(),n({icon:"success",title:"Destroyed!"})}).catch(s=>{console.log(s),n({icon:"error",title:"Error!"})})})}function r(){e.value.isActiveModal=!e.value.isActiveModal}function D(t,o){a("edit-invoices")&&axios.get(route("api.invoices.edit",t)).then(({data:s})=>{e.value.item=s.result,e.value.modalAction="edit",e.value.item.index=o,r()}).catch(s=>console.log(s))}function E(){a("edit-invoices")&&axios.put(route("api.invoices.update",e.value.item.id),e.value.item).then(()=>{r(),l(),n({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),n({title:"Error!",icon:"error"})})}function F(){a("create-invoices")&&axios.post(route("api.invoices.create"),e.value.item).then(({data:t})=>{e.value.item=t.result,e.value.modalAction="edit",l(),n({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),n({title:"Error!",icon:"error"})})}function S(){e.value.modalAction==="edit"&&a("edit-invoices")?E():e.value.modalAction==="create"&&a("create-invoices")&&F()}function $(){a("create-invoices")&&(e.value.item=P,e.value.modalAction="create",r())}return(t,o)=>{const s=m("loader-component"),N=m("sidebar-item"),O=m("sidebar-component"),j=m("button-component"),z=m("pagination");return c(),d(K,{title:"\u0420\u0430\u0445\u0443\u043D\u043A\u0438"},{header:v(()=>[H]),default:v(()=>[e.value.isLoading?(c(),d(s,{key:0})):g("",!0),!e.value.isLoading&&p(a)("show-invoices")?(c(),M("div",J,[f("div",Q,[f("div",R,[k(O,null,{default:v(()=>[_.value.length?(c(!0),M(Y,{key:0},Z(_.value,u=>(c(),d(N,{onClick:oe=>B(u.key),active:e.value.sidebarActive===u.key},{default:v(()=>[b(q(u.title),1)]),_:2},1032,["onClick","active"]))),256)):g("",!0)]),_:1})]),f("div",W,[f("div",null,[p(a)("create-invoices")?(c(),d(j,{key:0,type:"btn",onClick:$},{default:v(()=>[ee]),_:1})):g("",!0)]),k(I,{data:e.value.data.data,statuses:h.statuses,onOnEdit:D,onOnDestroy:A,"can-destroy":p(a)("destroy-invoices")},null,8,["data","statuses","can-destroy"]),f("div",te,[k(z,{pagination:e.value.data,"click-handler":l,modelValue:i.value.currentPage,"onUpdate:modelValue":o[0]||(o[0]=u=>i.value.currentPage=u)},null,8,["pagination","modelValue"])])])]),(c(),d(G(p(w)),{item:e.value.item,onCloseModal:r,onSubmitForm:S,onDeclineForm:A,statuses:h.statuses,"can-destroy":p(a)("destroy-invoices")},null,40,["item","statuses","can-destroy"]))])):g("",!0)]),_:1})}}};export{ue as default};
