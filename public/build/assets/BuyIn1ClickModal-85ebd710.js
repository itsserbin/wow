import{u as C}from"./app-516251b0.js";import{r as m,s as p,v as i,M as k,p as l,i as c,z as d,k as _,A,u as I,g as w,x as V,F as x,j as T}from"./app-c2ee199e.js";import{U as P}from"./maska-224de96c.js";import{a as L,p as U}from"./eventTracking-15479577.js";import $ from"./Modal-5acfb43f.js";import v from"./Input-7b46ca3f.js";import{_ as b}from"./InputError-42f8fe1e.js";import f from"./Label-2927eee7.js";import"./vue-i18n.esm-bundler-a7d4834c.js";import"./Loader-1b800268.js";import"./_plugin-vue_export-helper-c27b6911.js";const B={class:"grid gap-4"},M={class:"block"},F={class:"block"},Q={__name:"BuyIn1ClickModal",props:["item","product","eventIdPurchaseIn1Click","eventIdAddToCard","isAddToCart"],emits:["closeModal","addToCard"],setup(h,{emit:N}){const o=h,y=C(),n=m({name:"",last_name:"",middle_name:"",email:null,comment:null,phone:null,city:null,postal_office:null,payment_method:null,event_id:o.eventIdPurchaseIn1Click}),t=m({isLoading:!1,errors:[],contentIds:[],ga4ProductsArray:[]}),s=k();async function g(){t.value.errors=[],t.value.isLoading=!0,o.isAddToCart?await u():await axios.post(route("api.v1.cart.add"),o.item).then(()=>{o.isAddToCart=!0;try{L({value:o.product.discount_price?o.product.discount_price:o.product.price,currency:"UAH",content_type:"product",content_ids:[o.item.item_id],content_name:o.product.h1},o.eventIdAddToCard)}catch(a){console.error(a)}s.commit("loadCart"),u()})}async function u(){await axios.post(route("api.v1.orders.create.1click"),n.value).then(({data:a})=>{try{s.state.list.forEach(e=>{t.value.contentIds.push(e.id),t.value.ga4ProductsArray.push({item_name:e.name.ua?e.name.ua:e.name.ru,item_id:e.id,price:e.discount_price?e.discount_price:e.price,quantity:e.count})}),U({value:s.state.totalPrice,currency:"UAH",content_type:"product",num_items:s.state.totalCount,content_ids:t.value.contentIds},o.eventIdPurchaseIn1Click),y.trackEvent({event:"send_order",ecommerce:{transaction_id:a.order.id,value:a.order.total_price,currency:"UAH",items:t.value.ga4ProductsArray}})}catch(e){console.log(e)}axios.post(route("sms.new.order"),{order_id:a.order.id,phone:a.order.client.phone}),t.value.isLoading=!1,typeof window<"u"&&(window.location.href=route("thanks",a.order.id))}).catch(({response:a})=>{t.value.errors=a.data,t.value.isLoading=!1})}return(a,e)=>(l(),p($,{size:"small","submit-button-text":"Замовити",onSubmitForm:g,onCloseModal:e[2]||(e[2]=r=>a.$emit("closeModal")),"is-loading":t.value.isLoading},{content:i(()=>[c("div",B,[c("div",M,[d(f,null,{default:i(()=>[_("Ім`я")]),_:1}),d(v,{type:"text",modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.name=r),placeholder:"Введіть ваше ім'я"},null,8,["modelValue"])]),c("div",F,[d(f,{required:!0},{default:i(()=>[_("Ваш телефон")]),_:1}),A(d(v,{type:"tel","data-maska":"+38 (0##) ###-##-##",modelValue:n.value.phone,"onUpdate:modelValue":e[1]||(e[1]=r=>n.value.phone=r),placeholder:"+38 (0",class:"phone"},null,8,["modelValue"]),[[I(P)]]),t.value.errors.phone?(l(!0),w(x,{key:0},V(t.value.errors.phone,r=>(l(),p(b,{message:r},null,8,["message"]))),256)):T("",!0)])])]),_:1},8,["is-loading"]))}};export{Q as default};
