import{d as L,r as k,o as N,g as b,z as f,i as m,F as w,x as T,u as O,s as g,j as _,P as W,M as S,p as h}from"./app-443dd386.js";import I from"./Loader-1794803c.js";import D from"./PersonalData-d43654e5.js";import U from"./Delivery-bbdcc294.js";import B from"./Payment-64a259af.js";import M from"./OrderItem-865591e1.js";import R from"./Comment-a1ca4f88.js";import q from"./CheckoutTotal-f5a1f887.js";import{_ as H}from"./MasterLayout-4308f7a5.js";import V from"./Head-7f84473b.js";import{e as A}from"./eventTracking-dc861e48.js";import{u as $}from"./app-5a71db84.js";import{C as x,h as j}from"./hmac-md5-06d1856c.js";import{i as z}from"./load-23f79d02.js";import{s as J}from"./swal-950be8b9.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Label-f9528428.js";import"./Input-95edb81d.js";import"./InputError-bb3e75e3.js";import"./maska-224de96c.js";import"./Button-8f72f0ce.js";import"./Header-afe8c94e.js";import"./CartIcon-212deb96.js";import"./Langs-f92e0adb.js";import"./Logo-89534839.js";import"./HeaderCategories-f231918a.js";import"./create-element-if-not-defined-cfc4b805.js";import"./pagination-93e47b88.js";import"./lazy-e32f6dbe.js";import"./autoplay-1fa09654.js";import"./swiper-slide-be164eaf.js";import"./Footer-6b726eab.js";import"./FixedBanner-93f459ed.js";import"./ScrollToTop-03f722ab.js";import"./vue-i18n.esm-bundler-c84158d1.js";function s(){}var v=null;s.prototype.build=54;s.prototype.name="WFPWidget";s.prototype.defaultTarget="https://secure.wayforpay.com";s.prototype.getTargetHost=function(){var t=document.getElementById("widget-wfp-script"),i,e;return this.target?this.target:t?(t.getAttribute.length!==void 0?i=t.src:i=t.getAttribute("src"),e=document.createElement("a"),e.href=i,e.hostname=="secure.wayforpay.com"?this.target=this.defaultTarget:this.target=e.protocol+"//"+e.hostname,this.target):this.defaultTarget};s.prototype.isVerify=function(){return this.requestType=="VERIFY"};s.prototype.getPayUrl=function(){return this.isVerify()?this.getTargetHost()+"/verify"+(this.skin?"/"+this.skin:""):this.getTargetHost()+"/pay"+(this.skin?"/"+this.skin:"")};s.prototype.run=function(t,i,e,n,a){var u=this,l=t.hasOwnProperty("theme")?t.theme:!1;this.uuid=C(),v=this.uuid,this.postFields=t,this.straightWidget=t.hasOwnProperty("straightWidget")?t.straightWidget:!1,this.makeRedirect=t.hasOwnProperty("makeRedirect")?t.makeRedirect:!1,this.requestType=t.hasOwnProperty("requestType")?t.requestType:!1,this.skin=l||(this.makeRedirect?"":this.isVerify()?"verify_compact":"compact"),this.postFields.clientStartTime=Date.now(),this.isMobile=/Android|webOS|iPhone|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isSafari=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<0,this.makeRedirect?this.submitData("pre"):this.isMobile&&!this.straightWidget?this.submitData("page"):(this.createContainer(),this.createOverlay(),this.createFrame(),u.frame.contentWindow.focus(),this.onApproved=i,this.onDeclined=e,this.onPending=n,this.onUnknown=a,window.addEventListener("message",function(y){u.widgetListener(u,y)}))};s.prototype.invoice=function(t,i){var e=this;this.uuid=C(),v=this.uuid,this.isMobile=/Android|webOS|iPhone|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isSafari=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<0,this.isMobile&&!i?window.location.href=t:(this.createContainer(),this.createOverlay(),this.createFrameUrl(t),e.frame.contentWindow.focus(),window.addEventListener("message",function(n){e.widgetListener(e,n)}))};s.prototype.widgetListener=function(t,i){var e;if(i.origin!=t.getTargetHost(),v===t.uuid){if(i.data=="WfpWidgetEventClose"){var n=document.getElementById("wfp-container");n&&n.parentNode.removeChild(n),document.body.classList.remove("wfp-widget-open")}else if(i.data=="WfpWidgetEventLoaded")t.overlay.classList.remove("loader"),t.isMobile&&t.isSafari&&(t.overlay.style.display="none");else if(i.data=="WfpWidgetEventFadeOutOverlay")t.frame.classList.add("secure");else if(i.data=="WfpWidgetEventFadeInOverlay")t.frame.classList.remove("secure"),t.overlay.classList.add("loader");else if(i.data=="WfpWidgetEventComplete3d")t.frame.classList.remove("secure"),t.overlay.classList.add("loader"),G(t.frame);else if(i.data!="WfpWidgetEventApproved"){if(i.data!="WfpWidgetEventDeclined"){if(i.data!="WfpWidgetEventPending")try{if(e=JSON.parse(i.data),"reasonCode"in e){if(e.clientStartTime&&e.clientStartTime!=this.postFields.clientStartTime)return;e.reasonCode==1100?typeof this.onApproved=="function"&&this.onApproved(e):e.reasonCode==1134||e.reasonCode==1131?typeof this.onPending=="function"&&this.onPending(e):typeof this.onDeclined=="function"&&(this.onDeclined(e),console.log(e.reasonCode+" "+e.reason))}else"pay_way"in e&&e.pay_way=="privat24"?this.submitForm("https://api.privatbank.ua/p24api/ishop",e):"paytype"in e&&e.paytype=="privat24New"?this.submitForm("https://www.liqpay.ua/api/checkout",e):"paytype"in e&&e.paytype=="lpTerminal"?this.submitForm("https://www.liqpay.ua/api/checkout",e):typeof this.onUnknown=="function"&&this.onUnknown(data)}catch{}}}}};s.prototype.closeit=function(){this.container&&this.container.parentNode&&(this.container.parentNode.removeChild(this.container),this.container=null,document.body.classList.remove("wfp-widget-open"))};s.prototype.createContainer=function(){var t=document.getElementById("wfp-container"),i=document.getElementById("wfp-styles");if(!i){var e=document.createElement("link");e.href=this.getTargetHost()+"/server/pay-widget.min.css?b="+this.build,e.setAttribute("id","wfp-styles"),e.type="text/css",e.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(e)}t&&t.parentNode.removeChild(t),this.container=document.createElement("div"),this.container.setAttribute("id","wfp-container"),this.container.classList.add("wfp-widget-container"),this.isMobile&&this.isSafari&&this.container.classList.add("wfp-container-scroll-fix"),document.body.appendChild(this.container),document.body.classList.add("wfp-widget-open")};s.prototype.createOverlay=function(){this.overlay=document.createElement("div"),this.overlay.classList.add("wfp-widget-overlay"),this.overlay.classList.add("loader"),this.container.appendChild(this.overlay)};s.prototype.createFrame=function(){this.frame=document.createElement("iframe"),this.frame.setAttribute("name",this.name+"Frame"),this.frame.setAttribute("src","about:blank"),this.frame.setAttribute("allowpaymentrequest","true"),this.frame.setAttribute("frameborder","0"),this.frame.classList.add("wfp-widget-frame"),this.isMobile&&this.isSafari&&this.frame.classList.add("wfp-frame-scroll-fix"),this.container.appendChild(this.frame),this.submitData("frame")};s.prototype.createFrameUrl=function(t){this.frame=document.createElement("iframe"),this.frame.setAttribute("name",this.name+"Frame"),this.frame.setAttribute("src",t+"?behavior=frame&build="+this.build),this.frame.setAttribute("allowpaymentrequest","true"),this.frame.setAttribute("frameborder","0"),this.frame.classList.add("wfp-widget-frame"),this.isMobile&&this.isSafari&&this.frame.classList.add("wfp-frame-scroll-fix"),this.container.appendChild(this.frame)};s.prototype.submitData=function(t){var i=document.createElement("form"),e,n,a,u,l=document.getElementsByTagName("body")[0];i.style.cssText="display: none;",i.setAttribute("name",this.name+"Form"),i.setAttribute("action",this.getPayUrl()+(t?"?behavior="+t+"&build="+this.build:"?build="+this.build)),i.setAttribute("method","POST"),i.setAttribute("accept-charset","utf-8"),t==="frame"&&i.setAttribute("target",this.name+"Frame"),e=document.createElement("input"),e.setAttribute("type","submit"),i.appendChild(e);for(n in this.postFields)if(this.postFields.hasOwnProperty(n))if(this.postFields[n]instanceof Array){a=this.postFields[n];for(u in a)a.hasOwnProperty(u)&&(e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("name",n+"[]"),e.setAttribute("value",a[u]),i.appendChild(e))}else e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("name",n),e.setAttribute("value",this.postFields[n]),i.appendChild(e);t==="frame"?this.container.appendChild(i):l.appendChild(i),i.submit()};s.prototype.submitForm=function(t,i){var e=document.createElement("form"),n,a,u=document.getElementsByTagName("body")[0];e.setAttribute("name",this.name+"FreeForm"),e.setAttribute("action",t),e.setAttribute("method","POST"),e.setAttribute("accept-charset","UTF-8"),n=document.createElement("input"),n.setAttribute("type","submit"),e.appendChild(n);for(a in i)i.hasOwnProperty(a)&&(n=document.createElement("input"),n.setAttribute("type","text"),n.setAttribute("name",a),n.setAttribute("value",i[a]),e.appendChild(n));u.appendChild(e),e.submit()};function G(t){t.style.display="none",setTimeout(function(){t.style.display="block",t.classList.add("redraw")},500)}function C(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=Math.random()*16|0,e=t=="x"?i:i&3|8;return e.toString(16)})}const Y=["onSubmit"],K={class:"grid grid-cols-1 md:grid-cols-2 relative gap-4"},Q={class:""},X={class:"cart-item__right row mb-3"},Z=m("h3",{class:"text-2xl font-heading mb-[1rem]"},"Замовлення",-1),ee={class:"grid gap-4"},te=L({layout:H}),Ue=Object.assign(te,{__name:"Index",props:["lang","eventIdInitiateCheckout","eventIdPurchase","categories","options","pages","eventIdPageView"],setup(t){const i=t,e=S(),n=$(),a=k({order:{name:null,last_name:null,middle_name:null,email:null,comment:null,phone:null,city:null,postal_office:null,payment_method:null,event_id:i.eventIdPurchase},errors:[],contentIds:[],ga4ProductsArray:[],isLoading:!1});N(()=>{{e.state.list.forEach(r=>{a.value.contentIds.push(r.id),a.value.ga4ProductsArray.push({item_name:r.name.ua?r.name.ua:r.name.ru,item_id:r.id,price:r.discount_price?r.discount_price:r.price,quantity:r.count})});try{A("InitiateCheckout",{value:e.state.totalPrice,currency:"UAH",num_items:e.state.totalCount,content_ids:a.value.contentIds,content_type:"product"},i.eventIdInitiateCheckout),n.trackEvent({event:"start_checkout",ecommerce:{items:a.value.ga4ProductsArray}})}catch(r){console.log(r)}}z.value=!1});function u(r){const p=new s,c={names:[],prices:[],counts:[],amount:null};r.items.forEach(d=>{c.names.push(d.product.h1.ua?d.product.h1.ua:d.product.h1.ru),c.counts.push(d.count)}),r.payment_method==="minimum_prepayment"?(c.amount=r.total_price*.1,r.items.forEach(d=>{c.prices.push(d.sale_price*.1)})):r.payment_method==="full_prepayment"&&(c.amount=r.total_price,r.items.forEach(d=>{c.prices.push(d.sale_price)}));let o={merchantAccount:"dabango_store",merchantDomainName:"dabango.store",orderReference:r.id,orderDate:Math.floor(new Date(r.created_at).getTime()/1e3),amount:c.amount,currency:"UAH",productName:c.names,productPrice:c.prices,productCount:c.counts,clientFirstName:r.client.name,clientLastName:r.client.last_name,clientPhone:r.client.phone,language:"UA",deliveryList:"nova",returnUrl:route("api.v1.orders.set-prepayment")},P=Object.values({merchantAccount:o.merchantAccount,merchantDomainName:o.merchantDomainName,orderReference:o.orderReference,orderDate:o.orderDate,amount:o.amount,currency:o.currency,productName:o.productName.join(";"),productCount:o.productCount.join(";"),productPrice:o.productPrice.join(";")}).join(";"),F=x.enc.Utf8.stringify(x.enc.Utf8.parse(j(P,"4acdf560d56f56cde24ec0278a7f2676c5020f94")));p.run({merchantAccount:o.merchantAccount,merchantDomainName:o.merchantDomainName,authorizationType:"SimpleSignature",merchantSignature:F,orderReference:o.orderReference,orderDate:o.orderDate,amount:o.amount,currency:o.currency,productName:o.productName,productPrice:o.productPrice,productCount:o.productCount,clientFirstName:o.clientFirstName,clientLastName:o.clientLastName,clientPhone:o.clientPhone,language:o.language,returnUrl:o.returnUrl},function(d){l(d,r)},function(d){},function(d){})}function l(r,p){window.addEventListener("message",function(){event.data==="WfpWidgetEventApproved"&&axios.post(route("api.v1.orders.set-prepayment",r)).then(({data:c})=>{window.location.href=route("thanks",p.id)})},!1)}const y=async()=>{a.value.isLoading=!0,a.value.errors=[],await axios.post(route("api.v1.orders.create"),a.value.order).then(async({data:r})=>{try{A("Purchase",{value:e.state.totalPrice,currency:"UAH",content_type:"product",num_items:e.state.totalCount,content_ids:a.value.contentIds},i.eventIdPurchase),n.trackEvent({event:"send_order",ecommerce:{transaction_id:r.order.id,value:r.order.total_price,currency:"UAH",items:a.value.ga4ProductsArray}})}catch(p){console.log(p)}await axios.post(route("sms.new.order"),{order_id:r.order.id,phone:r.order.client.phone}),r.order.payment_method==="minimum_prepayment"||r.order.payment_method==="full_prepayment"?u(r.order):typeof window<"u"&&(window.location.href=route("thanks",r.order.id)),a.value.isLoading=!1}).catch(({response:r})=>{console.log(r),a.value.errors=r.data,a.value.isLoading=!1,J({icon:"error",title:"Виникла помилка",text:"Перевірте корректніть данних"})})};function E(){}return(r,p)=>(h(),b(w,null,[f(V,{title:"Оформлення замовлення"}),m("form",{onSubmit:W(y,["prevent"])},[m("div",K,[m("div",null,[f(D,{order:a.value.order,errors:a.value.errors},null,8,["order","errors"]),f(U,{order:a.value.order},null,8,["order"]),f(B,{order:a.value.order},null,8,["order"]),f(R,{order:a.value.order},null,8,["order"])]),m("div",Q,[m("div",X,[Z,m("div",ee,[(h(!0),b(w,null,T(O(e).state.list,c=>(h(),g(M,{item:c,onRemoveFromCart:E},null,8,["item"]))),256))]),a.value.isLoading?(h(),g(I,{key:0})):_("",!0),a.value.isLoading?_("",!0):(h(),g(q,{key:1}))])])])],40,Y)],64))}});export{Ue as default};
