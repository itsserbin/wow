import z from"./Modal.a119e4b5.js";import U from"./Table.0a851a73.js";import q from"./CrmLayout.b3a4f20f.js";import{j as I,r as w,S,q as J,k as K}from"./app.68928a22.js";import{w as f,x as L,S as Q,Q as u,K as i,X as B,F as l,P as d,B as v,y as _,z as y,J as m,M as A,O as C,L as h,A as E,a2 as T}from"./___vite-browser-external_commonjs-proxy.4f2b06be.js";import"./Form.116ff326.js";import"./ItemsTable.07dd3858.js";const X=h(" \u041A\u043B\u0456\u0454\u043D\u0442\u0438 "),G={key:1},H={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},R={class:"md:col-span-1"},W={class:"w-full md:col-span-4 grid grid-cols-1 gap-4"},Y={class:"text-center"},ie={__name:"Index",setup(Z){const k=[{title:"\u0415\u043A\u0441\u043F\u043E\u0440\u0442\u0443\u0432\u0430\u0442\u0438",key:"export"}],e=f({data:[],statuses:[],subStatuses:[],isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),o=f({status:null,currentPage:1,orderBy:{key:null,val:null}}),M=L(()=>{const{currentPage:t,status:s=null,orderBy:a=null}=o.value;return{page:t,status:s,orderBy:a}}),$=(t,s)=>{o.value.orderBy={key:t,val:s},o.value.currentPage=1,n()},p=f([]),r=B("$swal"),c=B("$can");Q(()=>{n(),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.statuses=t.statuses,e.value.subStatuses=t.subStatuses,p.value.push({title:"\u0412\u0441\u0456 \u043A\u043B\u0456\u0454\u043D\u0442\u0438",key:"all"});for(const[s,a]of Object.entries(t.statuses))p.value.push({title:a,key:s})}),route().params.id&&(e.value.isLoading=!0,b(route().params.id))});const P=L(()=>e.value.isActiveEditModal?z:null),D=t=>{t==="export"&&(window.location.href=route("admin.crm.clients.export"))},V=async t=>{await axios.get(route("api.clients.search",{search:t})).then(({data:s})=>{e.value.sidebarActive=null,o.value.currentPage=1,e.value.data=s.result,e.value.isLoading=!1}).catch(s=>{console.log(s),e.value.isLoading=!1})},F=t=>{e.value.sidebarActive=t,o.value.status=t==="all"?null:t,n()},O=async t=>{t&&(o.value.currentPage=t),await n()},n=async()=>{await axios.get(route("api.clients.index",M.value)).then(({data:t})=>{e.value.data=t.result,e.value.isLoading=!1}).catch(t=>{console.log(t),e.value.isLoading=!1})},x=async t=>{c("destroy-clients")&&r({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(async s=>{s.isConfirmed&&await axios.delete(route("api.clients.destroy",t)).then(()=>{e.value.isLoading=!1,n(),e.value.isActiveEditModal&&g(),r({title:"Success!",icon:"success"})}).catch(a=>{console.log(a),r({title:"Error!",icon:"error"})})})},b=async(t,s)=>{await axios.get(route("api.clients.edit",t)).then(({data:a})=>{e.value.modal.index=s,e.value.modal=a.result,g(),e.value.isLoading=!1}).catch(a=>console.log(a))},N=async()=>{await axios.put(route("api.clients.update",e.value.modal.id),e.value.modal).then(()=>{g(),n(),r({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),r({title:"Error!",icon:"error"})})},g=()=>{e.value.isActiveEditModal=!e.value.isActiveEditModal};return(t,s)=>(l(),u(q,{title:"\u041A\u043B\u0456\u0454\u043D\u0442\u0438"},{header:i(()=>[X]),default:i(()=>[e.value.isLoading?(l(),u(I,{key:0})):d("",!0),!e.value.isLoading&&v(c)("show-clients")?(l(),_("div",G,[y("div",H,[y("div",R,[m(S,{class:"mb-5"},{default:i(()=>[p.value.length?(l(!0),_(A,{key:0},C(p.value,a=>(l(),u(w,{onClick:j=>F(a.key),active:e.value.sidebarActive===a.key},{default:i(()=>[h(E(a.title),1)]),_:2},1032,["onClick","active"]))),256)):d("",!0)]),_:1}),v(c)("export-orders")?(l(),u(S,{key:0},{default:i(()=>[k.length?(l(),_(A,{key:0},C(k,a=>m(w,{onClick:j=>D(a.key)},{default:i(()=>[h(E(a.title),1)]),_:2},1032,["onClick"])),64)):d("",!0)]),_:1})):d("",!0)]),y("div",W,[m(J,{onSearch:V,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u043F\u043E-\u0431\u0430\u0442\u044C\u043A\u043E\u0432\u0456, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, email, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),m(U,{data:e.value.data.data,onOnEdit:b,onOnDestroy:x,onOrderBy:$,statuses:e.value.statuses,canDestroy:v(c)("destroy-clients")},null,8,["data","statuses","canDestroy"]),y("div",Y,[m(K,{pagination:e.value.data,"click-handler":O,modelValue:o.value.currentPage,"onUpdate:modelValue":s[0]||(s[0]=a=>o.value.currentPage=a)},null,8,["pagination","modelValue"])])])]),(l(),u(T(v(P)),{item:e.value.modal,statuses:e.value.statuses,"sub-statuses":e.value.subStatuses,size:"extralarge",onCloseModal:g,onDeclineForm:x,onSubmitForm:N,canDestroy:v(c)("destroy-clients")},null,40,["item","statuses","sub-statuses","canDestroy"]))])):d("",!0)]),_:1}))}};export{ie as default};
