import J from"./Indicators-d959ff81.js";import K from"./Modal-fdfadad6.js";import T from"./Table-bdee9285.js";import G from"./CrmLayout-43194635.js";import{L as H}from"./Loader-3f12bd2d.js";import{_ as S,S as D}from"./SidebarItem-9941fa54.js";import{_ as Q}from"./Search-3c60f6f7.js";import{_ as W}from"./Paginate-7604e12b.js";import{_ as X}from"./Datepicker-47ab19ec.js";import{C as v}from"./ClientsRepository-8ce9d459.js";import{u as Y}from"./vue-i18n.esm-bundler-39f45a4f.js";import{s as k}from"./swal-76588f7d.js";import{i as Z,r as w,j as L,o as ee,p as i,D as p,x as n,A as b,B as $,t as f,q as _,v as h,l as r,F as A,K as P,C as u,J as te}from"./app-6d1ec759.js";import"./Card-36606ffb.js";import"./Modal-1e77e375.js";import"./Form-2cc25cce.js";import"./ItemsTable-996c81f3.js";import"./Table-d4015883.js";import"./Label-646a10b8.js";import"./Select-ffba6ec3.js";import"./Input-335d7e3d.js";import"./Textarea-8cacefaf.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-10963069.js";import"./XCircle-0fb660d3.js";import"./AuthenticatedLayout-53775af0.js";import"./index.esm-09a1b1ab.js";import"./Logo-7b0b10d2.js";import"./vue-datepicker-609e4dad.js";const ae={key:0},se={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},oe={class:"md:col-span-1"},ie={class:"md:col-span-4"},le={key:1,class:"w-full grid grid-cols-1 gap-4"},re={class:"text-center"},Oe={__name:"Index",props:["statuses","subStatuses","orderStatuses"],setup(c){const V=c,{t:d}=Y(),m=Z("$can"),g=w([]),x=[{title:d("clients.export"),key:"export"}],t=w({data:[],indicators:{},isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),s=w({status:null,currentPage:1,orderBy:{key:null,val:null},date:[]}),M=L(()=>{if(s.value.date.length===2)return{date_start:s.value.date[0].toLocaleDateString(),date_end:s.value.date[1].toLocaleDateString()}}),E=L(()=>{const{currentPage:e,status:o=null,orderBy:a=null}=s.value;return{page:e,status:o,orderBy:a,...M.value}}),F=(e,o)=>{s.value.orderBy={key:e,val:o},s.value.currentPage=1,l()};ee(()=>{l(),g.value.push({title:d("clients.all_clients"),key:"all"});for(const[e,o]of Object.entries(V.statuses))g.value.push({title:o,key:e});route().params.id&&(t.value.isLoading=!0,C(route().params.id))});const N=L(()=>t.value.isActiveEditModal?K:null),O=e=>{e==="export"&&(window.location.href=route("admin.crm.clients.export"))},j=async e=>{t.value.isLoading=!0;const o=await v.search(e);o.success&&(t.value.sidebarActive=null,s.value.currentPage=1,t.value.data=o.result,t.value.isLoading=!1),t.value.isLoading=!1},U=e=>{t.value.sidebarActive=e,s.value.status=e==="all"?null:e,s.value.date=[],s.value.currentPage=1,l()},I=async()=>{s.value.currentPage=1,await l()},R=async e=>{e&&(s.value.currentPage=e),await l()},l=async()=>{t.value.isLoading=!0;const e=await v.fetch(E.value);e.success&&(t.value.indicators=e.indicators,t.value.data=e.result,t.value.isLoading=!1)},B=async e=>{if(m("destroy-clients")&&(await k({title:d("swal.sure"),icon:"warning",showCancelButton:!0})).isConfirmed){const{success:a}=await v.destroy(e);a&&(t.value.isLoading=!1,await l(),t.value.isActiveEditModal&&y(),k({title:d("swal.destroyed"),icon:"success"}))}},C=async(e,o)=>{t.value.isLoading=!0;const a=await v.edit(e);a.success&&(t.value.modal.index=o,t.value.modal=a.result,y(),t.value.isLoading=!1)},q=async()=>{(await v.update(t.value.modal)).success&&(y(),await l(),k({title:d("swal.updated"),icon:"success"}))},y=()=>{t.value.isActiveEditModal=!t.value.isActiveEditModal};return(e,o)=>(i(),p(G,{title:e.$t("clients.page_title")},{header:n(()=>[b($(e.$t("clients.page_title")),1)]),default:n(()=>[f(m)("show-clients")?(i(),_("div",ae,[h("div",se,[h("div",oe,[r(D,{class:"mb-5"},{default:n(()=>[g.value.length?(i(!0),_(A,{key:0},P(g.value,a=>(i(),p(S,{onClick:z=>U(a.key),active:t.value.sidebarActive===a.key},{default:n(()=>[b($(a.title),1)]),_:2},1032,["onClick","active"]))),256)):u("",!0)]),_:1}),f(m)("export-orders")?(i(),p(D,{key:0},{default:n(()=>[x.length?(i(),_(A,{key:0},P(x,a=>r(S,{onClick:z=>O(a.key)},{default:n(()=>[b($(a.title),1)]),_:2},1032,["onClick"])),64)):u("",!0)]),_:1})):u("",!0)]),h("div",ie,[t.value.isLoading?(i(),p(H,{key:0})):u("",!0),t.value.isLoading?u("",!0):(i(),_("div",le,[r(X,{modelValue:s.value.date,"onUpdate:modelValue":[o[0]||(o[0]=a=>s.value.date=a),I]},null,8,["modelValue"]),r(J,{data:t.value.indicators},null,8,["data"]),r(Q,{onSearch:j,clear:!0,placeholder:e.$t("clients.search_placeholder")},null,8,["placeholder"]),r(T,{data:t.value.data.data,onOnEdit:C,onOnDestroy:B,onOrderBy:F,statuses:c.statuses,canDestroy:f(m)("destroy-clients")},null,8,["data","statuses","canDestroy"]),h("div",re,[r(W,{pagination:t.value.data,"click-handler":R,modelValue:s.value.currentPage,"onUpdate:modelValue":o[1]||(o[1]=a=>s.value.currentPage=a)},null,8,["pagination","modelValue"])])]))])]),(i(),p(te(f(N)),{item:t.value.modal,statuses:c.statuses,"sub-statuses":c.subStatuses,"order-statuses":c.orderStatuses,size:"extralarge",onCloseModal:y,onDeclineForm:B,onSubmitForm:q,canDestroy:f(m)("destroy-clients")},null,40,["item","statuses","sub-statuses","order-statuses","canDestroy"]))])):u("",!0)]),_:1},8,["title"]))}};export{Oe as default};
