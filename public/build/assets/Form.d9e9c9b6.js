import{F as c,y as f,z as i,bU as R,x as V,az as U,w as X,S as Y,M as l,B as h,O as M,Q as y,G as v,a8 as z,A as k,P as w,a7 as S,U as B}from"./moment.791e2419.js";import{_ as n,a as u,b as I,e as C,d as O,g as Z,p as _}from"./app.ae1110c2.js";import ee from"./Modal.f2b3c163.js";import te from"./Table.c0d68387.js";import oe from"./ClientOrders.c1039f94.js";import le from"./Table.8396e623.js";import se from"./Modal.e42da883.js";import"./Form.31722852.js";import"./Form.60fedf13.js";const ie=["width","height"],re=i("path",{d:"M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"},null,-1),ae=[re],ne={__name:"Telephone",props:{width:{default:16},height:{default:16}},setup(t){return(m,a)=>(c(),f("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,viewBox:"0 0 16 16"},ae,8,ie))}},de=["width","height"],ce=i("path",{"fill-rule":"nonzero",d:"M141.44 0h172.68c4.71 0 8.91 2.27 11.54 5.77L434.11 123.1a14.37 14.37 0 0 1 3.81 9.75l.08 251.18c0 17.62-7.25 33.69-18.9 45.36l-.07.07c-11.67 11.64-27.73 18.87-45.33 18.87h-20.06c-.3 17.24-7.48 32.9-18.88 44.29-11.66 11.66-27.75 18.9-45.42 18.9H64.3c-17.67 0-33.76-7.24-45.41-18.9C7.24 480.98 0 464.9 0 447.22V135.87c0-17.68 7.23-33.78 18.88-45.42C30.52 78.8 46.62 71.57 64.3 71.57h12.84V64.3c0-17.68 7.23-33.78 18.88-45.42C107.66 7.23 123.76 0 141.44 0zm30.53 250.96c-7.97 0-14.43-6.47-14.43-14.44 0-7.96 6.46-14.43 14.43-14.43h171.2c7.97 0 14.44 6.47 14.44 14.43 0 7.97-6.47 14.44-14.44 14.44h-171.2zm0 76.86c-7.97 0-14.43-6.46-14.43-14.43 0-7.96 6.46-14.43 14.43-14.43h136.42c7.97 0 14.43 6.47 14.43 14.43 0 7.97-6.46 14.43-14.43 14.43H171.97zM322.31 44.44v49.03c.96 12.3 5.21 21.9 12.65 28.26 7.8 6.66 19.58 10.41 35.23 10.69l33.39-.04-81.27-87.94zm86.83 116.78-39.17-.06c-22.79-.35-40.77-6.5-53.72-17.57-13.48-11.54-21.1-27.86-22.66-48.03l-.14-2v-64.7H141.44c-9.73 0-18.61 4-25.03 10.41C110 45.69 106 54.57 106 64.3v319.73c0 9.74 4.01 18.61 10.42 25.02 6.42 6.42 15.29 10.42 25.02 10.42H373.7c9.75 0 18.62-3.98 25.01-10.38 6.45-6.44 10.43-15.3 10.43-25.06V161.22zm-84.38 287.11H141.44c-17.68 0-33.77-7.24-45.41-18.88-11.65-11.65-18.89-27.73-18.89-45.42v-283.6H64.3c-9.74 0-18.61 4-25.03 10.41-6.41 6.42-10.41 15.29-10.41 25.03v311.35c0 9.73 4.01 18.59 10.42 25.01 6.43 6.43 15.3 10.43 25.02 10.43h225.04c9.72 0 18.59-4 25.02-10.43 6.17-6.17 10.12-14.61 10.4-23.9z"},null,-1),ue=[ce],me={__name:"Copy",props:{width:{default:16},height:{default:16}},setup(t){return(m,a)=>(c(),f("svg",{xmlns:"http://www.w3.org/2000/svg","fill-rule":"evenodd","clip-rule":"evenodd",viewBox:"0 0 438 511.52",width:t.width,height:t.height},ue,8,de))}},ve={class:"grid gap-4"},he={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},fe={class:"block"},ye={class:"block"},ge={class:"block"},be={class:"flex items-center gap-x-2"},we=["href"],pe={class:"block"},$e=i("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},null,-1),Ve=i("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),ke={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},_e={class:"block"},Me={class:"block"},Ie={class:"block"},Ce={class:"block"},xe={class:"block"},Fe={class:"flex gap-x-2 items-center w-full"},Ue=i("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"grid grid-cols-1 gap-4"},Be={class:"block"},Oe={class:"block"},Ae={class:"block"},Ee={key:0},je={key:1},De=w(") "),Le={key:0,class:"grid grid-cols-2 gap-x-2"},He={class:"flex gap-x-2"},Ne={class:"block"},Te=i("hr",{class:"h-px my-8 bg-gray-200 border-0 dark:bg-gray-500"},null,-1),Pe={class:"grid grid-cols-1 gap-y-4"},We={class:"block"},Ge={class:"block"},Qe={class:"block"},qe={class:"block mb-5"},Je=w("\u0414\u043E\u0434\u0430\u0442\u0438 \u0442\u043E\u0432\u0430\u0440"),Ke={class:"grid grid-cols-2 md:grid-cols-4 mt-5"},Re={key:1,class:"block"},Xe=w(" \u0414\u043E\u0434\u0430\u0442\u0438 \u0440\u0430\u0445\u0443\u043D\u043E\u043A "),at={__name:"Form",props:["order","statuses","paymentMethods","clientStatuses","invoiceStatuses"],emits:["submitItemForm","onEditClient"],setup(t,{emit:m}){const a=t,{t:A}=R(),d=B("$swal"),g=B("$can"),E=V(()=>a.order.total_price-a.order.prepayment_sum),j=V(()=>{const{name:e,last_name:o,middle_name:s}=a.order.client,$=[o,e,s].filter(Boolean);return $.length?$.join(" "):"\u0414\u0430\u043D\u0456 \u043D\u0435 \u0432\u043A\u0430\u0437\u0430\u043D\u0456"}),x=U({order_id:a.order.id,sum:null}),r=X({showItemsModal:!1,showInvoicesModal:!1,itemsModalAction:"",item:{count:1,size:"",color:"",product_id:null},invoiceItem:{},statuses:[],managers:[],paymentMethods:[]});Y(()=>{Q();for(const[e,o]of Object.entries(a.statuses))r.value.statuses.push({key:e,value:o});for(const[e,o]of Object.entries(a.paymentMethods))r.value.paymentMethods.push({key:e,value:o})});const D=V(()=>r.value.showItemsModal?ee:null),L=V(()=>r.value.showInvoicesModal?se:null);U([{key:0,value:"\u041D\u0456"},{key:1,value:"\u0422\u0430\u043A"}]);function p(){r.value.showInvoicesModal=!r.value.showInvoicesModal}const H=()=>{navigator.clipboard.writeText(a.order.client.phone).then(()=>{d({icon:"success",title:A("swal.data_copied"),timer:1e3,showConfirmButton:!1})}).catch(e=>{console.error("\u0412\u0438\u043D\u0438\u043A\u043B\u0430 \u043F\u043E\u043C\u0438\u043B\u043A\u0430 \u043F\u0456\u0434 \u0447\u0430\u0441 \u043A\u043E\u043F\u0456\u044E\u0432\u0430\u043D\u043D\u044F \u0442\u0435\u043A\u0441\u0442\u0443:",e)})};function N(e){g("destroy-invoices")&&d({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(o=>{o.isConfirmed&&axios.delete(route("api.invoices.destroy",e)).then(()=>{m("submitItemForm"),d({icon:"success",title:"Destroyed!"})}).catch(s=>{console.log(s),d({icon:"error",title:"Error!"})})})}function T(){g("create-invoices")&&(r.value.invoiceItem=x,p())}function P(){axios.post(route("api.invoices.create"),r.value.invoiceItem).then(({data:e})=>{r.value.invoiceItem=x,p(),navigator.clipboard.writeText(e.result.data.invoice_url),d({title:"\u0423\u0441\u043F\u0456\u0448\u043D\u043E!",text:"\u0420\u0430\u0445\u0443\u043D\u043E\u043A \u0431\u0443\u0432 \u0443\u0441\u043F\u0456\u0448\u043D\u043E \u0441\u0442\u0432\u043E\u0440\u0435\u043D\u0438\u0439, \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F \u043D\u0430 \u043E\u043F\u043B\u0430\u0442\u0443 \u0441\u043A\u043E\u043F\u0456\u0439\u043E\u0432\u0430\u043D\u043E \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0456\u043D\u0443",icon:"success"}),m("submitItemForm",e.result)}).catch(e=>{console.log(e),d({title:"Error!",icon:"error"})})}function F(){a.order.waybill&&axios.post(route("notify.waybill"),{phone:a.order.client.phone,waybill:a.order.waybill,order_id:a.order.id}).then(({data:e})=>{e.success===!0?d({icon:"success",title:"\u041D\u043E\u043C\u0435\u0440 \u043D\u0430\u043A\u043B\u0430\u0434\u043D\u043E\u0439 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u043A\u043B\u0438\u0435\u043D\u0442\u0443",text:e.info}):d({icon:"error",title:"\u041E\u0448\u0438\u0431\u043A\u0430",text:e.info}),axios.put(route("api.orders.update",a.order.id),a.order)}).catch(e=>{d({icon:"error",title:"\u041E\u0448\u0438\u0431\u043A\u0430",text:"\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443"}),console.log(e)})}function W(){r.value.itemsModalAction==="create"?axios.post(route("api.order-items.add",a.order.id),r.value.item).then(({data:e})=>{b(),m("submitItemForm",e.result)}).catch(e=>console.log(e)):r.value.itemsModalAction==="edit"&&axios.put(route("api.order-items.update",r.value.item.id),r.value.item).then(({data:e})=>{b(),m("submitItemForm",e.result)}).catch(e=>console.log(e))}function G(){b(),r.value.itemsModalAction="create"}function b(){r.value.showItemsModal=!r.value.showItemsModal}function Q(){axios.get(route("api.users.list.managers")).then(({data:e})=>{e.result.length&&e.result.forEach(o=>{r.value.managers.push({key:o.id,value:o.name})})}).catch(e=>console.log(e))}function q(e,o){d({title:"Are you sure?",icon:"warning",showCancelButton:!0}).then(s=>{s.isConfirmed&&axios.delete(route("api.order-items.destroy",{item_id:e,order_id:a.order.id})).then(()=>{m("submitItemForm"),d({title:"Success",icon:"success"})}).catch($=>{console.log($),d({title:"Error",icon:"error"})})})}function J(e){b(),r.value.itemsModalAction="edit",axios.get(route("api.order-items.edit",e)).then(({data:o})=>r.value.item=o.result).catch(o=>console.log(o))}function K(){d({title:"\u0423\u0441\u043F\u0456\u0448\u043D\u043E",text:"\u041F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F \u043D\u0430 \u043E\u043F\u043B\u0430\u0442\u0443 \u043D\u0430\u0434\u0456\u0441\u043B\u0430\u043D\u043E \u043A\u043B\u0456\u0454\u043D\u0442\u0443",icon:"success"}),m("submitItemForm")}return(e,o)=>(c(),f("form",ve,[i("div",he,[i("div",fe,[l(n,{value:e.$t("clients.status")},null,8,["value"]),l(u,{value:t.clientStatuses[t.order.client.status],type:"text",disabled:""},null,8,["value"])]),i("div",ye,[l(n,{value:e.$t("clients.full_name")},null,8,["value"]),l(u,{value:h(j),type:"text",disabled:""},null,8,["value"])]),i("div",ge,[l(n,{value:e.$t("clients.phone")},null,8,["value"]),i("div",be,[i("a",{href:"tel:+"+t.order.client.phone,class:"border-lg rounded-lg border p-3"},[l(ne)],8,we),l(u,{modelValue:t.order.client.phone,"onUpdate:modelValue":o[0]||(o[0]=s=>t.order.client.phone=s),type:"text",disabled:""},null,8,["modelValue"]),i("a",{href:"javascript:",onClick:H,class:"border-lg rounded-lg border p-3"},[l(me)])])]),i("div",pe,[l(n,{value:"\xA0"}),l(I,{class:"w-full",type:"button",onClick:o[1]||(o[1]=s=>e.$emit("onEditClient"))},{default:M(()=>[w(k(e.$t("orders.client_card")),1)]),_:1})])]),$e,t.order.client.orders.length>1?(c(),y(oe,{key:0,data:t.order.client.orders,statuses:t.statuses},null,8,["data","statuses"])):v("",!0),Ve,i("div",ke,[i("div",_e,[l(n,{value:e.$t("orders.status")},null,8,["value"]),l(C,{modelValue:t.order.status,"onUpdate:modelValue":o[2]||(o[2]=s=>t.order.status=s),options:r.value.statuses},null,8,["modelValue","options"])]),i("div",Me,[l(n,{value:e.$t("orders.manager_id")},null,8,["value"]),l(C,{modelValue:t.order.manager_id,"onUpdate:modelValue":o[3]||(o[3]=s=>t.order.manager_id=s),options:r.value.managers},null,8,["modelValue","options"])]),i("div",Ie,[l(n,{value:e.$t("orders.payment_method")},null,8,["value"]),l(C,{modelValue:t.order.payment_method,"onUpdate:modelValue":o[4]||(o[4]=s=>t.order.payment_method=s),options:r.value.paymentMethods},null,8,["modelValue","options"])]),i("div",Ce,[l(n,{value:e.$t("orders.parcel_reminder")},null,8,["value"]),i("div",xe,[i("div",Fe,[l(O,{modelValue:t.order.parcel_reminder,"onUpdate:modelValue":o[5]||(o[5]=s=>t.order.parcel_reminder=s)},null,8,["modelValue"]),l(n,{value:t.order.parcel_reminder?"\u0422\u0430\u043A":"\u041D\u0456"},null,8,["value"])])])])]),Ue,i("div",ze,[i("div",Se,[i("div",Be,[l(n,{value:e.$t("orders.city")},null,8,["value"]),l(u,{modelValue:t.order.city,"onUpdate:modelValue":o[6]||(o[6]=s=>t.order.city=s),type:"text",placeholder:e.$t("orders.enter_city")},null,8,["modelValue","placeholder"])]),i("div",Oe,[l(n,{value:e.$t("orders.postal_office")},null,8,["value"]),l(u,{modelValue:t.order.postal_office,"onUpdate:modelValue":o[7]||(o[7]=s=>t.order.postal_office=s),type:"text",placeholder:e.$t("orders.enter_postal_office")},null,8,["modelValue","placeholder"])]),i("div",Ae,[l(n,{value:e.$t("orders.waybill")},null,8,["value"]),l(u,{modelValue:t.order.waybill,"onUpdate:modelValue":o[8]||(o[8]=s=>t.order.waybill=s),type:"text",placeholder:e.$t("orders.enter_waybill")},null,8,["modelValue","placeholder"]),!t.order.sms_waybill_status&&t.order.waybill?(c(),f("div",Ee,[i("a",{href:"javascript:",onClick:o[9]||(o[9]=z(s=>F(t.order.client.phone,t.order.waybill),["prevent"]))},k(e.$t("orders.send_waybill_for_client")),1)])):v("",!0),t.order.sms_waybill_status?(c(),f("div",je,[w(k(e.$t("orders.waybill_sent"))+" (",1),i("a",{href:"javascript:",onClick:o[10]||(o[10]=z(s=>F(t.order.client.phone,t.order.waybill),["prevent"]))},k(e.$t("orders.waybill_resent")),1),De])):v("",!0)]),t.order.status==="return"?(c(),f("div",Le,[i("div",He,[l(O,{modelValue:t.order.refund_other_waybill,"onUpdate:modelValue":o[11]||(o[11]=s=>t.order.refund_other_waybill=s),onChange:e.test},null,8,["modelValue","onChange"]),l(n,{value:e.$t("orders.refund_other_waybill")},null,8,["value"])]),t.order.refund_other_waybill?(c(),y(u,{key:0,modelValue:t.order.other_waybill,"onUpdate:modelValue":o[12]||(o[12]=s=>t.order.other_waybill=s),type:"text",placeholder:e.$t("orders.enter_refund_other_waybill")},null,8,["modelValue","placeholder"])):v("",!0)])):v("",!0)]),i("div",Ne,[l(n,{value:e.$t("orders.comment")},null,8,["value"]),l(Z,{rows:"12",modelValue:t.order.comment,"onUpdate:modelValue":o[13]||(o[13]=s=>t.order.comment=s),placeholder:e.$t("orders.enter_comment")},null,8,["modelValue","placeholder"])])]),Te,i("div",Pe,[i("div",We,[l(n,{value:e.$t("orders.sale_of_air")},null,8,["value"]),l(u,{modelValue:t.order.sale_of_air_price,"onUpdate:modelValue":o[14]||(o[14]=s=>t.order.sale_of_air_price=s),type:"number",placeholder:e.$t("orders.enter_sale_of_air_price")},null,8,["modelValue","placeholder"])]),i("div",Ge,[l(n,{value:e.$t("orders.discount")},null,8,["value"]),l(u,{modelValue:t.order.discount_sum,"onUpdate:modelValue":o[15]||(o[15]=s=>t.order.discount_sum=s),type:"number",placeholder:e.$t("orders.enter_discount_sum")},null,8,["modelValue","placeholder"])]),i("div",Qe,[l(n,{value:"\u0417\u0430\u0433\u0430\u043B\u044C\u043D\u0430 \u0441\u0443\u043C\u0430 \u043F\u0435\u0440\u0435\u0434\u043E\u043F\u043B\u0430\u0442\u0438 (\u0433\u0440\u043D.)"}),l(u,{modelValue:t.order.prepayment_sum,"onUpdate:modelValue":o[16]||(o[16]=s=>t.order.prepayment_sum=s),type:"number",disabled:""},null,8,["modelValue"])])]),i("div",qe,[l(I,{type:"button",onClick:G},{default:M(()=>[Je]),_:1}),(c(),y(S(h(D)),{item:r.value.item,size:"medium",onCloseModal:b,onSubmitItemForm:W},null,40,["item"]))]),l(te,{data:t.order.items,onEditOrderItem:J,onDestroyOrderItem:q},null,8,["data"]),i("div",Ke,[l(_,{title:"\u041A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0442\u043E\u0432\u0430\u0440\u0456\u0432",description:t.order.total_count,class:"text-center"},null,8,["description"]),l(_,{title:"\u0417\u0430\u0433\u0430\u043B\u044C\u043D\u0430 \u0446\u0456\u043D\u0430",description:e.$filters.formatMoney(t.order.total_price),class:"text-center"},null,8,["description"]),l(_,{title:"\u0426\u0456\u043D\u0430 \u043D\u0430 \u043F\u043E\u0441\u0438\u043B\u043A\u0443",description:e.$filters.formatMoney(h(E)),class:"text-center"},null,8,["description"]),l(_,{title:"\u041F\u0440\u043E\u043C\u043E-\u043A\u043E\u0434",description:t.order.promo_code?t.order.promo_code:"\u0412\u0456\u0434\u0441\u0443\u0442\u043D\u0456\u0439",class:"text-center"},null,8,["description"])]),h(g)("show-invoices")?(c(),f("div",Re,[h(g)("create-invoices")?(c(),y(I,{key:0,type:"button",onClick:T,class:"my-4"},{default:M(()=>[Xe]),_:1})):v("",!0),t.order.invoices.length?(c(),y(le,{key:1,data:t.order.invoices,statuses:t.invoiceStatuses,"can-destroy":h(g)("destroy-invoices"),onOnDestroy:N,onOnSendInvoiceSms:K},null,8,["data","statuses","can-destroy"])):v("",!0),(c(),y(S(h(L)),{item:r.value.invoiceItem,onCloseModal:p,onSubmitForm:P,onDeclineForm:p},null,40,["item"]))])):v("",!0)]))}};export{at as default};
