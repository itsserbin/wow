import G from"./Indicators.5f9ec9ac.js";import H from"./Modal.3884c3b7.js";import J from"./Table.fe9cf932.js";import K from"./CrmLayout.c2dfe654.js";import{s as C,S as D,L as Q,p as W,j as X}from"./app.c998355c.js";import Y from"./Datepicker.d31859ab.js";import{C as m}from"./ClientsRepository.843bcbc3.js";import{ag as Z,p as w,f as L,q as ee,m as f,w as r,v as P,o,k as $,t as b,u as p,g as _,i as k,x as n,F as V,s as A,j as u,ad as ae}from"./vendor.693a237b.js";import"./Form.e0239d03.js";import"./ItemsTable.c7117300.js";import"./vue.m.8e70aa70.js";import"./bootstrap.8b9397d4.js";import"./__commonjsHelpers__.488ed5c2.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./lazyload.6866379a.js";import"./Logo.c403545e.js";import"./index.02b5b7d6.js";const te={key:0},se={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},le={class:"md:col-span-1"},oe={class:"md:col-span-4"},ie={key:1,class:"w-full grid grid-cols-1 gap-4"},ne={class:"text-center"},xe={__name:"Index",props:["statuses","subStatuses","orderStatuses"],setup(c){const M=c,{t:d}=Z(),h=P("$swal"),v=P("$can"),g=w([]),x=[{title:d("clients.export"),key:"export"}],a=w({data:[],indicators:{},isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),s=w({status:null,currentPage:1,orderBy:{key:null,val:null},date:[]}),E=L(()=>{if(s.value.date.length===2)return{date_start:s.value.date[0].toLocaleDateString(),date_end:s.value.date[1].toLocaleDateString()}}),F=L(()=>{const{currentPage:e,status:l=null,orderBy:t=null}=s.value;return{page:e,status:l,orderBy:t,...E.value}}),j=(e,l)=>{s.value.orderBy={key:e,val:l},s.value.currentPage=1,i()};ee(()=>{i(),g.value.push({title:d("clients.all_clients"),key:"all"});for(const[e,l]of Object.entries(M.statuses))g.value.push({title:l,key:e});route().params.id&&(a.value.isLoading=!0,B(route().params.id))});const N=L(()=>a.value.isActiveEditModal?H:null),O=e=>{e==="export"&&(window.location.href=route("admin.crm.clients.export"))},U=async e=>{a.value.isLoading=!0;const l=await m.search(e);l.success&&(a.value.sidebarActive=null,s.value.currentPage=1,a.value.data=l.result,a.value.isLoading=!1),a.value.isLoading=!1},I=e=>{a.value.sidebarActive=e,s.value.status=e==="all"?null:e,s.value.date=[],s.value.currentPage=1,i()},R=async()=>{s.value.currentPage=1,await i()},q=async e=>{e&&(s.value.currentPage=e),await i()},i=async()=>{a.value.isLoading=!0;const e=await m.fetch(F.value);e.success&&(a.value.indicators=e.indicators,a.value.data=e.result,a.value.isLoading=!1)},S=async e=>{if(v("destroy-clients")&&(await h({title:d("swal.sure"),icon:"warning",showCancelButton:!0})).isConfirmed){const{success:t}=await m.destroy(e);t&&(a.value.isLoading=!1,await i(),a.value.isActiveEditModal&&y(),h({title:d("swal.destroyed"),icon:"success"}))}},B=async(e,l)=>{a.value.isLoading=!0;const t=await m.edit(e);t.success&&(a.value.modal.index=l,a.value.modal=t.result,y(),a.value.isLoading=!1)},z=async()=>{(await m.update(a.value.modal)).success&&(y(),await i(),h({title:d("swal.updated"),icon:"success"}))},y=()=>{a.value.isActiveEditModal=!a.value.isActiveEditModal};return(e,l)=>(o(),f(K,{title:e.$t("clients.page_title")},{header:r(()=>[$(b(e.$t("clients.page_title")),1)]),default:r(()=>[p(v)("show-clients")?(o(),_("div",te,[k("div",se,[k("div",le,[n(D,{class:"mb-5"},{default:r(()=>[g.value.length?(o(!0),_(V,{key:0},A(g.value,t=>(o(),f(C,{onClick:T=>I(t.key),active:a.value.sidebarActive===t.key},{default:r(()=>[$(b(t.title),1)]),_:2},1032,["onClick","active"]))),256)):u("",!0)]),_:1}),p(v)("export-orders")?(o(),f(D,{key:0},{default:r(()=>[x.length?(o(),_(V,{key:0},A(x,t=>n(C,{onClick:T=>O(t.key)},{default:r(()=>[$(b(t.title),1)]),_:2},1032,["onClick"])),64)):u("",!0)]),_:1})):u("",!0)]),k("div",oe,[a.value.isLoading?(o(),f(Q,{key:0})):u("",!0),a.value.isLoading?u("",!0):(o(),_("div",ie,[n(Y,{modelValue:s.value.date,"onUpdate:modelValue":[l[0]||(l[0]=t=>s.value.date=t),R]},null,8,["modelValue"]),n(G,{data:a.value.indicators},null,8,["data"]),n(W,{onSearch:U,clear:!0,placeholder:e.$t("clients.search_placeholder")},null,8,["placeholder"]),n(J,{data:a.value.data.data,onOnEdit:B,onOnDestroy:S,onOrderBy:j,statuses:c.statuses,canDestroy:p(v)("destroy-clients")},null,8,["data","statuses","canDestroy"]),k("div",ne,[n(X,{pagination:a.value.data,"click-handler":q,modelValue:s.value.currentPage,"onUpdate:modelValue":l[1]||(l[1]=t=>s.value.currentPage=t)},null,8,["pagination","modelValue"])])]))])]),(o(),f(ae(p(N)),{item:a.value.modal,statuses:c.statuses,"sub-statuses":c.subStatuses,"order-statuses":c.orderStatuses,size:"extralarge",onCloseModal:y,onDeclineForm:S,onSubmitForm:z,canDestroy:p(v)("destroy-clients")},null,40,["item","statuses","sub-statuses","order-statuses","canDestroy"]))])):u("",!0)]),_:1},8,["title"]))}};export{xe as default};
