import{u as A}from"./app.63860471.js";import{i as p,B as _,C as d,E as P,aa as V,P as w,ae as x,z as c,q as l,G as i,H as T,p as $,D as b,F as B,s as L,v as f}from"./index.1726d409.js";import U from"./Modal.29022e52.js";import v from"./Input.c1a6bdb4.js";import{_ as q}from"./InputError.2731f248.js";import h from"./Label.9918c3e0.js";import"./Loader.471d868e.js";import"./_plugin-vue_export-helper.cdc0426e.js";const E={class:"grid gap-4"},F={class:"block"},H=f("\u0406\u043C`\u044F"),M={class:"block"},N=f("\u0412\u0430\u0448 \u0442\u0435\u043B\u0435\u0444\u043E\u043D"),R={__name:"BuyIn1ClickModal",props:["item","product","eventIdPurchaseIn1Click","eventIdAddToCard","isAddToCart"],emits:["closeModal","addToCard"],setup(g,{emit:D}){const o=g,y=A();P("$swal");const{appContext:C}=V(),{$fbq:u}=C.config.globalProperties,s=p({name:"",last_name:"",middle_name:"",email:null,comment:null,phone:null,city:null,postal_office:null,payment_method:null,event_id:o.eventIdPurchaseIn1Click}),t=p({isLoading:!1,errors:[],contentIds:[],ga4ProductsArray:[]}),n=w();async function k(){t.value.errors=[],t.value.isLoading=!0,o.isAddToCart?await m():await axios.post(route("api.v1.cart.add"),o.item).then(()=>{o.isAddToCart=!0;try{u("AddToCart",{value:o.product.discount_price?o.product.discount_price:o.product.price,currency:"UAH",content_type:"product",content_ids:[o.item.item_id],content_name:o.product.h1},{event_id:o.eventIdAddToCard})}catch(a){console.error(a)}n.commit("loadCart"),m()})}async function m(){await axios.post(route("api.v1.orders.create.1click"),s.value).then(({data:a})=>{try{n.state.list.forEach(e=>{t.value.contentIds.push(e.id),t.value.ga4ProductsArray.push({item_name:e.name.ua?e.name.ua:e.name.ru,item_id:e.id,price:e.discount_price?e.discount_price:e.price,quantity:e.count})}),u("Purchase",{value:n.state.totalPrice,currency:"UAH",content_type:"product",num_items:n.state.totalCount,content_ids:t.value.contentIds},{event_id:o.eventIdPurchaseIn1Click}),y.trackEvent({event:"send_order",ecommerce:{transaction_id:a.order.id,value:a.order.total_price,currency:"UAH",items:t.value.ga4ProductsArray}})}catch(e){console.log(e)}axios.post(route("sms.new.order"),{order_id:a.order.id,phone:a.order.client.phone}),t.value.isLoading=!1,window.location.href=route("thanks",a.order.id)}).catch(({response:a})=>{t.value.errors=a.data,t.value.isLoading=!1})}return(a,e)=>{const I=x("maska");return c(),_(U,{size:"small","submit-button-text":"\u0417\u0430\u043C\u043E\u0432\u0438\u0442\u0438",onSubmitForm:k,onCloseModal:e[2]||(e[2]=r=>a.$emit("closeModal")),"is-loading":t.value.isLoading},{content:d(()=>[l("div",E,[l("div",F,[i(h,null,{default:d(()=>[H]),_:1}),i(v,{type:"text",modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>s.value.name=r),placeholder:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0432\u0430\u0448\u0435 \u0456\u043C'\u044F"},null,8,["modelValue"])]),l("div",M,[i(h,{required:!0},{default:d(()=>[N]),_:1}),T(i(v,{type:"tel",modelValue:s.value.phone,"onUpdate:modelValue":e[1]||(e[1]=r=>s.value.phone=r),placeholder:"+38 (0",class:"phone"},null,8,["modelValue"]),[[I,"+38 (0##) ###-##-##"]]),t.value.errors.phone?(c(!0),$(B,{key:0},b(t.value.errors.phone,r=>(c(),_(q,{message:r},null,8,["message"]))),256)):L("",!0)])])]),_:1},8,["is-loading"])}}};export{R as default};
