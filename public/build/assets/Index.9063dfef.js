import O from"./Modal.5f986dc2.js";import U from"./Table.cd3d2f5c.js";import{y as _,z as x,G as j,W as v,U as m,Y as n,S as l,a0 as f,P as k,L,M as p,K as g,F as z,V as G,Z as E,O as I,be as K,D as S}from"./moment.325cf309.js";import"./Form.ba678bb8.js";import"./ItemsTable.ff8ee602.js";const T=E(" \u041A\u043B\u0456\u0454\u043D\u0442\u0438 "),W={key:1},Y={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},Z={class:"md:col-span-1"},q={class:"w-full md:col-span-4 grid grid-cols-1 gap-4"},H={class:"text-center"},se={__name:"Index",setup(J){const e=_({data:[],statuses:[],subStatuses:[],isLoading:!0,isActiveEditModal:!1,sidebarActive:"all",modal:{}}),s=_({status:null,currentPage:1}),M=x(()=>{const t={};return t.page=s.value.currentPage,s.value.status&&(t.status=s.value.status),t}),r=_([]),i=S("$swal"),h=S("$can");j(()=>{u(),axios.get(route("api.clients.statuses")).then(({data:t})=>{e.value.statuses=t.statuses,e.value.subStatuses=t.subStatuses,r.value.push({title:"\u0412\u0441\u0456 \u043A\u043B\u0456\u0454\u043D\u0442\u0438",key:"all"});for(const[a,o]of Object.entries(t.statuses))r.value.push({title:o,key:a})}),route().params.id&&(e.value.isLoading=!0,y(route().params.id))});const A=x(()=>e.value.isActiveEditModal?O:null);function C(t){axios.get(route("api.clients.search",{search:t})).then(({data:a})=>{e.value.sidebarActive=null,s.value.currentPage=1,e.value.data=a.result,e.value.isLoading=!1}).catch(a=>{console.log(a),e.value.isLoading=!1})}function P(t){e.value.sidebarActive=t,t==="all"?s.value.status=null:s.value.status=t,u()}function V(t){t&&(s.value.currentPage=t),u()}function u(){axios.get(route("api.clients.index",M.value)).then(({data:t})=>{e.value.data=t.result,e.value.isLoading=!1}).catch(t=>{console.log(t),e.value.isLoading=!1})}function b(t){h("destroy-clients")&&i({title:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438?",icon:"warning",showCancelButton:!0}).then(a=>{a.isConfirmed&&axios.delete(route("api.clients.destroy",t)).then(()=>{e.value.isLoading=!1,u(),e.value.isActiveEditModal&&d(),i({title:"Success!",icon:"success"})}).catch(o=>{console.log(o),i({title:"Error!",icon:"error"})})})}function y(t,a){axios.get(route("api.clients.edit",t)).then(({data:o})=>{e.value.modal.index=a,e.value.modal=o.result,d(),e.value.isLoading=!1}).catch(o=>console.log(o))}function w(){axios.put(route("api.clients.update",e.value.modal.id),e.value.modal).then(()=>{d(),u(),i({title:"Success!",icon:"success"})}).catch(t=>{console.log(t),i({title:"Error!",icon:"error"})})}function d(){e.value.isActiveEditModal=!e.value.isActiveEditModal}return(t,a)=>{const o=n("loader-component"),B=n("sidebar-item"),D=n("sidebar-component"),F=n("search-component"),$=n("pagination"),N=n("auth-layout");return l(),v(N,{title:"\u041A\u043B\u0456\u0454\u043D\u0442\u0438"},{header:m(()=>[T]),default:m(()=>[e.value.isLoading?(l(),v(o,{key:0})):f("",!0),!e.value.isLoading&&k(h)("show-clients")?(l(),L("div",W,[p("div",Y,[p("div",Z,[g(D,null,{default:m(()=>[r.value.length?(l(!0),L(z,{key:0},G(r.value,c=>(l(),v(B,{onClick:Q=>P(c.key),active:e.value.sidebarActive===c.key},{default:m(()=>[E(I(c.title),1)]),_:2},1032,["onClick","active"]))),256)):f("",!0)]),_:1})]),p("div",q,[g(F,{onSearch:C,clear:!0,placeholder:"\u0406\u043C\u02BC\u044F, \u043F\u0440\u0456\u0437\u0432\u0438\u0449\u0435, \u043F\u043E-\u0431\u0430\u0442\u044C\u043A\u043E\u0432\u0456, \u0442\u0435\u043B\u0435\u0444\u043E\u043D, email, \u043A\u043E\u043C\u0435\u043D\u0442\u0430\u0440..."}),g(U,{data:e.value.data.data,onOnEdit:y,onOnDestroy:b,statuses:e.value.statuses},null,8,["data","statuses"]),p("div",H,[g($,{pagination:e.value.data,"click-handler":V,modelValue:s.value.currentPage,"onUpdate:modelValue":a[0]||(a[0]=c=>s.value.currentPage=c)},null,8,["pagination","modelValue"])])])]),(l(),v(K(k(A)),{item:e.value.modal,statuses:e.value.statuses,"sub-statuses":e.value.subStatuses,size:"extralarge",onCloseModal:d,onDeclineForm:b,onSubmitForm:w},null,40,["item","statuses","sub-statuses"]))])):f("",!0)]),_:1})}}};export{se as default};
