{"version":3,"file":"Index-d391c3fd.js","sources":["../../../resources/js/Pages/Admin/Options/PromoCodes/Index.vue"],"sourcesContent":["<script setup>\nimport {reactive, onMounted, inject, ref, computed} from \"vue\";\nimport {swal} from \"@/Includes/swal\";\n\nimport Modal from '@/Pages/Admin/Options/PromoCodes/Modal.vue';\nimport OptionsLayout from '@/Pages/Admin/Options/OptionsLayout.vue'\nimport Table from '@/Pages/Admin/Options/PromoCodes/Table.vue';\nimport Loader from '@/Components/Loader.vue';\nimport Button from '@/Components/Button.vue';\nimport Paginate from '@/Components/Paginate.vue';\n\nconst can = inject('$can');\n\nconst item = reactive({\n    code: null,\n    percent_discount: null,\n    discount_in_hryvnia: null,\n    end_date: null,\n    published: 0,\n})\n\nconst state = ref({\n    data: [],\n    currentPage: 1,\n    isLoading: true,\n    isActiveModal: false,\n    modalAction: '',\n    item: item,\n});\n\nonMounted(() => {\n    fetch(1);\n})\n\nconst activeModal = computed(() => state.value.isActiveModal ? Modal : null)\n\nfunction fetch(page) {\n    state.value.isLoading = true;\n    if (page) {\n        state.value.currentPage = page;\n    }\n    axios.get(route('api.promo-codes.index', {'page': state.value.currentPage}))\n        .then(response => {\n            Object.assign(state.value.data, response.data.result);\n            state.value.isLoading = false;\n        })\n        .catch(errors => {\n            console.log(errors);\n            state.value.isLoading = false;\n        })\n}\n\nfunction onDestroy(id) {\n    if (can('destroy-promo-codes')) {\n        swal({\n            title: 'Видалити?',\n            icon: 'warning',\n            showCancelButton: true,\n        }).then((result) => {\n            if (result.isConfirmed) {\n                axios.delete(route('api.promo-codes.destroy', id))\n                    .then(() => {\n                        fetch();\n                        if (state.value.isActiveModal) {\n                            modalFunction();\n                        }\n                        swal({\n                            icon: 'success',\n                            title: 'Destroyed!'\n                        })\n                    })\n                    .catch(errors => {\n                        console.log(errors);\n                        swal({\n                            icon: 'error',\n                            title: 'Error!'\n                        })\n                    })\n            }\n        })\n\n    }\n}\n\nfunction modalFunction() {\n    state.value.isActiveModal = !state.value.isActiveModal;\n}\n\nfunction onEdit(id, i) {\n    if (can('edit-promo-codes')) {\n        axios.get(route('api.promo-codes.edit', id))\n            .then(({data}) => {\n                state.value.item = data.result;\n                state.value.modalAction = 'edit';\n                state.value.item.index = i;\n                modalFunction();\n            })\n            .catch((response) => console.log(response))\n    }\n}\n\nfunction onUpdate() {\n    if (can('edit-promo-codes')) {\n        axios.put(route('api.promo-codes.update', state.value.item.id), state.value.item)\n            .then(() => {\n                modalFunction();\n                fetch();\n                swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction onCreate() {\n    if (can('create-promo-codes')) {\n        axios.post(route('api.promo-codes.create'), state.value.item)\n            .then(() => {\n                modalFunction();\n                state.value.item = item;\n                fetch();\n                swal({\n                    title: 'Success!',\n                    icon: 'success'\n                })\n            })\n            .catch((response) => {\n                console.log(response);\n                swal({\n                    title: 'Error!',\n                    icon: 'error'\n                })\n            })\n    }\n}\n\nfunction submitForm() {\n    if (state.value.modalAction === 'edit' && can('edit-promo-codes')) {\n        onUpdate();\n    } else if (state.value.modalAction === 'create' && can('create-promo-codes')) {\n        onCreate();\n    }\n}\n\nfunction create() {\n    if (can('create-promo-codes')) {\n        Object.assign(state.value.item, item);\n        state.value.modalAction = 'create';\n        modalFunction();\n    }\n}\n\n</script>\n\n<template>\n    <OptionsLayout title=\"Промо-коди\">\n        <template #header>\n            Промо-коди\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-promo-codes')\">\n            <Button type=\"btn\" @click=\"create\" v-if=\"can('create-promo-codes')\">\n                Додати\n            </Button>\n\n            <Table :data=\"state.data.data\"\n                   @onEdit=\"onEdit\"\n                   @onDestroy=\"onDestroy\"\n                   :canDestroy=\"can('destroy-promo-codes')\"\n            />\n\n            <Paginate :pagination=\"state.data\"\n                      :click-handler=\"fetch\"\n                      v-model=\"state.currentPage\"\n            />\n            <component :is=\"activeModal\"\n                       :item=\"state.item\"\n                       @closeModal=\"modalFunction\"\n                       @submitForm=\"submitForm\"\n                       @declineForm=\"onDestroy\"\n                       :canDestroy=\"can('destroy-promo-codes')\"\n            ></component>\n        </div>\n    </OptionsLayout>\n</template>\n"],"names":["can","inject","item","reactive","state","ref","onMounted","fetch","activeModal","computed","Modal","page","response","errors","onDestroy","id","swal","result","modalFunction","onEdit","i","data","onUpdate","onCreate","submitForm","create"],"mappings":"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"}