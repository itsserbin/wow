{"version":3,"file":"Index-ab2cda17.js","sources":["../../../resources/js/Pages/Admin/Statistics/Products/Index.vue"],"sourcesContent":["<script setup>\nimport {onMounted, inject, ref, computed} from \"vue\";\nimport {endOfMonth, startOfMonth} from 'date-fns';\n\nimport Button from '@/Components/Button.vue';\nimport Paginate from '@/Components/Paginate.vue';\nimport Card from '@/Components/Card.vue';\nimport Label from '@/Components/Form/Label.vue';\nimport Loader from '@/Components/Loader.vue';\nimport StatisticLayout from '@/Pages/Admin/Statistics/StatisticLayout.vue'\nimport DatepickerComponent from '@/Pages/Admin/Statistics/Datepicker.vue'\nimport Table from '@/Pages/Admin/Statistics/Products/Table.vue'\nimport Multiselect from '@/Components/Multiselect/Multiselect.vue';\n\nconst can = inject('$can');\n\nconst state = ref({\n    data: [],\n    products: [],\n    chart: null,\n    isLoading: true,\n});\n\nconst products = ref([]);\n\nconst params = ref({\n    date: [],\n    currentPage: 1,\n})\n\nconst productsArray = computed(() => {\n    let products = [];\n    state.value.products.forEach((item) => {\n        products.push(item.id)\n    })\n\n    return products.join();\n})\n\nconst getParams = computed(() => {\n    const data = {};\n    if (params.value.date.length === 2) {\n        data.date_start = params.value.date[0].toLocaleDateString();\n        data.date_end = params.value.date[1].toLocaleDateString();\n    }\n    if (productsArray.value) {\n        data.products = productsArray.value;\n    }\n    data.page = params.value.currentPage;\n    return data;\n\n})\n\nonMounted(() => {\n    params.value.date[0] = startOfMonth(new Date());\n    params.value.date[1] = endOfMonth(new Date());\n\n    fetch();\n\n    axios.get(route('api.products.list'))\n        .then(({data}) => products.value = data.result)\n        .catch((response) => console.log(response));\n})\n\nfunction fetchClear() {\n    params.value.date = [];\n    state.value.products = [];\n    fetch();\n}\n\nfunction h1AndCodeAndId({h1, id}) {\n    return h1.ua ? h1.ua + ` (${id})` : (h1.ru ? h1.ru + ` (${id})` : id);\n}\n\nfunction paginate(page) {\n    if (page) {\n        params.value.currentPage = page;\n    }\n    fetch();\n}\n\nfunction search() {\n    params.value.currentPage = 1;\n    fetch();\n}\n\nfunction fetch() {\n    state.value.isLoading = true;\n    axios.get(route('api.statistics.products.index', getParams.value))\n        .then(({data}) => {\n            state.value.data = data;\n            state.value.isLoading = false;\n        })\n        .catch((errors) => {\n            console.log(errors);\n            state.value.isLoading = false;\n        });\n}\n</script>\n\n<template>\n    <StatisticLayout title=\"Статистика товарів\">\n        <template #header>\n            Статистика товарів\n        </template>\n\n        <Loader v-if=\"state.isLoading\"/>\n        <div v-if=\"!state.isLoading && can('show-bookkeeping-marketing')\" class=\"grid grid-cols-1 gap-4\">\n            <div class=\"grid grid-cols-1 md:grid-cols-12 gap-4 mt-5\">\n                <div class=\"block col-span-2 text-center\">\n                    <Label value=\"&nbsp;\"/>\n                    <Button type=\"button\" @click=\"fetchClear\">\n                        Очистити\n                    </Button>\n                </div>\n                <div class=\"block col-span-4\">\n                    <Label value=\"Фільтр по даті\"/>\n                    <DatepickerComponent v-model=\"params.date\"/>\n                </div>\n\n                <div class=\"block col-span-4\">\n                    <Label value=\"Фільтр по менеджерам\"/>\n                    <multiselect\n                        v-model=\"state.products\"\n                        :options=\"products\"\n                        :custom-label=\"h1AndCodeAndId\"\n                        placeholder=\"Оберіть товари\"\n                        track-by=\"id\"\n                        :searchable=\"true\"\n                        :close-on-select=\"false\"\n                        multiple\n                    />\n                </div>\n\n                <div class=\"block col-span-2 text-center\">\n                    <Label value=\"&nbsp;\"/>\n                    <Button type=\"button\" @click=\"search\">\n                        Пошук\n                    </Button>\n                </div>\n            </div>\n\n            <div class=\"grid grid-cols-2 md:grid-cols-4\">\n                <Card v-for=\"(item,i) in state.data.generalStat\"\n                      class=\"text-center\"\n                      :title=\"i\"\n                      :description=\"item ? item : '0'\"\n                >\n                </Card>\n            </div>\n\n            <Table :data=\"state.data.result.data\"/>\n\n            <div class=\"text-center\">\n                <Paginate :pagination=\"state.data.result\"\n                          :click-handler=\"paginate\"\n                          v-model=\"params.currentPage\"\n                />\n            </div>\n        </div>\n    </StatisticLayout>\n</template>\n"],"names":["can","inject","state","ref","products","params","productsArray","computed","item","getParams","data","onMounted","startOfMonth","endOfMonth","fetch","response","fetchClear","h1AndCodeAndId","h1","id","paginate","page","search","errors"],"mappings":"moCAcA,MAAMA,EAAMC,EAAO,MAAM,EAEnBC,EAAQC,EAAI,CACd,KAAM,CAAE,EACR,SAAU,CAAE,EACZ,MAAO,KACP,UAAW,EACf,CAAC,EAEKC,EAAWD,EAAI,CAAA,CAAE,EAEjBE,EAASF,EAAI,CACf,KAAM,CAAE,EACR,YAAa,CACjB,CAAC,EAEKG,EAAgBC,EAAS,IAAM,CACjC,IAAIH,EAAW,CAAA,EACf,OAAAF,EAAM,MAAM,SAAS,QAASM,GAAS,CACnCJ,EAAS,KAAKI,EAAK,EAAE,CAC7B,CAAK,EAEMJ,EAAS,MACpB,CAAC,EAEKK,EAAYF,EAAS,IAAM,CAC7B,MAAMG,EAAO,CAAA,EACb,OAAIL,EAAO,MAAM,KAAK,SAAW,IAC7BK,EAAK,WAAaL,EAAO,MAAM,KAAK,CAAC,EAAE,qBACvCK,EAAK,SAAWL,EAAO,MAAM,KAAK,CAAC,EAAE,sBAErCC,EAAc,QACdI,EAAK,SAAWJ,EAAc,OAElCI,EAAK,KAAOL,EAAO,MAAM,YAClBK,CAEX,CAAC,EAEDC,EAAU,IAAM,CACZN,EAAO,MAAM,KAAK,CAAC,EAAIO,EAAa,IAAI,IAAM,EAC9CP,EAAO,MAAM,KAAK,CAAC,EAAIQ,EAAW,IAAI,IAAM,EAE5CC,IAEA,MAAM,IAAI,MAAM,mBAAmB,CAAC,EAC/B,KAAK,CAAC,CAAC,KAAAJ,CAAI,IAAMN,EAAS,MAAQM,EAAK,MAAM,EAC7C,MAAOK,GAAa,QAAQ,IAAIA,CAAQ,CAAC,CAClD,CAAC,EAED,SAASC,GAAa,CAClBX,EAAO,MAAM,KAAO,GACpBH,EAAM,MAAM,SAAW,GACvBY,GACJ,CAEA,SAASG,EAAe,CAAC,GAAAC,EAAI,GAAAC,CAAE,EAAG,CAC9B,OAAOD,EAAG,GAAKA,EAAG,GAAK,KAAKC,KAASD,EAAG,GAAKA,EAAG,GAAK,KAAKC,KAAQA,CACtE,CAEA,SAASC,EAASC,EAAM,CAChBA,IACAhB,EAAO,MAAM,YAAcgB,GAE/BP,GACJ,CAEA,SAASQ,GAAS,CACdjB,EAAO,MAAM,YAAc,EAC3BS,GACJ,CAEA,SAASA,GAAQ,CACbZ,EAAM,MAAM,UAAY,GACxB,MAAM,IAAI,MAAM,gCAAiCO,EAAU,KAAK,CAAC,EAC5D,KAAK,CAAC,CAAC,KAAAC,CAAI,IAAM,CACdR,EAAM,MAAM,KAAOQ,EACnBR,EAAM,MAAM,UAAY,EACpC,CAAS,EACA,MAAOqB,GAAW,CACf,QAAQ,IAAIA,CAAM,EAClBrB,EAAM,MAAM,UAAY,EACpC,CAAS,CACT"}